var Hr,be,Fl,Cn,Aa,Ol,Bl,jl,Ul,An,_n,wn,Wl,Or={},Vl=[],Cu=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,zr=Array.isArray;function Kt(t,a){for(var r in a)t[r]=a[r];return t}function Tn(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function e(t,a,r){var s,n,o,l={};for(o in a)o=="key"?s=a[o]:o=="ref"?n=a[o]:l[o]=a[o];if(arguments.length>2&&(l.children=arguments.length>3?Hr.call(arguments,2):r),typeof t=="function"&&t.defaultProps!=null)for(o in t.defaultProps)l[o]===void 0&&(l[o]=t.defaultProps[o]);return Nr(t,l,s,n,null)}function Nr(t,a,r,s,n){var o={type:t,props:a,key:r,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:n??++Fl,__i:-1,__u:0};return n==null&&be.vnode!=null&&be.vnode(o),o}function B(t){return t.children}function Jt(t,a){this.props=t,this.context=a}function lr(t,a){if(a==null)return t.__?lr(t.__,t.__i+1):null;for(var r;a<t.__k.length;a++)if((r=t.__k[a])!=null&&r.__e!=null)return r.__e;return typeof t.type=="function"?lr(t):null}function Gl(t){var a,r;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,a=0;a<t.__k.length;a++)if((r=t.__k[a])!=null&&r.__e!=null){t.__e=t.__c.base=r.__e;break}return Gl(t)}}function kn(t){(!t.__d&&(t.__d=!0)&&Aa.push(t)&&!ys.__r++||Ol!=be.debounceRendering)&&((Ol=be.debounceRendering)||Bl)(ys)}function ys(){for(var t,a,r,s,n,o,l,i=1;Aa.length;)Aa.length>i&&Aa.sort(jl),t=Aa.shift(),i=Aa.length,t.__d&&(r=void 0,s=void 0,n=(s=(a=t).__v).__e,o=[],l=[],a.__P&&((r=Kt({},s)).__v=s.__v+1,be.vnode&&be.vnode(r),Mn(a.__P,r,s,a.__n,a.__P.namespaceURI,32&s.__u?[n]:null,o,n??lr(s),!!(32&s.__u),l),r.__v=s.__v,r.__.__k[r.__i]=r,Kl(o,r,l),s.__e=s.__=null,r.__e!=n&&Gl(r)));ys.__r=0}function ql(t,a,r,s,n,o,l,i,d,u,y){var f,v,x,h,A,C,M,_=s&&s.__k||Vl,k=a.length;for(d=Au(r,a,_,d,k),f=0;f<k;f++)(x=r.__k[f])!=null&&(v=x.__i==-1?Or:_[x.__i]||Or,x.__i=f,C=Mn(t,x,v,n,o,l,i,d,u,y),h=x.__e,x.ref&&v.ref!=x.ref&&(v.ref&&En(v.ref,null,x),y.push(x.ref,x.__c||h,x)),A==null&&h!=null&&(A=h),(M=!!(4&x.__u))||v.__k===x.__k?d=Yl(x,d,t,M):typeof x.type=="function"&&C!==void 0?d=C:h&&(d=h.nextSibling),x.__u&=-7);return r.__e=A,d}function Au(t,a,r,s,n){var o,l,i,d,u,y=r.length,f=y,v=0;for(t.__k=new Array(n),o=0;o<n;o++)(l=a[o])!=null&&typeof l!="boolean"&&typeof l!="function"?(typeof l=="string"||typeof l=="number"||typeof l=="bigint"||l.constructor==String?l=t.__k[o]=Nr(null,l,null,null,null):zr(l)?l=t.__k[o]=Nr(B,{children:l},null,null,null):l.constructor===void 0&&l.__b>0?l=t.__k[o]=Nr(l.type,l.props,l.key,l.ref?l.ref:null,l.__v):t.__k[o]=l,d=o+v,l.__=t,l.__b=t.__b+1,i=null,(u=l.__i=Tu(l,r,d,f))!=-1&&(f--,(i=r[u])&&(i.__u|=2)),i==null||i.__v==null?(u==-1&&(n>y?v--:n<y&&v++),typeof l.type!="function"&&(l.__u|=4)):u!=d&&(u==d-1?v--:u==d+1?v++:(u>d?v--:v++,l.__u|=4))):t.__k[o]=null;if(f)for(o=0;o<y;o++)(i=r[o])!=null&&(2&i.__u)==0&&(i.__e==s&&(s=lr(i)),Zl(i,i));return s}function Yl(t,a,r,s){var n,o;if(typeof t.type=="function"){for(n=t.__k,o=0;n&&o<n.length;o++)n[o]&&(n[o].__=t,a=Yl(n[o],a,r,s));return a}t.__e!=a&&(s&&(a&&t.type&&!a.parentNode&&(a=lr(t)),r.insertBefore(t.__e,a||null)),a=t.__e);do a=a&&a.nextSibling;while(a!=null&&a.nodeType==8);return a}function gs(t,a){return a=a||[],t==null||typeof t=="boolean"||(zr(t)?t.some(function(r){gs(r,a)}):a.push(t)),a}function Tu(t,a,r,s){var n,o,l,i=t.key,d=t.type,u=a[r],y=u!=null&&(2&u.__u)==0;if(u===null&&i==null||y&&i==u.key&&d==u.type)return r;if(s>(y?1:0)){for(n=r-1,o=r+1;n>=0||o<a.length;)if((u=a[l=n>=0?n--:o++])!=null&&(2&u.__u)==0&&i==u.key&&d==u.type)return l}return-1}function Hl(t,a,r){a[0]=="-"?t.setProperty(a,r??""):t[a]=r==null?"":typeof r!="number"||Cu.test(a)?r:r+"px"}function ms(t,a,r,s,n){var o,l;e:if(a=="style")if(typeof r=="string")t.style.cssText=r;else{if(typeof s=="string"&&(t.style.cssText=s=""),s)for(a in s)r&&a in r||Hl(t.style,a,"");if(r)for(a in r)s&&r[a]==s[a]||Hl(t.style,a,r[a])}else if(a[0]=="o"&&a[1]=="n")o=a!=(a=a.replace(Ul,"$1")),l=a.toLowerCase(),a=l in t||a=="onFocusOut"||a=="onFocusIn"?l.slice(2):a.slice(2),t.l||(t.l={}),t.l[a+o]=r,r?s?r.u=s.u:(r.u=An,t.addEventListener(a,o?wn:_n,o)):t.removeEventListener(a,o?wn:_n,o);else{if(n=="http://www.w3.org/2000/svg")a=a.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(a!="width"&&a!="height"&&a!="href"&&a!="list"&&a!="form"&&a!="tabIndex"&&a!="download"&&a!="rowSpan"&&a!="colSpan"&&a!="role"&&a!="popover"&&a in t)try{t[a]=r??"";break e}catch{}typeof r=="function"||(r==null||r===!1&&a[4]!="-"?t.removeAttribute(a):t.setAttribute(a,a=="popover"&&r==1?"":r))}}function zl(t){return function(a){if(this.l){var r=this.l[a.type+t];if(a.t==null)a.t=An++;else if(a.t<r.u)return;return r(be.event?be.event(a):a)}}}function Mn(t,a,r,s,n,o,l,i,d,u){var y,f,v,x,h,A,C,M,_,k,S,O,P,H,N,U,j,L=a.type;if(a.constructor!==void 0)return null;128&r.__u&&(d=!!(32&r.__u),o=[i=a.__e=r.__e]),(y=be.__b)&&y(a);e:if(typeof L=="function")try{if(M=a.props,_="prototype"in L&&L.prototype.render,k=(y=L.contextType)&&s[y.__c],S=y?k?k.props.value:y.__:s,r.__c?C=(f=a.__c=r.__c).__=f.__E:(_?a.__c=f=new L(M,S):(a.__c=f=new Jt(M,S),f.constructor=L,f.render=Eu),k&&k.sub(f),f.state||(f.state={}),f.__n=s,v=f.__d=!0,f.__h=[],f._sb=[]),_&&f.__s==null&&(f.__s=f.state),_&&L.getDerivedStateFromProps!=null&&(f.__s==f.state&&(f.__s=Kt({},f.__s)),Kt(f.__s,L.getDerivedStateFromProps(M,f.__s))),x=f.props,h=f.state,f.__v=a,v)_&&L.getDerivedStateFromProps==null&&f.componentWillMount!=null&&f.componentWillMount(),_&&f.componentDidMount!=null&&f.__h.push(f.componentDidMount);else{if(_&&L.getDerivedStateFromProps==null&&M!==x&&f.componentWillReceiveProps!=null&&f.componentWillReceiveProps(M,S),a.__v==r.__v||!f.__e&&f.shouldComponentUpdate!=null&&f.shouldComponentUpdate(M,f.__s,S)===!1){for(a.__v!=r.__v&&(f.props=M,f.state=f.__s,f.__d=!1),a.__e=r.__e,a.__k=r.__k,a.__k.some(function(q){q&&(q.__=a)}),O=0;O<f._sb.length;O++)f.__h.push(f._sb[O]);f._sb=[],f.__h.length&&l.push(f);break e}f.componentWillUpdate!=null&&f.componentWillUpdate(M,f.__s,S),_&&f.componentDidUpdate!=null&&f.__h.push(function(){f.componentDidUpdate(x,h,A)})}if(f.context=S,f.props=M,f.__P=t,f.__e=!1,P=be.__r,H=0,_){for(f.state=f.__s,f.__d=!1,P&&P(a),y=f.render(f.props,f.state,f.context),N=0;N<f._sb.length;N++)f.__h.push(f._sb[N]);f._sb=[]}else do f.__d=!1,P&&P(a),y=f.render(f.props,f.state,f.context),f.state=f.__s;while(f.__d&&++H<25);f.state=f.__s,f.getChildContext!=null&&(s=Kt(Kt({},s),f.getChildContext())),_&&!v&&f.getSnapshotBeforeUpdate!=null&&(A=f.getSnapshotBeforeUpdate(x,h)),U=y,y!=null&&y.type===B&&y.key==null&&(U=Jl(y.props.children)),i=ql(t,zr(U)?U:[U],a,r,s,n,o,l,i,d,u),f.base=a.__e,a.__u&=-161,f.__h.length&&l.push(f),C&&(f.__E=f.__=null)}catch(q){if(a.__v=null,d||o!=null)if(q.then){for(a.__u|=d?160:128;i&&i.nodeType==8&&i.nextSibling;)i=i.nextSibling;o[o.indexOf(i)]=null,a.__e=i}else{for(j=o.length;j--;)Tn(o[j]);Sn(a)}else a.__e=r.__e,a.__k=r.__k,q.then||Sn(a);be.__e(q,a,r)}else o==null&&a.__v==r.__v?(a.__k=r.__k,a.__e=r.__e):i=a.__e=Mu(r.__e,a,r,s,n,o,l,d,u);return(y=be.diffed)&&y(a),128&a.__u?void 0:i}function Sn(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(Sn)}function Kl(t,a,r){for(var s=0;s<r.length;s++)En(r[s],r[++s],r[++s]);be.__c&&be.__c(a,t),t.some(function(n){try{t=n.__h,n.__h=[],t.some(function(o){o.call(n)})}catch(o){be.__e(o,n.__v)}})}function Jl(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:zr(t)?t.map(Jl):Kt({},t)}function Mu(t,a,r,s,n,o,l,i,d){var u,y,f,v,x,h,A,C=r.props||Or,M=a.props,_=a.type;if(_=="svg"?n="http://www.w3.org/2000/svg":_=="math"?n="http://www.w3.org/1998/Math/MathML":n||(n="http://www.w3.org/1999/xhtml"),o!=null){for(u=0;u<o.length;u++)if((x=o[u])&&"setAttribute"in x==!!_&&(_?x.localName==_:x.nodeType==3)){t=x,o[u]=null;break}}if(t==null){if(_==null)return document.createTextNode(M);t=document.createElementNS(n,_,M.is&&M),i&&(be.__m&&be.__m(a,o),i=!1),o=null}if(_==null)C===M||i&&t.data==M||(t.data=M);else{if(o=o&&Hr.call(t.childNodes),!i&&o!=null)for(C={},u=0;u<t.attributes.length;u++)C[(x=t.attributes[u]).name]=x.value;for(u in C)if(x=C[u],u!="children"){if(u=="dangerouslySetInnerHTML")f=x;else if(!(u in M)){if(u=="value"&&"defaultValue"in M||u=="checked"&&"defaultChecked"in M)continue;ms(t,u,null,x,n)}}for(u in M)x=M[u],u=="children"?v=x:u=="dangerouslySetInnerHTML"?y=x:u=="value"?h=x:u=="checked"?A=x:i&&typeof x!="function"||C[u]===x||ms(t,u,x,C[u],n);if(y)i||f&&(y.__html==f.__html||y.__html==t.innerHTML)||(t.innerHTML=y.__html),a.__k=[];else if(f&&(t.innerHTML=""),ql(a.type=="template"?t.content:t,zr(v)?v:[v],a,r,s,_=="foreignObject"?"http://www.w3.org/1999/xhtml":n,o,l,o?o[0]:r.__k&&lr(r,0),i,d),o!=null)for(u=o.length;u--;)Tn(o[u]);i||(u="value",_=="progress"&&h==null?t.removeAttribute("value"):h!=null&&(h!==t[u]||_=="progress"&&!h||_=="option"&&h!=C[u])&&ms(t,u,h,C[u],n),u="checked",A!=null&&A!=t[u]&&ms(t,u,A,C[u],n))}return t}function En(t,a,r){try{if(typeof t=="function"){var s=typeof t.__u=="function";s&&t.__u(),s&&a==null||(t.__u=t(a))}else t.current=a}catch(n){be.__e(n,r)}}function Zl(t,a,r){var s,n;if(be.unmount&&be.unmount(t),(s=t.ref)&&(s.current&&s.current!=t.__e||En(s,null,a)),(s=t.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(o){be.__e(o,a)}s.base=s.__P=null}if(s=t.__k)for(n=0;n<s.length;n++)s[n]&&Zl(s[n],a,r||typeof t.type!="function");r||Tn(t.__e),t.__c=t.__=t.__e=void 0}function Eu(t,a,r){return this.constructor(t,r)}function Ql(t,a,r){var s,n,o,l;a==document&&(a=document.documentElement),be.__&&be.__(t,a),n=(s=typeof r=="function")?null:r&&r.__k||a.__k,o=[],l=[],Mn(a,t=(!s&&r||a).__k=e(B,null,[t]),n||Or,Or,a.namespaceURI,!s&&r?[r]:n?null:a.firstChild?Hr.call(a.childNodes):null,o,!s&&r?r:n?n.__e:a.firstChild,s,l),Kl(o,t,l)}function Xl(t,a,r){var s,n,o,l,i=Kt({},t.props);for(o in t.type&&t.type.defaultProps&&(l=t.type.defaultProps),a)o=="key"?s=a[o]:o=="ref"?n=a[o]:i[o]=a[o]===void 0&&l!=null?l[o]:a[o];return arguments.length>2&&(i.children=arguments.length>3?Hr.call(arguments,2):r),Nr(t.type,i,s||t.key,n||t.ref,null)}function ei(t){function a(r){var s,n;return this.getChildContext||(s=new Set,(n={})[a.__c]=this,this.getChildContext=function(){return n},this.componentWillUnmount=function(){s=null},this.shouldComponentUpdate=function(o){this.props.value!=o.value&&s.forEach(function(l){l.__e=!0,kn(l)})},this.sub=function(o){s.add(o);var l=o.componentWillUnmount;o.componentWillUnmount=function(){s&&s.delete(o),l&&l.call(o)}}),r.children}return a.__c="__cC"+Wl++,a.__=t,a.Provider=a.__l=(a.Consumer=function(r,s){return r.children(s)}).contextType=a,a}Hr=Vl.slice,be={__e:function(t,a,r,s){for(var n,o,l;a=a.__;)if((n=a.__c)&&!n.__)try{if((o=n.constructor)&&o.getDerivedStateFromError!=null&&(n.setState(o.getDerivedStateFromError(t)),l=n.__d),n.componentDidCatch!=null&&(n.componentDidCatch(t,s||{}),l=n.__d),l)return n.__E=n}catch(i){t=i}throw t}},Fl=0,Cn=function(t){return t!=null&&t.constructor===void 0},Jt.prototype.setState=function(t,a){var r;r=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=Kt({},this.state),typeof t=="function"&&(t=t(Kt({},r),this.props)),t&&Kt(r,t),t!=null&&this.__v&&(a&&this._sb.push(a),kn(this))},Jt.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),kn(this))},Jt.prototype.render=B,Aa=[],Bl=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,jl=function(t,a){return t.__v.__b-a.__v.__b},ys.__r=0,Ul=/(PointerCapture)$|Capture$/i,An=0,_n=zl(!1),wn=zl(!0),Wl=0;var Fr,Be,$n,ti,Br=0,ci=[],Ue=be,ai=Ue.__b,ri=Ue.__r,si=Ue.diffed,ni=Ue.__c,oi=Ue.unmount,li=Ue.__;function Ln(t,a){Ue.__h&&Ue.__h(Be,t,Br||a),Br=0;var r=Be.__H||(Be.__H={__:[],__h:[]});return t>=r.__.length&&r.__.push({}),r.__[t]}function I(t){return Br=1,$u(pi,t)}function $u(t,a,r){var s=Ln(Fr++,2);if(s.t=t,!s.__c&&(s.__=[r?r(a):pi(void 0,a),function(i){var d=s.__N?s.__N[0]:s.__[0],u=s.t(d,i);d!==u&&(s.__N=[u,s.__[1]],s.__c.setState({}))}],s.__c=Be,!Be.__f)){var n=function(i,d,u){if(!s.__c.__H)return!0;var y=s.__c.__H.__.filter(function(v){return!!v.__c});if(y.every(function(v){return!v.__N}))return!o||o.call(this,i,d,u);var f=s.__c.props!==i;return y.forEach(function(v){if(v.__N){var x=v.__[0];v.__=v.__N,v.__N=void 0,x!==v.__[0]&&(f=!0)}}),o&&o.call(this,i,d,u)||f};Be.__f=!0;var o=Be.shouldComponentUpdate,l=Be.componentWillUpdate;Be.componentWillUpdate=function(i,d,u){if(this.__e){var y=o;o=void 0,n(i,d,u),o=y}l&&l.call(this,i,d,u)},Be.shouldComponentUpdate=n}return s.__N||s.__}function oe(t,a){var r=Ln(Fr++,3);!Ue.__s&&ui(r.__H,a)&&(r.__=t,r.u=a,Be.__H.__h.push(r))}function Pt(t){return Br=5,Fe(function(){return{current:t}},[])}function Fe(t,a){var r=Ln(Fr++,7);return ui(r.__H,a)&&(r.__=t(),r.__H=a,r.__h=t),r.__}function di(t,a){return Br=8,Fe(function(){return t},a)}function Pu(){for(var t;t=ci.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(xs),t.__H.__h.forEach(Pn),t.__H.__h=[]}catch(a){t.__H.__h=[],Ue.__e(a,t.__v)}}Ue.__b=function(t){Be=null,ai&&ai(t)},Ue.__=function(t,a){t&&a.__k&&a.__k.__m&&(t.__m=a.__k.__m),li&&li(t,a)},Ue.__r=function(t){ri&&ri(t),Fr=0;var a=(Be=t.__c).__H;a&&($n===Be?(a.__h=[],Be.__h=[],a.__.forEach(function(r){r.__N&&(r.__=r.__N),r.u=r.__N=void 0})):(a.__h.forEach(xs),a.__h.forEach(Pn),a.__h=[],Fr=0)),$n=Be},Ue.diffed=function(t){si&&si(t);var a=t.__c;a&&a.__H&&(a.__H.__h.length&&(ci.push(a)!==1&&ti===Ue.requestAnimationFrame||((ti=Ue.requestAnimationFrame)||Lu)(Pu)),a.__H.__.forEach(function(r){r.u&&(r.__H=r.u),r.u=void 0})),$n=Be=null},Ue.__c=function(t,a){a.some(function(r){try{r.__h.forEach(xs),r.__h=r.__h.filter(function(s){return!s.__||Pn(s)})}catch(s){a.some(function(n){n.__h&&(n.__h=[])}),a=[],Ue.__e(s,r.__v)}}),ni&&ni(t,a)},Ue.unmount=function(t){oi&&oi(t);var a,r=t.__c;r&&r.__H&&(r.__H.__.forEach(function(s){try{xs(s)}catch(n){a=n}}),r.__H=void 0,a&&Ue.__e(a,r.__v))};var ii=typeof requestAnimationFrame=="function";function Lu(t){var a,r=function(){clearTimeout(s),ii&&cancelAnimationFrame(a),setTimeout(t)},s=setTimeout(r,35);ii&&(a=requestAnimationFrame(r))}function xs(t){var a=Be,r=t.__c;typeof r=="function"&&(t.__c=void 0,r()),Be=a}function Pn(t){var a=Be;t.__c=t.__(),Be=a}function ui(t,a){return!t||t.length!==a.length||a.some(function(r,s){return r!==t[s]})}function pi(t,a){return typeof a=="function"?a(t):a}var Du={};function bs(t,a){for(var r in a)t[r]=a[r];return t}function Ru(t,a,r){var s,n=/(?:\?([^#]*))?(#.*)?$/,o=t.match(n),l={};if(o&&o[1])for(var i=o[1].split("&"),d=0;d<i.length;d++){var u=i[d].split("=");l[decodeURIComponent(u[0])]=decodeURIComponent(u.slice(1).join("="))}t=Dn(t.replace(n,"")),a=Dn(a||"");for(var y=Math.max(t.length,a.length),f=0;f<y;f++)if(a[f]&&a[f].charAt(0)===":"){var v=a[f].replace(/(^:|[+*?]+$)/g,""),x=(a[f].match(/[+*?]+$/)||Du)[0]||"",h=~x.indexOf("+"),A=~x.indexOf("*"),C=t[f]||"";if(!C&&!A&&(x.indexOf("?")<0||h)){s=!1;break}if(l[v]=decodeURIComponent(C),h||A){l[v]=t.slice(f).map(decodeURIComponent).join("/");break}}else if(a[f]!==t[f]){s=!1;break}return(r.default===!0||s!==!1)&&l}function Iu(t,a){return t.rank<a.rank?1:t.rank>a.rank?-1:t.index-a.index}function Nu(t,a){return t.index=a,t.rank=(function(r){return r.props.default?0:Dn(r.props.path).map(Ou).join("")})(t),t.props}function Dn(t){return t.replace(/(^\/+|\/+$)/g,"").split("/")}function Ou(t){return t.charAt(0)==":"?1+"*+?".indexOf(t.charAt(t.length-1))||4:5}var Hu={},Ta=[],fi=[],ht=null,mi={url:Rn()},zu=ei(mi);function Rn(){var t;return""+((t=ht&&ht.location?ht.location:ht&&ht.getCurrentLocation?ht.getCurrentLocation():typeof location<"u"?location:Hu).pathname||"")+(t.search||"")}function Fu(t,a){return a===void 0&&(a=!1),typeof t!="string"&&t.url&&(a=t.replace,t=t.url),(function(r){for(var s=Ta.length;s--;)if(Ta[s].canRoute(r))return!0;return!1})(t)&&(function(r,s){s===void 0&&(s="push"),ht&&ht[s]?ht[s](r):typeof history<"u"&&history[s+"State"]&&history[s+"State"](null,null,r)})(t,a?"replace":"push"),yi(t)}function yi(t){for(var a=!1,r=0;r<Ta.length;r++)Ta[r].routeTo(t)&&(a=!0);return a}function Bu(t){if(t&&t.getAttribute){var a=t.getAttribute("href"),r=t.getAttribute("target");if(a&&a.match(/^\//g)&&(!r||r.match(/^_?self$/i)))return Fu(a)}}function ju(t){return t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.stopPropagation&&t.stopPropagation(),t.preventDefault(),!1}function Uu(t){if(!(t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||t.button)){var a=t.target;do if(a.localName==="a"&&a.getAttribute("href")){if(a.hasAttribute("data-native")||a.hasAttribute("native"))return;if(Bu(a))return ju(t)}while(a=a.parentNode)}}var vi=!1;function In(t){t.history&&(ht=t.history),this.state={url:t.url||Rn()}}bs(In.prototype=new Jt,{shouldComponentUpdate:function(t){return t.static!==!0||t.url!==this.props.url||t.onChange!==this.props.onChange},canRoute:function(t){var a=gs(this.props.children);return this.g(a,t)!==void 0},routeTo:function(t){this.setState({url:t});var a=this.canRoute(t);return this.p||this.forceUpdate(),a},componentWillMount:function(){this.p=!0},componentDidMount:function(){var t=this;vi||(vi=!0,ht||addEventListener("popstate",function(){yi(Rn())}),addEventListener("click",Uu)),Ta.push(this),ht&&(this.u=ht.listen(function(a){var r=a.location||a;t.routeTo(""+(r.pathname||"")+(r.search||""))})),this.p=!1},componentWillUnmount:function(){typeof this.u=="function"&&this.u(),Ta.splice(Ta.indexOf(this),1)},componentWillUpdate:function(){this.p=!0},componentDidUpdate:function(){this.p=!1},g:function(t,a){t=t.filter(Nu).sort(Iu);for(var r=0;r<t.length;r++){var s=t[r],n=Ru(a,s.props.path,s.props);if(n)return[s,n]}},render:function(t,a){var r,s,n=t.onChange,o=a.url,l=this.c,i=this.g(gs(t.children),o);if(i&&(s=Xl(i[0],bs(bs({url:o,matches:r=i[1]},r),{key:void 0,ref:void 0}))),o!==(l&&l.url)){bs(mi,l=this.c={url:o,previous:l&&l.url,current:s,path:s?s.props.path:null,matches:r}),l.router=this,l.active=s?[s]:[];for(var d=fi.length;d--;)fi[d]({});typeof n=="function"&&n(l)}return e(zu.Provider,{value:l},s)}});var Wu=Symbol.for("preact-signals");function _s(){if(ua>1)ua--;else{for(var t,a=!1;jr!==void 0;){var r=jr;for(jr=void 0,Nn++;r!==void 0;){var s=r.o;if(r.o=void 0,r.f&=-3,!(8&r.f)&&bi(r))try{r.c()}catch(n){a||(t=n,a=!0)}r=s}}if(Nn=0,ua--,a)throw t}}function On(t){if(ua>0)return t();ua++;try{return t()}finally{_s()}}var he=void 0;function Hn(t){var a=he;he=void 0;try{return t()}finally{he=a}}var gi,jr=void 0,ua=0,Nn=0,hs=0;function xi(t){if(he!==void 0){var a=t.n;if(a===void 0||a.t!==he)return a={i:0,S:t,p:he.s,n:void 0,t:he,e:void 0,x:void 0,r:a},he.s!==void 0&&(he.s.n=a),he.s=a,t.n=a,32&he.f&&t.S(a),a;if(a.i===-1)return a.i=0,a.n!==void 0&&(a.n.p=a.p,a.p!==void 0&&(a.p.n=a.n),a.p=he.s,a.n=void 0,he.s.n=a,he.s=a),a}}function qe(t,a){this.v=t,this.i=0,this.n=void 0,this.t=void 0,this.W=a?.watched,this.Z=a?.unwatched,this.name=a?.name}qe.prototype.brand=Wu;qe.prototype.h=function(){return!0};qe.prototype.S=function(t){var a=this,r=this.t;r!==t&&t.e===void 0&&(t.x=r,this.t=t,r!==void 0?r.e=t:Hn(function(){var s;(s=a.W)==null||s.call(a)}))};qe.prototype.U=function(t){var a=this;if(this.t!==void 0){var r=t.e,s=t.x;r!==void 0&&(r.x=s,t.e=void 0),s!==void 0&&(s.e=r,t.x=void 0),t===this.t&&(this.t=s,s===void 0&&Hn(function(){var n;(n=a.Z)==null||n.call(a)}))}};qe.prototype.subscribe=function(t){var a=this;return Ea(function(){var r=a.value,s=he;he=void 0;try{t(r)}finally{he=s}},{name:"sub"})};qe.prototype.valueOf=function(){return this.value};qe.prototype.toString=function(){return this.value+""};qe.prototype.toJSON=function(){return this.value};qe.prototype.peek=function(){var t=he;he=void 0;try{return this.value}finally{he=t}};Object.defineProperty(qe.prototype,"value",{get:function(){var t=xi(this);return t!==void 0&&(t.i=this.i),this.v},set:function(t){if(t!==this.v){if(Nn>100)throw new Error("Cycle detected");this.v=t,this.i++,hs++,ua++;try{for(var a=this.t;a!==void 0;a=a.x)a.t.N()}finally{_s()}}}});function aa(t,a){return new qe(t,a)}function bi(t){for(var a=t.s;a!==void 0;a=a.n)if(a.S.i!==a.i||!a.S.h()||a.S.i!==a.i)return!0;return!1}function hi(t){for(var a=t.s;a!==void 0;a=a.n){var r=a.S.n;if(r!==void 0&&(a.r=r),a.S.n=a,a.i=-1,a.n===void 0){t.s=a;break}}}function _i(t){for(var a=t.s,r=void 0;a!==void 0;){var s=a.p;a.i===-1?(a.S.U(a),s!==void 0&&(s.n=a.n),a.n!==void 0&&(a.n.p=s)):r=a,a.S.n=a.r,a.r!==void 0&&(a.r=void 0),a=s}t.s=r}function Ma(t,a){qe.call(this,void 0),this.x=t,this.s=void 0,this.g=hs-1,this.f=4,this.W=a?.watched,this.Z=a?.unwatched,this.name=a?.name}Ma.prototype=new qe;Ma.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===hs))return!0;if(this.g=hs,this.f|=1,this.i>0&&!bi(this))return this.f&=-2,!0;var t=he;try{hi(this),he=this;var a=this.x();(16&this.f||this.v!==a||this.i===0)&&(this.v=a,this.f&=-17,this.i++)}catch(r){this.v=r,this.f|=16,this.i++}return he=t,_i(this),this.f&=-2,!0};Ma.prototype.S=function(t){if(this.t===void 0){this.f|=36;for(var a=this.s;a!==void 0;a=a.n)a.S.S(a)}qe.prototype.S.call(this,t)};Ma.prototype.U=function(t){if(this.t!==void 0&&(qe.prototype.U.call(this,t),this.t===void 0)){this.f&=-33;for(var a=this.s;a!==void 0;a=a.n)a.S.U(a)}};Ma.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var t=this.t;t!==void 0;t=t.x)t.t.N()}};Object.defineProperty(Ma.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var t=xi(this);if(this.h(),t!==void 0&&(t.i=this.i),16&this.f)throw this.v;return this.v}});function ws(t,a){return new Ma(t,a)}function wi(t){var a=t.u;if(t.u=void 0,typeof a=="function"){ua++;var r=he;he=void 0;try{a()}catch(s){throw t.f&=-2,t.f|=8,zn(t),s}finally{he=r,_s()}}}function zn(t){for(var a=t.s;a!==void 0;a=a.n)a.S.U(a);t.x=void 0,t.s=void 0,wi(t)}function Vu(t){if(he!==this)throw new Error("Out-of-order effect");_i(this),he=t,this.f&=-2,8&this.f&&zn(this),_s()}function ir(t,a){this.x=t,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32,this.name=a?.name,gi&&gi.push(this)}ir.prototype.c=function(){var t=this.S();try{if(8&this.f||this.x===void 0)return;var a=this.x();typeof a=="function"&&(this.u=a)}finally{t()}};ir.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,wi(this),hi(this),ua++;var t=he;return he=this,Vu.bind(this,t)};ir.prototype.N=function(){2&this.f||(this.f|=2,this.o=jr,jr=this)};ir.prototype.d=function(){this.f|=8,1&this.f||zn(this)};ir.prototype.dispose=function(){this.d()};function Ea(t,a){var r=new ir(t,a);try{r.c()}catch(n){throw r.d(),n}var s=r.d.bind(r);return s[Symbol.dispose]=s,s}var ki,Fn,ks,Gu=typeof window<"u"&&!!window.__PREACT_SIGNALS_DEVTOOLS__;var Si=[];Ea(function(){ki=this.N})();function cr(t,a){be[t]=a.bind(null,be[t]||function(){})}function Ss(t){if(ks){var a=ks;ks=void 0,a()}ks=t&&t.S()}function Ci(t){var a=this,r=t.data,s=Yu(r);s.value=r;var n=Fe(function(){for(var i=a,d=a.__v;d=d.__;)if(d.__c){d.__c.__$f|=4;break}var u=ws(function(){var x=s.value.value;return x===0?0:x===!0?"":x||""}),y=ws(function(){return!Array.isArray(u.value)&&!Cn(u.value)}),f=Ea(function(){if(this.N=Ai,y.value){var x=u.value;i.__v&&i.__v.__e&&i.__v.__e.nodeType===3&&(i.__v.__e.data=x)}}),v=a.__$u.d;return a.__$u.d=function(){f(),v.call(this)},[y,u]},[]),o=n[0],l=n[1];return o.value?l.peek():l.value}Ci.displayName="ReactiveTextNode";Object.defineProperties(qe.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:Ci},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}});cr("__b",function(t,a){if(typeof a.type=="string"){var r,s=a.props;for(var n in s)if(n!=="children"){var o=s[n];o instanceof qe&&(r||(a.__np=r={}),r[n]=o,s[n]=o.peek())}}t(a)});cr("__r",function(t,a){if(t(a),a.type!==B){Ss();var r,s=a.__c;s&&(s.__$f&=-2,(r=s.__$u)===void 0&&(s.__$u=r=(function(n,o){var l;return Ea(function(){l=this},{name:o}),l.c=n,l})(function(){var n;Gu&&((n=r.y)==null||n.call(r)),s.__$f|=1,s.setState({})},typeof a.type=="function"?a.type.displayName||a.type.name:""))),Fn=s,Ss(r)}});cr("__e",function(t,a,r,s){Ss(),Fn=void 0,t(a,r,s)});cr("diffed",function(t,a){Ss(),Fn=void 0;var r;if(typeof a.type=="string"&&(r=a.__e)){var s=a.__np,n=a.props;if(s){var o=r.U;if(o)for(var l in o){var i=o[l];i!==void 0&&!(l in s)&&(i.d(),o[l]=void 0)}else o={},r.U=o;for(var d in s){var u=o[d],y=s[d];u===void 0?(u=qu(r,d,y,n),o[d]=u):u.o(y,n)}}}t(a)});function qu(t,a,r,s){var n=a in t&&t.ownerSVGElement===void 0,o=aa(r);return{o:function(l,i){o.value=l,s=i},d:Ea(function(){this.N=Ai;var l=o.value.value;s[a]!==l&&(s[a]=l,n?t[a]=l:l!=null&&(l!==!1||a[4]==="-")?t.setAttribute(a,l):t.removeAttribute(a))})}}cr("unmount",function(t,a){if(typeof a.type=="string"){var r=a.__e;if(r){var s=r.U;if(s){r.U=void 0;for(var n in s){var o=s[n];o&&o.d()}}}}else{var l=a.__c;if(l){var i=l.__$u;i&&(l.__$u=void 0,i.d())}}t(a)});cr("__h",function(t,a,r,s){(s<3||s===9)&&(a.__$f|=2),t(a,r,s)});Jt.prototype.shouldComponentUpdate=function(t,a){if(this.__R)return!0;var r=this.__$u,s=r&&r.s!==void 0;for(var n in a)return!0;if(this.__f||typeof this.u=="boolean"&&this.u===!0){var o=2&this.__$f;if(!(s||o||4&this.__$f)||1&this.__$f)return!0}else if(!(s||4&this.__$f)||3&this.__$f)return!0;for(var l in t)if(l!=="__source"&&t[l]!==this.props[l])return!0;for(var i in this.props)if(!(i in t))return!0;return!1};function Yu(t,a){return Fe(function(){return aa(t,a)},[])}var Ku=function(t){queueMicrotask(function(){queueMicrotask(t)})};function Ju(){On(function(){for(var t;t=Si.shift();)ki.call(t)})}function Ai(){Si.push(this)===1&&(be.requestAnimationFrame||Ku)(Ju)}var Zu=window.location.pathname.replace(/\/ui(\/.*)?$/,""),pa=window.location.origin+Zu,Cs=new Map;function ie(t){if(Cs.has(t))return Cs.get(t);let a=fetch(`${pa}${t}`).then(r=>{if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);return r.json()}).finally(()=>{Cs.delete(t)});return Cs.set(t,a),a}function fa(t,a){return fetch(`${pa}${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(r=>{if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);return r.json()})}function dr(t,a){return fetch(`${pa}${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(r=>{if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);return r.json()})}var As=new Map;function $a(t){return As.has(t)||As.set(t,aa({data:null,loading:!1,error:null,stale:!1,lastFetched:0})),As.get(t)}async function fr(t){let a=$a(t),r=a.value;if(r.loading||r.lastFetched&&Date.now()-r.lastFetched<2e3)return;r.data!==null&&r.stale||(a.value={...r,loading:!0,error:null});try{let o=await ie(`/api/cache/${t}`);a.value={data:o,loading:!1,error:null,stale:!1,lastFetched:Date.now()}}catch(o){let l=o.message&&o.message.startsWith("HTTP 404");a.value={...a.value,data:l?{data:{}}:a.value.data,loading:!1,error:l?null:o.message,stale:!1,lastFetched:Date.now()}}}var pr=aa(!1),ur=aa(""),Pa=aa(Qu());function Qu(){if(typeof window>"u")return"light";let t=localStorage.getItem("aria-theme");return t==="light"||t==="dark"?t:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function Xu(t){Pa.value=t,document.documentElement.setAttribute("data-theme",t),localStorage.setItem("aria-theme",t)}function Ts(){Xu(Pa.value==="dark"?"light":"dark")}typeof document<"u"&&document.documentElement.setAttribute("data-theme",Pa.value);var ut=null,Ur=1e3,ep=3e4,Wr=null,Vr=null;function Bn(){if(ut&&(ut.readyState===WebSocket.CONNECTING||ut.readyState===WebSocket.OPEN))return;let t=window.location.protocol==="https:"?"wss:":"ws:",a=window.location.pathname.replace(/\/ui(\/.*)?$/,""),r=`${t}//${window.location.host}${a}/ws`;ut=new WebSocket(r),ut.onopen=()=>{Ur=1e3,pr.value=!0,ur.value="Connected",ap(),clearInterval(Wr),Wr=setInterval(()=>{ut&&ut.readyState===WebSocket.OPEN&&ut.send(JSON.stringify({type:"ping"}))},3e4)},ut.onmessage=s=>{try{let n=JSON.parse(s.data);if(n.type==="cache_updated"&&n.data&&n.data.category){let o=n.data.category,l=$a(o);l.value={...l.value,stale:!0},fr(o)}}catch{}},ut.onclose=()=>{pr.value=!1,ur.value=`Disconnected \u2014 reconnecting in ${(Ur/1e3).toFixed(0)}s`,clearInterval(Wr),tp()},ut.onerror=()=>{ur.value="Connection error"}}function tp(){clearTimeout(Vr),Vr=setTimeout(()=>{Vr=null,Bn()},Ur),Ur=Math.min(Ur*2,ep)}function Ti(){clearInterval(Wr),Wr=null,clearTimeout(Vr),Vr=null,ut&&(ut.onclose=null,ut.close(),ut=null),pr.value=!1,ur.value=""}function ap(){for(let[t,a]of As)a.value={...a.value,stale:!0},fr(t)}var rp=[[1,0],[2,0],[3,0],[0,1],[1,1],[3,1],[4,1],[0,2],[1,2],[2,2],[3,2],[4,2],[0,3],[1,3],[3,3],[4,3],[0,4],[1,4],[3,4],[4,4],[7,0],[8,0],[9,0],[10,0],[11,0],[7,1],[8,1],[10,1],[11,1],[7,2],[8,2],[9,2],[10,2],[7,3],[8,3],[10,3],[7,4],[8,4],[11,4],[14,0],[14,1],[14,2],[14,3],[14,4],[18,0],[19,0],[20,0],[17,1],[18,1],[20,1],[21,1],[17,2],[18,2],[19,2],[20,2],[21,2],[17,3],[18,3],[20,3],[21,3],[17,4],[18,4],[20,4],[21,4]],jn=10,Un=2,Mi=jn-Un,sp=1;function vr({className:t="",color:a="currentColor"}){return e("svg",{viewBox:"0 0 220 50",class:t,fill:a,role:"img","aria-label":"ARIA"},rp.map(([r,s],n)=>e("rect",{key:n,x:r*jn+Un/2,y:s*jn+Un/2,width:Mi,height:Mi,rx:sp})))}var Ms=[{path:"/",label:"Home",icon:$i},{section:"Data Collection"},{path:"/discovery",label:"Discovery",icon:lp},{path:"/capabilities",label:"Capabilities",icon:ip},{path:"/data-curation",label:"Data Curation",icon:vp},{path:"/presence",label:"Presence",icon:mp},{section:"Learning"},{path:"/intelligence",label:"Intelligence",icon:Li},{path:"/ml-engine",label:"ML Engine",icon:fp},{path:"/predictions",label:"Predictions",icon:Pi},{path:"/patterns",label:"Patterns",icon:cp},{section:"Actions"},{path:"/shadow",label:"Shadow Mode",icon:Di},{path:"/automations",label:"Automations",icon:dp},{path:"/settings",label:"Settings",icon:pp},{path:"/validation",label:"Validation",icon:up}],np=[{path:"/",label:"Home",icon:$i},{path:"/intelligence",label:"Intel",icon:Li},{path:"/predictions",label:"Predict",icon:Pi},{path:"/shadow",label:"Shadow",icon:Di},{key:"more",label:"More",icon:yp}],op=Ms.filter(t=>!t.section&&!["/","/intelligence","/predictions","/shadow"].includes(t.path));function $i(){return e("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","aria-hidden":"true"},e("rect",{x:"3",y:"3",width:"7",height:"7"}),e("rect",{x:"14",y:"3",width:"7",height:"7"}),e("rect",{x:"3",y:"14",width:"7",height:"7"}),e("rect",{x:"14",y:"14",width:"7",height:"7"}))}function lp(){return e("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","aria-hidden":"true"},e("circle",{cx:"11",cy:"11",r:"8"}),e("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}))}function ip(){return e("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","aria-hidden":"true"},e("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"}))}function Pi(){return e("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","aria-hidden":"true"},e("polyline",{points:"23 6 13.5 15.5 8.5 10.5 1 18"}),e("polyline",{points:"17 6 23 6 23 12"}))}function cp(){return e("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","aria-hidden":"true"},e("polygon",{points:"12 2 2 7 12 12 22 7 12 2"}),e("polyline",{points:"2 17 12 22 22 17"}),e("polyline",{points:"2 12 12 17 22 12"}))}function Li(){return e("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","aria-hidden":"true"},e("path",{d:"M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7z"}),e("line",{x1:"9",y1:"21",x2:"15",y2:"21"}),e("line",{x1:"10",y1:"19",x2:"14",y2:"19"}))}function Di(){return e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round","aria-hidden":"true"},e("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e("circle",{cx:"12",cy:"12",r:"3"}))}function dp(){return e("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","aria-hidden":"true"},e("circle",{cx:"12",cy:"12",r:"3"}),e("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"}))}function up(){return e("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","aria-hidden":"true"},e("path",{d:"M9 11l3 3L22 4"}),e("path",{d:"M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"}))}function pp(){return e("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","aria-hidden":"true"},e("line",{x1:"4",y1:"21",x2:"4",y2:"14"}),e("line",{x1:"4",y1:"10",x2:"4",y2:"3"}),e("line",{x1:"12",y1:"21",x2:"12",y2:"12"}),e("line",{x1:"12",y1:"8",x2:"12",y2:"3"}),e("line",{x1:"20",y1:"21",x2:"20",y2:"16"}),e("line",{x1:"20",y1:"12",x2:"20",y2:"3"}),e("line",{x1:"1",y1:"14",x2:"7",y2:"14"}),e("line",{x1:"9",y1:"8",x2:"15",y2:"8"}),e("line",{x1:"17",y1:"16",x2:"23",y2:"16"}))}function fp(){return e("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","aria-hidden":"true"},e("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2"}),e("rect",{x:"9",y:"9",width:"6",height:"6"}),e("line",{x1:"9",y1:"1",x2:"9",y2:"4"}),e("line",{x1:"15",y1:"1",x2:"15",y2:"4"}),e("line",{x1:"9",y1:"20",x2:"9",y2:"23"}),e("line",{x1:"15",y1:"20",x2:"15",y2:"23"}),e("line",{x1:"20",y1:"9",x2:"23",y2:"9"}),e("line",{x1:"20",y1:"15",x2:"23",y2:"15"}),e("line",{x1:"1",y1:"9",x2:"4",y2:"9"}),e("line",{x1:"1",y1:"15",x2:"4",y2:"15"}))}function vp(){return e("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","aria-hidden":"true"},e("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"}))}function mp(){return e("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","aria-hidden":"true"},e("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e("circle",{cx:"9",cy:"7",r:"4"}),e("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"}))}function Wn(){return e("svg",{class:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","aria-hidden":"true"},e("circle",{cx:"12",cy:"12",r:"5"}),e("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),e("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),e("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),e("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),e("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),e("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),e("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),e("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"}))}function Vn(){return e("svg",{class:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","aria-hidden":"true"},e("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"}))}function yp(){return e("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","aria-hidden":"true"},e("circle",{cx:"12",cy:"5",r:"1.5",fill:"currentColor"}),e("circle",{cx:"12",cy:"12",r:"1.5",fill:"currentColor"}),e("circle",{cx:"12",cy:"19",r:"1.5",fill:"currentColor"}))}function gp(){return e("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","aria-hidden":"true"},e("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),e("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),e("line",{x1:"3",y1:"18",x2:"21",y2:"18"}))}function Ri(){return e("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","aria-hidden":"true"},e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))}function Gn(){return e("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","aria-hidden":"true"},e("path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"}),e("path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"}))}function Ei(){let a=(window.location.hash||"#/").replace(/^#/,"")||"/",r=a.indexOf("?");return r>=0?a.slice(0,r):a}function xp({currentPath:t}){let[a,r]=I(!1),s=Pa.value==="dark";return oe(()=>{r(!1)},[t]),e("nav",{class:"sm:hidden fixed bottom-0 left-0 right-0 z-40","aria-label":"Primary navigation"},a&&e("div",{class:"fixed inset-0 z-40",style:"background: rgba(0,0,0,0.5);",onClick:()=>r(!1)},e("div",{class:"absolute bottom-14 left-0 right-0",style:"background: var(--bg-surface); border-top: 1px solid var(--border-subtle); border-top-left-radius: 12px; border-top-right-radius: 12px; box-shadow: 0 -4px 20px rgba(0,0,0,0.15); max-height: 60vh; overflow-y: auto;",onClick:n=>n.stopPropagation()},e("div",{class:"flex items-center justify-between",style:"padding: 12px 16px; border-bottom: 1px solid var(--border-subtle);"},e("span",{style:"font-size: 13px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em;"},"More"),e("button",{onClick:()=>r(!1),"aria-label":"Close menu",style:"color: var(--text-tertiary); padding: 4px; cursor: pointer; background: none; border: none;"},e(Ri,null))),e("div",{style:"padding: 8px 0;"},op.map(n=>{let o=t===n.path;return e("a",{key:n.path,href:`#${n.path}`,class:"flex items-center gap-3",style:`padding: 12px 20px; font-size: 14px; font-weight: 500; text-decoration: none; ${o?"color: var(--accent); background: var(--bg-surface-raised);":"color: var(--text-secondary);"}`},e(n.icon,null),n.label)}),e("a",{href:"#/guide",class:"flex items-center gap-3",style:`padding: 12px 20px; font-size: 14px; font-weight: 500; text-decoration: none; ${t==="/guide"?"color: var(--accent); background: var(--bg-surface-raised);":"color: var(--accent);"}`},e(Gn,null),"How to Use ARIA"),e("div",{style:"padding: 12px 20px; border-top: 1px solid var(--border-subtle); margin-top: 4px;"},e("button",{onClick:Ts,class:"flex items-center gap-2",style:"background: var(--bg-surface-raised); color: var(--text-secondary); border: 1px solid var(--border-subtle); border-radius: var(--radius); padding: 6px 12px; font-size: 13px; cursor: pointer;","aria-label":s?"Switch to light mode":"Switch to dark mode"},s?e(Wn,null):e(Vn,null),e("span",null,s?"Light mode":"Dark mode")))))),e("div",{style:"background: var(--bg-surface); border-top: 1px solid var(--border-subtle); min-height: 56px; padding-bottom: env(safe-area-inset-bottom);",class:"flex justify-around items-center"},np.map(n=>{let o=n.key==="more",i=(o?a:t===n.path)?"color: var(--accent); border-top: 2px solid var(--accent); margin-top: -2px;":"color: var(--text-tertiary); border-top: 2px solid transparent; margin-top: -2px;";return o?e("button",{key:"more",class:"flex flex-col items-center justify-center",style:`${i} min-width: 48px; min-height: 48px; background: none; border-left: none; border-right: none; border-bottom: none; cursor: pointer; font-size: 10px; font-weight: 500; gap: 2px;`,onClick:()=>r(!a),"aria-label":"More navigation options","aria-expanded":a},e(n.icon,null),e("span",null,n.label)):e("a",{key:n.path,href:`#${n.path}`,class:"flex flex-col items-center justify-center",style:`${i} min-width: 48px; min-height: 48px; text-decoration: none; font-size: 10px; font-weight: 500; gap: 2px;`,"aria-label":n.label},e(n.icon,null),e("span",null,n.label))})))}function bp({currentPath:t}){let[a,r]=I(!1),s=pr.value,n=Pa.value==="dark";oe(()=>{r(!1)},[t]);let o=Ms.filter(i=>!i.section);return e(B,null,a&&e("div",{class:"hidden sm:block lg:hidden fixed inset-0",style:"z-index: 29;",onClick:()=>r(!1)}),e("nav",{class:"hidden sm:flex lg:hidden fixed left-0 top-0 bottom-0 flex-col z-30",style:`width: ${a?"240px":"56px"}; background: var(--bg-surface); border-right: 1px solid var(--border-subtle); box-shadow: 2px 0 8px rgba(0,0,0,0.06); transition: width 0.2s ease; overflow: hidden;`,"aria-label":"Primary navigation"},e("button",{class:"flex items-center justify-center",style:`width: 56px; height: 56px; flex-shrink: 0; background: none; border: none; color: var(--text-secondary); cursor: pointer;${a?" background: var(--bg-surface-raised);":""}`,onClick:()=>r(!a),"aria-label":a?"Collapse navigation":"Expand navigation","aria-expanded":a},a?e(Ri,null):e(gp,null)),e("div",{class:"flex-1 overflow-y-auto",style:"padding: 4px 0;"},a?Ms.map((i,d)=>{if(i.section)return e("div",{key:i.section,style:`padding: 0 16px; padding-top: 14px; padding-bottom: 4px; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-tertiary); white-space: nowrap;${d>0?" border-top: 1px solid var(--border-subtle); margin-top: 6px;":""}`},i.section);let u=t===i.path;return e("a",{key:i.path,href:`#${i.path}`,class:"flex items-center gap-3",style:`padding: 8px 16px; font-size: 14px; font-weight: 500; text-decoration: none; white-space: nowrap; transition: background 0.15s ease; ${u?"color: var(--text-primary); background: var(--bg-surface-raised); border-left: 2px solid var(--accent); padding-left: 14px;":"color: var(--text-tertiary); border-left: 2px solid transparent; padding-left: 14px;"}`,"aria-label":i.label},e(i.icon,null),i.label)}):o.map(i=>{let d=t===i.path;return e("a",{key:i.path,href:`#${i.path}`,class:"flex items-center justify-center",style:`width: 56px; height: 44px; text-decoration: none; transition: background 0.15s ease; ${d?"color: var(--accent); border-left: 2px solid var(--accent);":"color: var(--text-tertiary); border-left: 2px solid transparent;"}`,title:i.label,"aria-label":i.label},e(i.icon,null))})),e("div",{style:"border-top: 1px solid var(--border-subtle); padding: 4px 0; flex-shrink: 0;"},e("a",{href:"#/guide",class:"flex items-center justify-center",style:`width: 56px; height: 44px; text-decoration: none; ${t==="/guide"?"color: var(--accent);":"color: var(--accent); opacity: 0.7;"}`,title:"How to Use ARIA","aria-label":"How to Use ARIA"},e(Gn,null)),e("button",{onClick:Ts,class:"flex items-center justify-center",style:"width: 56px; height: 44px; background: none; border: none; color: var(--text-secondary); cursor: pointer;",title:n?"Switch to light mode":"Switch to dark mode","aria-label":n?"Switch to light mode":"Switch to dark mode"},n?e(Wn,null):e(Vn,null)),e("div",{class:"flex items-center justify-center",style:"width: 56px; height: 28px;",title:s?"Connected":"Disconnected","aria-label":s?"WebSocket connected":"WebSocket disconnected"},e("span",{style:`display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: ${s?"var(--status-healthy)":"var(--status-error)"};`})))))}function hp({currentPath:t}){let a=pr.value,r=ur.value,s=Pa.value==="dark";return e("nav",{class:"hidden lg:flex fixed left-0 top-0 bottom-0 w-60 flex-col z-30 t-terminal-bg",style:"background: var(--bg-surface); border-right: 1px solid var(--border-subtle); box-shadow: 2px 0 8px rgba(0,0,0,0.06);","aria-label":"Primary navigation"},e("div",{class:"px-5 py-5"},e(vr,{className:"w-28",color:"var(--accent)"}),e("p",{style:"font-size: 10px; color: var(--text-tertiary); margin-top: 6px; letter-spacing: 0.05em;"},"Adaptive Residence Intelligence")),e("div",{class:"flex-1 px-3 space-y-0.5 overflow-y-auto"},Ms.map((n,o)=>{if(n.section)return e("div",{key:n.section,style:`padding: 0 12px; padding-top: 16px; padding-bottom: 4px; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-tertiary);${o>0?" border-top: 1px solid var(--border-subtle); margin-top: 8px;":""}`},n.section);let l=t===n.path;return e("a",{key:n.path,href:`#${n.path}`,class:"flex items-center gap-3 text-sm font-medium",style:l?"background: var(--bg-surface-raised); color: var(--text-primary); border-left: 2px solid var(--accent); padding: 8px 12px; border-radius: var(--radius); transition: background 0.15s ease, color 0.15s ease;":"color: var(--text-tertiary); padding: 8px 12px; border-left: 2px solid transparent; border-radius: var(--radius); transition: background 0.15s ease, color 0.15s ease;",onMouseEnter:i=>{l||(i.currentTarget.style.background="var(--bg-surface-raised)"),i.currentTarget.style.color="var(--text-primary)"},onMouseLeave:i=>{l||(i.currentTarget.style.background="transparent",i.currentTarget.style.color="var(--text-tertiary)")},"aria-label":n.label},e(n.icon,null),n.label)})),e("div",{style:"padding: 12px; border-top: 1px solid var(--border-subtle);",class:"space-y-2"},e("a",{href:"#/guide",class:"flex items-center gap-3 text-sm font-medium",style:t==="/guide"?"background: var(--bg-surface-raised); color: var(--text-primary); border-left: 2px solid var(--accent); padding: 8px 12px; border-radius: var(--radius);":"color: var(--accent); padding: 8px 12px; border-left: 2px solid transparent; border-radius: var(--radius); transition: background 0.15s ease, color 0.15s ease;",onMouseEnter:n=>{t!=="/guide"&&(n.currentTarget.style.background="var(--bg-surface-raised)")},onMouseLeave:n=>{t!=="/guide"&&(n.currentTarget.style.background="transparent")},"aria-label":"How to Use ARIA"},e(Gn,null),"How to Use ARIA"),e("div",{style:"padding: 0 12px; font-size: 10px; color: var(--text-tertiary); line-height: 1.6;"},e("p",{style:"font-weight: 600; color: var(--text-secondary);"},"ARIA v1.0.0"),e("p",{style:"margin-top: 2px;"},"Local ML + real-time monitoring for Home Assistant. No cloud required.")),e("button",{onClick:Ts,style:"background: var(--bg-surface-raised); color: var(--text-secondary); border: 1px solid var(--border-subtle); border-radius: var(--radius); padding: 4px 8px; margin: 0 12px; display: flex; align-items: center; gap: 6px; font-size: 0.75rem; cursor: pointer; transition: border-color 0.2s ease;",title:s?"Switch to light mode":"Switch to dark mode","aria-label":s?"Switch to light mode":"Switch to dark mode",onMouseEnter:n=>{n.currentTarget.style.borderColor="var(--border-primary)"},onMouseLeave:n=>{n.currentTarget.style.borderColor="var(--border-subtle)"}},s?e(Wn,null):e(Vn,null),e("span",null,s?"Light":"Dark")),e("div",{class:"flex items-center gap-2",style:"padding: 0 12px; font-size: 0.75rem; color: var(--text-tertiary);"},e("span",{style:`display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: ${a?"var(--status-healthy)":"var(--status-error)"};`,"aria-label":a?"WebSocket connected":"WebSocket disconnected"}),e("span",{class:"truncate"},r||(a?"Connected":"Disconnected")))))}function qn(){let[t,a]=I(Ei);return oe(()=>{function r(){a(Ei())}return window.addEventListener("hashchange",r),()=>window.removeEventListener("hashchange",r)},[]),e(B,null,e(xp,{currentPath:t}),e(bp,{currentPath:t}),e(hp,{currentPath:t}))}function fe({error:t,onRetry:a}){let r=t instanceof Error?t.message:String(t||"Unknown error");return e("div",{style:"background: var(--bg-surface); border: 1px solid var(--status-error); border-left-width: 3px; border-radius: var(--radius); padding: 16px;"},e("div",{class:"flex items-start gap-3"},e("svg",{class:"w-5 h-5 mt-0.5 shrink-0",style:"color: var(--status-error);",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})),e("div",{class:"flex-1"},e("p",{class:"text-sm",style:"color: var(--status-error);"},r)),a&&e("button",{onClick:a,class:"text-sm font-medium transition-colors",style:"color: var(--status-error); background: var(--bg-surface-raised); border-radius: var(--radius); padding: 4px 12px;"},"Retry")))}function Re(t){let a=$a(t),r=a.value,s=di(()=>fr(t),[t]);return oe(()=>{let n=a.value;n.data===null&&!n.loading&&fr(t)},[t]),oe(()=>{r.stale&&!r.loading&&fr(t)},[r.stale,r.loading,t]),{data:r.data,loading:r.loading,error:r.error,refetch:s}}function ve(t,a){return Fe(t,a)}function ke({type:t="full"}){return t==="stats"?e("div",{class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4"},[...Array(5)].map((a,r)=>e("div",{key:r,class:"t-card",style:"padding: 16px;"},e("div",{class:"h-8 w-16 animate-pulse mb-2",style:"background: var(--bg-inset); border-radius: var(--radius);"}),e("div",{class:"h-4 w-24 animate-pulse",style:"background: var(--bg-inset); border-radius: var(--radius);"})))):t==="table"?e("div",{class:"t-card",style:"overflow: hidden;"},e("div",{class:"flex gap-4 px-4 py-3",style:"border-bottom: 1px solid var(--border-subtle);"},[...Array(4)].map((a,r)=>e("div",{key:r,class:"h-4 animate-pulse flex-1",style:"background: var(--bg-inset); border-radius: var(--radius);"}))),[...Array(6)].map((a,r)=>e("div",{key:r,class:"flex gap-4 px-4 py-3",style:"border-bottom: 1px solid var(--border-subtle);"},[...Array(4)].map((s,n)=>e("div",{key:n,class:"h-4 animate-pulse flex-1",style:"background: var(--bg-surface-raised); border-radius: var(--radius);"}))))):t==="cards"?e("div",{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},[...Array(6)].map((a,r)=>e("div",{key:r,class:"t-card",style:"padding: 16px;"},e("div",{class:"h-5 w-32 animate-pulse mb-3",style:"background: var(--bg-inset); border-radius: var(--radius);"}),e("div",{class:"h-4 w-full animate-pulse mb-2",style:"background: var(--bg-surface-raised); border-radius: var(--radius);"}),e("div",{class:"h-4 w-3/4 animate-pulse",style:"background: var(--bg-surface-raised); border-radius: var(--radius);"})))):e("div",{class:"space-y-6"},e("div",{class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4"},[...Array(5)].map((a,r)=>e("div",{key:r,class:"t-card",style:"padding: 16px;"},e("div",{class:"h-8 w-16 animate-pulse mb-2",style:"background: var(--bg-inset); border-radius: var(--radius);"}),e("div",{class:"h-4 w-24 animate-pulse",style:"background: var(--bg-inset); border-radius: var(--radius);"})))),e("div",{class:"t-card",style:"overflow: hidden;"},[...Array(4)].map((a,r)=>e("div",{key:r,class:"flex gap-4 px-4 py-3",style:"border-bottom: 1px solid var(--border-subtle);"},[...Array(4)].map((s,n)=>e("div",{key:n,class:"h-4 animate-pulse flex-1",style:"background: var(--bg-surface-raised); border-radius: var(--radius);"}))))))}var _p="uplot",wp="u-hz",kp="u-vt",Sp="u-title",Cp="u-wrap",Ap="u-under",Tp="u-over",Mp="u-axis",Ra="u-off",Ep="u-select",$p="u-cursor-x",Pp="u-cursor-y",Lp="u-cursor-pt",Dp="u-legend",Rp="u-live",Ip="u-inline",Np="u-series",Op="u-marker",Ii="u-label",Hp="u-value",qr="width",Yr="height";var Ni="bottom",mr="left",Yn="right",po="#000",Oi=po+"0",Kn="mousemove",Hi="mousedown",Jn="mouseup",zi="mouseenter",Fi="mouseleave",Bi="dblclick",zp="resize",Fp="scroll",ji="change",Ds="dppxchange",fo="--",wr=typeof window<"u",to=wr?document:null,gr=wr?window:null,Bp=wr?navigator:null,me,Es;function ao(){let t=devicePixelRatio;me!=t&&(me=t,Es&&so(ji,Es,ao),Es=matchMedia(`(min-resolution: ${me-.001}dppx) and (max-resolution: ${me+.001}dppx)`),Ia(ji,Es,ao),gr.dispatchEvent(new CustomEvent(Ds)))}function _t(t,a){if(a!=null){let r=t.classList;!r.contains(a)&&r.add(a)}}function ro(t,a){let r=t.classList;r.contains(a)&&r.remove(a)}function Pe(t,a,r){t.style[a]=r+"px"}function zt(t,a,r,s){let n=to.createElement(t);return a!=null&&_t(n,a),r?.insertBefore(n,s),n}function Lt(t,a){return zt("div",t,a)}var Ui=new WeakMap;function Zt(t,a,r,s,n){let o="translate("+a+"px,"+r+"px)",l=Ui.get(t);o!=l&&(t.style.transform=o,Ui.set(t,o),a<0||r<0||a>s||r>n?_t(t,Ra):ro(t,Ra))}var Wi=new WeakMap;function Vi(t,a,r){let s=a+r,n=Wi.get(t);s!=n&&(Wi.set(t,s),t.style.background=a,t.style.borderColor=r)}var Gi=new WeakMap;function qi(t,a,r,s){let n=a+""+r,o=Gi.get(t);n!=o&&(Gi.set(t,n),t.style.height=r+"px",t.style.width=a+"px",t.style.marginLeft=s?-a/2+"px":0,t.style.marginTop=s?-r/2+"px":0)}var vo={passive:!0},jp={...vo,capture:!0};function Ia(t,a,r,s){a.addEventListener(t,r,s?jp:vo)}function so(t,a,r,s){a.removeEventListener(t,r,vo)}wr&&ao();function Ft(t,a,r,s){let n;r=r||0,s=s||a.length-1;let o=s<=2147483647;for(;s-r>1;)n=o?r+s>>1:wt((r+s)/2),a[n]<t?r=n:s=n;return t-a[r]<=a[s]-t?r:s}function _c(t){return(r,s,n)=>{let o=-1,l=-1;for(let i=s;i<=n;i++)if(t(r[i])){o=i;break}for(let i=n;i>=s;i--)if(t(r[i])){l=i;break}return[o,l]}}var wc=t=>t!=null,kc=t=>t!=null&&t>0,Ns=_c(wc),Up=_c(kc);function Wp(t,a,r,s=0,n=!1){let o=n?Up:Ns,l=n?kc:wc;[a,r]=o(t,a,r);let i=t[a],d=t[a];if(a>-1)if(s==1)i=t[a],d=t[r];else if(s==-1)i=t[r],d=t[a];else for(let u=a;u<=r;u++){let y=t[u];l(y)&&(y<i?i=y:y>d&&(d=y))}return[i??Ce,d??-Ce]}function Os(t,a,r,s){let n=Ji(t),o=Ji(a);t==a&&(n==-1?(t*=r,a/=r):(t/=r,a*=r));let l=r==10?ra:Sc,i=n==1?wt:Dt,d=o==1?Dt:wt,u=i(l(Ke(t))),y=d(l(Ke(a))),f=xr(r,u),v=xr(r,y);return r==10&&(u<0&&(f=Ae(f,-u)),y<0&&(v=Ae(v,-y))),s||r==2?(t=f*n,a=v*o):(t=Mc(t,f),a=Hs(a,v)),[t,a]}function mo(t,a,r,s){let n=Os(t,a,r,s);return t==0&&(n[0]=0),a==0&&(n[1]=0),n}var yo=.1,Yi={mode:3,pad:yo},Jr={pad:0,soft:null,mode:0},Vp={min:Jr,max:Jr};function Rs(t,a,r,s){return zs(r)?Ki(t,a,r):(Jr.pad=r,Jr.soft=s?0:null,Jr.mode=s?3:0,Ki(t,a,Vp))}function ue(t,a){return t??a}function Gp(t,a,r){for(a=ue(a,0),r=ue(r,t.length-1);a<=r;){if(t[a]!=null)return!0;a++}return!1}function Ki(t,a,r){let s=r.min,n=r.max,o=ue(s.pad,0),l=ue(n.pad,0),i=ue(s.hard,-Ce),d=ue(n.hard,Ce),u=ue(s.soft,Ce),y=ue(n.soft,-Ce),f=ue(s.mode,0),v=ue(n.mode,0),x=a-t,h=ra(x),A=pt(Ke(t),Ke(a)),C=ra(A),M=Ke(C-h);(x<1e-24||M>10)&&(x=0,(t==0||a==0)&&(x=1e-24,f==2&&u!=Ce&&(o=0),v==2&&y!=-Ce&&(l=0)));let _=x||A||1e3,k=ra(_),S=xr(10,wt(k)),O=_*(x==0?t==0?.1:1:o),P=Ae(Mc(t-O,S/10),24),H=t>=u&&(f==1||f==3&&P<=u||f==2&&P>=u)?u:Ce,N=pt(i,P<H&&t>=H?H:Bt(H,P)),U=_*(x==0?a==0?.1:1:l),j=Ae(Hs(a+U,S/10),24),L=a<=y&&(v==1||v==3&&j>=y||v==2&&j<=y)?y:-Ce,q=Bt(d,j>L&&a<=L?L:pt(L,j));return N==q&&N==0&&(q=100),[N,q]}var qp=new Intl.NumberFormat(wr?Bp.language:"en-US"),go=t=>qp.format(t),kt=Math,Ls=kt.PI,Ke=kt.abs,wt=kt.floor,Ye=kt.round,Dt=kt.ceil,Bt=kt.min,pt=kt.max,xr=kt.pow,Ji=kt.sign,ra=kt.log10,Sc=kt.log2,Yp=(t,a=1)=>kt.sinh(t)*a,Zn=(t,a=1)=>kt.asinh(t/a),Ce=1/0;function Zi(t){return(ra((t^t>>31)-(t>>31))|0)+1}function no(t,a,r){return Bt(pt(t,a),r)}function Cc(t){return typeof t=="function"}function le(t){return Cc(t)?t:()=>t}var Kp=()=>{},Ac=t=>t,Tc=(t,a)=>a,Jp=t=>null,Qi=t=>!0,Xi=(t,a)=>t==a,Zp=/\.\d*?(?=9{6,}|0{6,})/gm,Na=t=>{if($c(t)||ma.has(t))return t;let a=`${t}`,r=a.match(Zp);if(r==null)return t;let s=r[0].length-1;if(a.indexOf("e-")!=-1){let[n,o]=a.split("e");return+`${Na(n)}e${o}`}return Ae(t,s)};function La(t,a){return Na(Ae(Na(t/a))*a)}function Hs(t,a){return Na(Dt(Na(t/a))*a)}function Mc(t,a){return Na(wt(Na(t/a))*a)}function Ae(t,a=0){if($c(t))return t;let r=10**a,s=t*r*(1+Number.EPSILON);return Ye(s)/r}var ma=new Map;function Ec(t){return((""+t).split(".")[1]||"").length}function Qr(t,a,r,s){let n=[],o=s.map(Ec);for(let l=a;l<r;l++){let i=Ke(l),d=Ae(xr(t,l),i);for(let u=0;u<s.length;u++){let y=t==10?+`${s[u]}e${l}`:s[u]*d,f=(l>=0?0:i)+(l>=o[u]?0:o[u]),v=t==10?y:Ae(y,f);n.push(v),ma.set(v,f)}}return n}var Zr={},xo=[],br=[null,null],va=Array.isArray,$c=Number.isInteger,Qp=t=>t===void 0;function ec(t){return typeof t=="string"}function zs(t){let a=!1;if(t!=null){let r=t.constructor;a=r==null||r==Object}return a}function Xp(t){return t!=null&&typeof t=="object"}var ef=Object.getPrototypeOf(Uint8Array),Pc="__proto__";function hr(t,a=zs){let r;if(va(t)){let s=t.find(n=>n!=null);if(va(s)||a(s)){r=Array(t.length);for(let n=0;n<t.length;n++)r[n]=hr(t[n],a)}else r=t.slice()}else if(t instanceof ef)r=t.slice();else if(a(t)){r={};for(let s in t)s!=Pc&&(r[s]=hr(t[s],a))}else r=t;return r}function We(t){let a=arguments;for(let r=1;r<a.length;r++){let s=a[r];for(let n in s)n!=Pc&&(zs(t[n])?We(t[n],hr(s[n])):t[n]=hr(s[n]))}return t}var tf=0,af=1,rf=2;function sf(t,a,r){for(let s=0,n,o=-1;s<a.length;s++){let l=a[s];if(l>o){for(n=l-1;n>=0&&t[n]==null;)t[n--]=null;for(n=l+1;n<r&&t[n]==null;)t[o=n++]=null}}}function nf(t,a){if(cf(t)){let l=t[0].slice();for(let i=1;i<t.length;i++)l.push(...t[i].slice(1));return df(l[0])||(l=lf(l)),l}let r=new Set;for(let l=0;l<t.length;l++){let d=t[l][0],u=d.length;for(let y=0;y<u;y++)r.add(d[y])}let s=[Array.from(r).sort((l,i)=>l-i)],n=s[0].length,o=new Map;for(let l=0;l<n;l++)o.set(s[0][l],l);for(let l=0;l<t.length;l++){let i=t[l],d=i[0];for(let u=1;u<i.length;u++){let y=i[u],f=Array(n).fill(void 0),v=a?a[l][u]:af,x=[];for(let h=0;h<y.length;h++){let A=y[h],C=o.get(d[h]);A===null?v!=tf&&(f[C]=A,v==rf&&x.push(C)):f[C]=A}sf(f,x,n),s.push(f)}}return s}var of=typeof queueMicrotask>"u"?t=>Promise.resolve().then(t):queueMicrotask;function lf(t){let a=t[0],r=a.length,s=Array(r);for(let o=0;o<s.length;o++)s[o]=o;s.sort((o,l)=>a[o]-a[l]);let n=[];for(let o=0;o<t.length;o++){let l=t[o],i=Array(r);for(let d=0;d<r;d++)i[d]=l[s[d]];n.push(i)}return n}function cf(t){let a=t[0][0],r=a.length;for(let s=1;s<t.length;s++){let n=t[s][0];if(n.length!=r)return!1;if(n!=a){for(let o=0;o<r;o++)if(n[o]!=a[o])return!1}}return!0}function df(t,a=100){let r=t.length;if(r<=1)return!0;let s=0,n=r-1;for(;s<=n&&t[s]==null;)s++;for(;n>=s&&t[n]==null;)n--;if(n<=s)return!0;let o=pt(1,wt((n-s+1)/a));for(let l=t[s],i=s+o;i<=n;i+=o){let d=t[i];if(d!=null){if(d<=l)return!1;l=d}}return!0}var Lc=["January","February","March","April","May","June","July","August","September","October","November","December"],Dc=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function Rc(t){return t.slice(0,3)}var uf=Dc.map(Rc),pf=Lc.map(Rc),ff={MMMM:Lc,MMM:pf,WWWW:Dc,WWW:uf};function Gr(t){return(t<10?"0":"")+t}function vf(t){return(t<10?"00":t<100?"0":"")+t}var mf={YYYY:t=>t.getFullYear(),YY:t=>(t.getFullYear()+"").slice(2),MMMM:(t,a)=>a.MMMM[t.getMonth()],MMM:(t,a)=>a.MMM[t.getMonth()],MM:t=>Gr(t.getMonth()+1),M:t=>t.getMonth()+1,DD:t=>Gr(t.getDate()),D:t=>t.getDate(),WWWW:(t,a)=>a.WWWW[t.getDay()],WWW:(t,a)=>a.WWW[t.getDay()],HH:t=>Gr(t.getHours()),H:t=>t.getHours(),h:t=>{let a=t.getHours();return a==0?12:a>12?a-12:a},AA:t=>t.getHours()>=12?"PM":"AM",aa:t=>t.getHours()>=12?"pm":"am",a:t=>t.getHours()>=12?"p":"a",mm:t=>Gr(t.getMinutes()),m:t=>t.getMinutes(),ss:t=>Gr(t.getSeconds()),s:t=>t.getSeconds(),fff:t=>vf(t.getMilliseconds())};function bo(t,a){a=a||ff;let r=[],s=/\{([a-z]+)\}|[^{]+/gi,n;for(;n=s.exec(t);)r.push(n[0][0]=="{"?mf[n[1]]:n[0]);return o=>{let l="";for(let i=0;i<r.length;i++)l+=typeof r[i]=="string"?r[i]:r[i](o,a);return l}}var yf=new Intl.DateTimeFormat().resolvedOptions().timeZone;function gf(t,a){let r;return a=="UTC"||a=="Etc/UTC"?r=new Date(+t+t.getTimezoneOffset()*6e4):a==yf?r=t:(r=new Date(t.toLocaleString("en-US",{timeZone:a})),r.setMilliseconds(t.getMilliseconds())),r}var Ic=t=>t%1==0,Is=[1,2,2.5,5],xf=Qr(10,-32,0,Is),Nc=Qr(10,0,32,Is),bf=Nc.filter(Ic),Da=xf.concat(Nc),ho=`
`,Oc="{YYYY}",tc=ho+Oc,Hc="{M}/{D}",Kr=ho+Hc,$s=Kr+"/{YY}",zc="{aa}",hf="{h}:{mm}",yr=hf+zc,ac=ho+yr,rc=":{ss}",_e=null;function Fc(t){let a=t*1e3,r=a*60,s=r*60,n=s*24,o=n*30,l=n*365,d=(t==1?Qr(10,0,3,Is).filter(Ic):Qr(10,-3,0,Is)).concat([a,a*5,a*10,a*15,a*30,r,r*5,r*10,r*15,r*30,s,s*2,s*3,s*4,s*6,s*8,s*12,n,n*2,n*3,n*4,n*5,n*6,n*7,n*8,n*9,n*10,n*15,o,o*2,o*3,o*4,o*6,l,l*2,l*5,l*10,l*25,l*50,l*100]),u=[[l,Oc,_e,_e,_e,_e,_e,_e,1],[n*28,"{MMM}",tc,_e,_e,_e,_e,_e,1],[n,Hc,tc,_e,_e,_e,_e,_e,1],[s,"{h}"+zc,$s,_e,Kr,_e,_e,_e,1],[r,yr,$s,_e,Kr,_e,_e,_e,1],[a,rc,$s+" "+yr,_e,Kr+" "+yr,_e,ac,_e,1],[t,rc+".{fff}",$s+" "+yr,_e,Kr+" "+yr,_e,ac,_e,1]];function y(f){return(v,x,h,A,C,M)=>{let _=[],k=C>=l,S=C>=o&&C<l,O=f(h),P=Ae(O*t,3),H=Qn(O.getFullYear(),k?0:O.getMonth(),S||k?1:O.getDate()),N=Ae(H*t,3);if(S||k){let U=S?C/o:0,j=k?C/l:0,L=P==N?P:Ae(Qn(H.getFullYear()+j,H.getMonth()+U,1)*t,3),q=new Date(Ye(L/t)),G=q.getFullYear(),Z=q.getMonth();for(let Y=0;L<=A;Y++){let E=Qn(G+j*Y,Z+U*Y,1),$=E-f(Ae(E*t,3));L=Ae((+E+$)*t,3),L<=A&&_.push(L)}}else{let U=C>=n?n:C,j=wt(h)-wt(P),L=N+j+Hs(P-N,U);_.push(L);let q=f(L),G=q.getHours()+q.getMinutes()/r+q.getSeconds()/s,Z=C/s,Y=v.axes[x]._space,E=M/Y;for(;L=Ae(L+C,t==1?0:3),!(L>A);)if(Z>1){let $=wt(Ae(G+Z,6))%24,se=f(L).getHours()-$;se>1&&(se=-1),L-=se*s,G=(G+Z)%24;let ge=_[_.length-1];Ae((L-ge)/C,3)*E>=.7&&_.push(L)}else _.push(L)}return _}}return[d,u,y]}var[_f,wf,kf]=Fc(1),[Sf,Cf,Af]=Fc(.001);Qr(2,-53,53,[1]);function sc(t,a){return t.map(r=>r.map((s,n)=>n==0||n==8||s==null?s:a(n==1||r[8]==0?s:r[1]+s)))}function nc(t,a){return(r,s,n,o,l)=>{let i=a.find(h=>l>=h[0])||a[a.length-1],d,u,y,f,v,x;return s.map(h=>{let A=t(h),C=A.getFullYear(),M=A.getMonth(),_=A.getDate(),k=A.getHours(),S=A.getMinutes(),O=A.getSeconds(),P=C!=d&&i[2]||M!=u&&i[3]||_!=y&&i[4]||k!=f&&i[5]||S!=v&&i[6]||O!=x&&i[7]||i[1];return d=C,u=M,y=_,f=k,v=S,x=O,P(A)})}}function Tf(t,a){let r=bo(a);return(s,n,o,l,i)=>n.map(d=>r(t(d)))}function Qn(t,a,r){return new Date(t,a,r)}function oc(t,a){return a(t)}var Mf="{YYYY}-{MM}-{DD} {h}:{mm}{aa}";function lc(t,a){return(r,s,n,o)=>o==null?fo:a(t(s))}function Ef(t,a){let r=t.series[a];return r.width?r.stroke(t,a):r.points.width?r.points.stroke(t,a):null}function $f(t,a){return t.series[a].fill(t,a)}var Pf={show:!0,live:!0,isolate:!1,mount:Kp,markers:{show:!0,width:2,stroke:Ef,fill:$f,dash:"solid"},idx:null,idxs:null,values:[]};function Lf(t,a){let r=t.cursor.points,s=Lt(),n=r.size(t,a);Pe(s,qr,n),Pe(s,Yr,n);let o=n/-2;Pe(s,"marginLeft",o),Pe(s,"marginTop",o);let l=r.width(t,a,n);return l&&Pe(s,"borderWidth",l),s}function Df(t,a){let r=t.series[a].points;return r._fill||r._stroke}function Rf(t,a){let r=t.series[a].points;return r._stroke||r._fill}function If(t,a){return t.series[a].points.size}var Xn=[0,0];function Nf(t,a,r){return Xn[0]=a,Xn[1]=r,Xn}function Ps(t,a,r,s=!0){return n=>{n.button==0&&(!s||n.target==a)&&r(n)}}function eo(t,a,r,s=!0){return n=>{(!s||n.target==a)&&r(n)}}var Of={show:!0,x:!0,y:!0,lock:!1,move:Nf,points:{one:!1,show:Lf,size:If,width:0,stroke:Rf,fill:Df},bind:{mousedown:Ps,mouseup:Ps,click:Ps,dblclick:Ps,mousemove:eo,mouseleave:eo,mouseenter:eo},drag:{setScale:!0,x:!0,y:!1,dist:0,uni:null,click:(t,a)=>{a.stopPropagation(),a.stopImmediatePropagation()},_x:!1,_y:!1},focus:{dist:(t,a,r,s,n)=>s-n,prox:-1,bias:0},hover:{skip:[void 0],prox:null,bias:0},left:-10,top:-10,idx:null,dataIdx:null,idxs:null,event:null},Bc={show:!0,stroke:"rgba(0,0,0,0.07)",width:2},_o=We({},Bc,{filter:Tc}),jc=We({},_o,{size:10}),Uc=We({},Bc,{show:!1}),wo='12px system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"',Wc="bold "+wo,Vc=1.5,ic={show:!0,scale:"x",stroke:po,space:50,gap:5,alignTo:1,size:50,labelGap:0,labelSize:30,labelFont:Wc,side:2,grid:_o,ticks:jc,border:Uc,font:wo,lineGap:Vc,rotate:0},Hf="Value",zf="Time",cc={show:!0,scale:"x",auto:!1,sorted:1,min:Ce,max:-Ce,idxs:[]};function Ff(t,a,r,s,n){return a.map(o=>o==null?"":go(o))}function Bf(t,a,r,s,n,o,l){let i=[],d=ma.get(n)||0;r=l?r:Ae(Hs(r,n),d);for(let u=r;u<=s;u=Ae(u+n,d))i.push(Object.is(u,-0)?0:u);return i}function oo(t,a,r,s,n,o,l){let i=[],d=t.scales[t.axes[a].scale].log,u=d==10?ra:Sc,y=wt(u(r));n=xr(d,y),d==10&&(n=Da[Ft(n,Da)]);let f=r,v=n*d;d==10&&(v=Da[Ft(v,Da)]);do i.push(f),f=f+n,d==10&&!ma.has(f)&&(f=Ae(f,ma.get(n))),f>=v&&(n=f,v=n*d,d==10&&(v=Da[Ft(v,Da)]));while(f<=s);return i}function jf(t,a,r,s,n,o,l){let d=t.scales[t.axes[a].scale].asinh,u=s>d?oo(t,a,pt(d,r),s,n):[d],y=s>=0&&r<=0?[0]:[];return(r<-d?oo(t,a,pt(d,-s),-r,n):[d]).reverse().map(v=>-v).concat(y,u)}var Gc=/./,Uf=/[12357]/,Wf=/[125]/,dc=/1/,lo=(t,a,r,s)=>t.map((n,o)=>a==4&&n==0||o%s==0&&r.test(n.toExponential()[n<0?1:0])?n:null);function Vf(t,a,r,s,n){let o=t.axes[r],l=o.scale,i=t.scales[l],d=t.valToPos,u=o._space,y=d(10,l),f=d(9,l)-y>=u?Gc:d(7,l)-y>=u?Uf:d(5,l)-y>=u?Wf:dc;if(f==dc){let v=Ke(d(1,l)-y);if(v<u)return lo(a.slice().reverse(),i.distr,f,Dt(u/v)).reverse()}return lo(a,i.distr,f,1)}function Gf(t,a,r,s,n){let o=t.axes[r],l=o.scale,i=o._space,d=t.valToPos,u=Ke(d(1,l)-d(2,l));return u<i?lo(a.slice().reverse(),3,Gc,Dt(i/u)).reverse():a}function qf(t,a,r,s){return s==null?fo:a==null?"":go(a)}var uc={show:!0,scale:"y",stroke:po,space:30,gap:5,alignTo:1,size:50,labelGap:0,labelSize:30,labelFont:Wc,side:3,grid:_o,ticks:jc,border:Uc,font:wo,lineGap:Vc,rotate:0};function Yf(t,a){let r=3+(t||1)*2;return Ae(r*a,3)}function Kf(t,a){let{scale:r,idxs:s}=t.series[0],n=t._data[0],o=t.valToPos(n[s[0]],r,!0),l=t.valToPos(n[s[1]],r,!0),i=Ke(l-o),d=t.series[a],u=i/(d.points.space*me);return s[1]-s[0]<=u}var pc={scale:null,auto:!0,sorted:0,min:Ce,max:-Ce},qc=(t,a,r,s,n)=>n,fc={show:!0,auto:!0,sorted:0,gaps:qc,alpha:1,facets:[We({},pc,{scale:"x"}),We({},pc,{scale:"y"})]},vc={scale:"y",auto:!0,sorted:0,show:!0,spanGaps:!1,gaps:qc,alpha:1,points:{show:Kf,filter:null},values:null,min:Ce,max:-Ce,idxs:[],path:null,clip:null};function Jf(t,a,r,s,n){return r/10}var Yc={time:!0,auto:!0,distr:1,log:10,asinh:1,min:null,max:null,dir:1,ori:0},Zf=We({},Yc,{time:!1,ori:1}),mc={};function Kc(t,a){let r=mc[t];return r||(r={key:t,plots:[],sub(s){r.plots.push(s)},unsub(s){r.plots=r.plots.filter(n=>n!=s)},pub(s,n,o,l,i,d,u){for(let y=0;y<r.plots.length;y++)r.plots[y]!=n&&r.plots[y].pub(s,n,o,l,i,d,u)}},t!=null&&(mc[t]=r)),r}var _r=1,io=2;function Oa(t,a,r){let s=t.mode,n=t.series[a],o=s==2?t._data[a]:t._data,l=t.scales,i=t.bbox,d=o[0],u=s==2?o[1]:o[a],y=s==2?l[n.facets[0].scale]:l[t.series[0].scale],f=s==2?l[n.facets[1].scale]:l[n.scale],v=i.left,x=i.top,h=i.width,A=i.height,C=t.valToPosH,M=t.valToPosV;return y.ori==0?r(n,d,u,y,f,C,M,v,x,h,A,Bs,kr,Us,Zc,Xc):r(n,d,u,y,f,M,C,x,v,A,h,js,Sr,Co,Qc,ed)}function ko(t,a){let r=0,s=0,n=ue(t.bands,xo);for(let o=0;o<n.length;o++){let l=n[o];l.series[0]==a?r=l.dir:l.series[1]==a&&(l.dir==1?s|=1:s|=2)}return[r,s==1?-1:s==2?1:s==3?2:0]}function Qf(t,a,r,s,n){let o=t.mode,l=t.series[a],i=o==2?l.facets[1].scale:l.scale,d=t.scales[i];return n==-1?d.min:n==1?d.max:d.distr==3?d.dir==1?d.min:d.max:0}function sa(t,a,r,s,n,o){return Oa(t,a,(l,i,d,u,y,f,v,x,h,A,C)=>{let M=l.pxRound,_=u.dir*(u.ori==0?1:-1),k=u.ori==0?kr:Sr,S,O;_==1?(S=r,O=s):(S=s,O=r);let P=M(f(i[S],u,A,x)),H=M(v(d[S],y,C,h)),N=M(f(i[O],u,A,x)),U=M(v(o==1?y.max:y.min,y,C,h)),j=new Path2D(n);return k(j,N,U),k(j,P,U),k(j,P,H),j})}function Fs(t,a,r,s,n,o){let l=null;if(t.length>0){l=new Path2D;let i=a==0?Us:Co,d=r;for(let f=0;f<t.length;f++){let v=t[f];if(v[1]>v[0]){let x=v[0]-d;x>0&&i(l,d,s,x,s+o),d=v[1]}}let u=r+n-d,y=10;u>0&&i(l,d,s-y/2,u,s+o+y)}return l}function Xf(t,a,r){let s=t[t.length-1];s&&s[0]==a?s[1]=r:t.push([a,r])}function So(t,a,r,s,n,o,l){let i=[],d=t.length;for(let u=n==1?r:s;u>=r&&u<=s;u+=n)if(a[u]===null){let f=u,v=u;if(n==1)for(;++u<=s&&a[u]===null;)v=u;else for(;--u>=r&&a[u]===null;)v=u;let x=o(t[f]),h=v==f?x:o(t[v]),A=f-n;x=l<=0&&A>=0&&A<d?o(t[A]):x;let M=v+n;h=l>=0&&M>=0&&M<d?o(t[M]):h,h>=x&&i.push([x,h])}return i}function yc(t){return t==0?Ac:t==1?Ye:a=>La(a,t)}function Jc(t){let a=t==0?Bs:js,r=t==0?(n,o,l,i,d,u)=>{n.arcTo(o,l,i,d,u)}:(n,o,l,i,d,u)=>{n.arcTo(l,o,d,i,u)},s=t==0?(n,o,l,i,d)=>{n.rect(o,l,i,d)}:(n,o,l,i,d)=>{n.rect(l,o,d,i)};return(n,o,l,i,d,u=0,y=0)=>{u==0&&y==0?s(n,o,l,i,d):(u=Bt(u,i/2,d/2),y=Bt(y,i/2,d/2),a(n,o+u,l),r(n,o+i,l,o+i,l+d,u),r(n,o+i,l+d,o,l+d,y),r(n,o,l+d,o,l,y),r(n,o,l,o+i,l,u),n.closePath())}}var Bs=(t,a,r)=>{t.moveTo(a,r)},js=(t,a,r)=>{t.moveTo(r,a)},kr=(t,a,r)=>{t.lineTo(a,r)},Sr=(t,a,r)=>{t.lineTo(r,a)},Us=Jc(0),Co=Jc(1),Zc=(t,a,r,s,n,o)=>{t.arc(a,r,s,n,o)},Qc=(t,a,r,s,n,o)=>{t.arc(r,a,s,n,o)},Xc=(t,a,r,s,n,o,l)=>{t.bezierCurveTo(a,r,s,n,o,l)},ed=(t,a,r,s,n,o,l)=>{t.bezierCurveTo(r,a,n,s,l,o)};function td(t){return(a,r,s,n,o)=>Oa(a,r,(l,i,d,u,y,f,v,x,h,A,C)=>{let{pxRound:M,points:_}=l,k,S;u.ori==0?(k=Bs,S=Zc):(k=js,S=Qc);let O=Ae(_.width*me,3),P=(_.size-_.width)/2*me,H=Ae(P*2,3),N=new Path2D,U=new Path2D,{left:j,top:L,width:q,height:G}=a.bbox;Us(U,j-H,L-H,q+H*2,G+H*2);let Z=Y=>{if(d[Y]!=null){let E=M(f(i[Y],u,A,x)),$=M(v(d[Y],y,C,h));k(N,E+P,$),S(N,E,$,P,0,Ls*2)}};if(o)o.forEach(Z);else for(let Y=s;Y<=n;Y++)Z(Y);return{stroke:O>0?N:null,fill:N,clip:U,flags:_r|io}})}function ad(t){return(a,r,s,n,o,l)=>{s!=n&&(o!=s&&l!=s&&t(a,r,s),o!=n&&l!=n&&t(a,r,n),t(a,r,l))}}var ev=ad(kr),tv=ad(Sr);function rd(t){let a=ue(t?.alignGaps,0);return(r,s,n,o)=>Oa(r,s,(l,i,d,u,y,f,v,x,h,A,C)=>{[n,o]=Ns(d,n,o);let M=l.pxRound,_=G=>M(f(G,u,A,x)),k=G=>M(v(G,y,C,h)),S,O;u.ori==0?(S=kr,O=ev):(S=Sr,O=tv);let P=u.dir*(u.ori==0?1:-1),H={stroke:new Path2D,fill:null,clip:null,band:null,gaps:null,flags:_r},N=H.stroke,U=!1;if(o-n>=A*4){let G=K=>r.posToVal(K,u.key,!0),Z=null,Y=null,E,$,re,we=_(i[P==1?n:o]),se=_(i[n]),ge=_(i[o]),ae=G(P==1?se+1:ge-1);for(let K=P==1?n:o;K>=n&&K<=o;K+=P){let Ve=i[K],Le=(P==1?Ve<ae:Ve>ae)?we:_(Ve),xe=d[K];Le==we?xe!=null?($=xe,Z==null?(S(N,Le,k($)),E=Z=Y=$):$<Z?Z=$:$>Y&&(Y=$)):xe===null&&(U=!0):(Z!=null&&O(N,we,k(Z),k(Y),k(E),k($)),xe!=null?($=xe,S(N,Le,k($)),Z=Y=E=$):(Z=Y=null,xe===null&&(U=!0)),we=Le,ae=G(we+P))}Z!=null&&Z!=Y&&re!=we&&O(N,we,k(Z),k(Y),k(E),k($))}else for(let G=P==1?n:o;G>=n&&G<=o;G+=P){let Z=d[G];Z===null?U=!0:Z!=null&&S(N,_(i[G]),k(Z))}let[L,q]=ko(r,s);if(l.fill!=null||L!=0){let G=H.fill=new Path2D(N),Z=l.fillTo(r,s,l.min,l.max,L),Y=k(Z),E=_(i[n]),$=_(i[o]);P==-1&&([$,E]=[E,$]),S(G,$,Y),S(G,E,Y)}if(!l.spanGaps){let G=[];U&&G.push(...So(i,d,n,o,P,_,a)),H.gaps=G=l.gaps(r,s,n,o,G),H.clip=Fs(G,u.ori,x,h,A,C)}return q!=0&&(H.band=q==2?[sa(r,s,n,o,N,-1),sa(r,s,n,o,N,1)]:sa(r,s,n,o,N,q)),H})}function av(t){let a=ue(t.align,1),r=ue(t.ascDesc,!1),s=ue(t.alignGaps,0),n=ue(t.extend,!1);return(o,l,i,d)=>Oa(o,l,(u,y,f,v,x,h,A,C,M,_,k)=>{[i,d]=Ns(f,i,d);let S=u.pxRound,{left:O,width:P}=o.bbox,H=se=>S(h(se,v,_,C)),N=se=>S(A(se,x,k,M)),U=v.ori==0?kr:Sr,j={stroke:new Path2D,fill:null,clip:null,band:null,gaps:null,flags:_r},L=j.stroke,q=v.dir*(v.ori==0?1:-1),G=N(f[q==1?i:d]),Z=H(y[q==1?i:d]),Y=Z,E=Z;n&&a==-1&&(E=O,U(L,E,G)),U(L,Z,G);for(let se=q==1?i:d;se>=i&&se<=d;se+=q){let ge=f[se];if(ge==null)continue;let ae=H(y[se]),K=N(ge);a==1?U(L,ae,G):U(L,Y,K),U(L,ae,K),G=K,Y=ae}let $=Y;n&&a==1&&($=O+P,U(L,$,G));let[re,we]=ko(o,l);if(u.fill!=null||re!=0){let se=j.fill=new Path2D(L),ge=u.fillTo(o,l,u.min,u.max,re),ae=N(ge);U(se,$,ae),U(se,E,ae)}if(!u.spanGaps){let se=[];se.push(...So(y,f,i,d,q,H,s));let ge=u.width*me/2,ae=r||a==1?ge:-ge,K=r||a==-1?-ge:ge;se.forEach(Ve=>{Ve[0]+=ae,Ve[1]+=K}),j.gaps=se=u.gaps(o,l,i,d,se),j.clip=Fs(se,v.ori,C,M,_,k)}return we!=0&&(j.band=we==2?[sa(o,l,i,d,L,-1),sa(o,l,i,d,L,1)]:sa(o,l,i,d,L,we)),j})}function gc(t,a,r,s,n,o,l=Ce){if(t.length>1){let i=null;for(let d=0,u=1/0;d<t.length;d++)if(a[d]!==void 0){if(i!=null){let y=Ke(t[d]-t[i]);y<u&&(u=y,l=Ke(r(t[d],s,n,o)-r(t[i],s,n,o)))}i=d}}return l}function rv(t){t=t||Zr;let a=ue(t.size,[.6,Ce,1]),r=t.align||0,s=t.gap||0,n=t.radius;n=n==null?[0,0]:typeof n=="number"?[n,0]:n;let o=le(n),l=1-a[0],i=ue(a[1],Ce),d=ue(a[2],1),u=ue(t.disp,Zr),y=ue(t.each,x=>{}),{fill:f,stroke:v}=u;return(x,h,A,C)=>Oa(x,h,(M,_,k,S,O,P,H,N,U,j,L)=>{let q=M.pxRound,G=r,Z=s*me,Y=i*me,E=d*me,$,re;S.ori==0?[$,re]=o(x,h):[re,$]=o(x,h);let we=S.dir*(S.ori==0?1:-1),se=S.ori==0?Us:Co,ge=S.ori==0?y:(W,Te,Ge,Va,xa,Ut,ba)=>{y(W,Te,Ge,xa,Va,ba,Ut)},ae=ue(x.bands,xo).find(W=>W.series[0]==h),K=ae!=null?ae.dir:0,Ve=M.fillTo(x,h,M.min,M.max,K),ot=q(H(Ve,O,L,U)),Le,xe,Rt,mt=j,Ne=q(M.width*me),jt=!1,Xt=null,Ct=null,na=null,ja=null;f!=null&&(Ne==0||v!=null)&&(jt=!0,Xt=f.values(x,h,A,C),Ct=new Map,new Set(Xt).forEach(W=>{W!=null&&Ct.set(W,new Path2D)}),Ne>0&&(na=v.values(x,h,A,C),ja=new Map,new Set(na).forEach(W=>{W!=null&&ja.set(W,new Path2D)})));let{x0:Ua,size:Mr}=u;if(Ua!=null&&Mr!=null){G=1,_=Ua.values(x,h,A,C),Ua.unit==2&&(_=_.map(Ge=>x.posToVal(N+Ge*j,S.key,!0)));let W=Mr.values(x,h,A,C);Mr.unit==2?xe=W[0]*j:xe=P(W[0],S,j,N)-P(0,S,j,N),mt=gc(_,k,P,S,j,N,mt),Rt=mt-xe+Z}else mt=gc(_,k,P,S,j,N,mt),Rt=mt*l+Z,xe=mt-Rt;Rt<1&&(Rt=0),Ne>=xe/2&&(Ne=0),Rt<5&&(q=Ac);let ns=Rt>0,ya=mt-Rt-(ns?Ne:0);xe=q(no(ya,E,Y)),Le=(G==0?xe/2:G==we?0:xe)-G*we*((G==0?Z/2:0)+(ns?Ne/2:0));let lt={stroke:null,fill:null,clip:null,band:null,gaps:null,flags:0},Wa=jt?null:new Path2D,ea=null;if(ae!=null)ea=x.data[ae.series[1]];else{let{y0:W,y1:Te}=u;W!=null&&Te!=null&&(k=Te.values(x,h,A,C),ea=W.values(x,h,A,C))}let ga=$*xe,te=re*xe;for(let W=we==1?A:C;W>=A&&W<=C;W+=we){let Te=k[W];if(Te==null)continue;if(ea!=null){let ft=ea[W]??0;if(Te-ft==0)continue;ot=H(ft,O,L,U)}let Ge=S.distr!=2||u!=null?_[W]:W,Va=P(Ge,S,j,N),xa=H(ue(Te,Ve),O,L,U),Ut=q(Va-Le),ba=q(pt(xa,ot)),yt=q(Bt(xa,ot)),At=ba-yt;if(Te!=null){let ft=Te<0?te:ga,It=Te<0?ga:te;jt?(Ne>0&&na[W]!=null&&se(ja.get(na[W]),Ut,yt+wt(Ne/2),xe,pt(0,At-Ne),ft,It),Xt[W]!=null&&se(Ct.get(Xt[W]),Ut,yt+wt(Ne/2),xe,pt(0,At-Ne),ft,It)):se(Wa,Ut,yt+wt(Ne/2),xe,pt(0,At-Ne),ft,It),ge(x,h,W,Ut-Ne/2,yt,xe+Ne,At)}}return Ne>0?lt.stroke=jt?ja:Wa:jt||(lt._fill=M.width==0?M._fill:M._stroke??M._fill,lt.width=0),lt.fill=jt?Ct:Wa,lt})}function sv(t,a){let r=ue(a?.alignGaps,0);return(s,n,o,l)=>Oa(s,n,(i,d,u,y,f,v,x,h,A,C,M)=>{[o,l]=Ns(u,o,l);let _=i.pxRound,k=$=>_(v($,y,C,h)),S=$=>_(x($,f,M,A)),O,P,H;y.ori==0?(O=Bs,H=kr,P=Xc):(O=js,H=Sr,P=ed);let N=y.dir*(y.ori==0?1:-1),U=k(d[N==1?o:l]),j=U,L=[],q=[];for(let $=N==1?o:l;$>=o&&$<=l;$+=N)if(u[$]!=null){let we=d[$],se=k(we);L.push(j=se),q.push(S(u[$]))}let G={stroke:t(L,q,O,H,P,_),fill:null,clip:null,band:null,gaps:null,flags:_r},Z=G.stroke,[Y,E]=ko(s,n);if(i.fill!=null||Y!=0){let $=G.fill=new Path2D(Z),re=i.fillTo(s,n,i.min,i.max,Y),we=S(re);H($,j,we),H($,U,we)}if(!i.spanGaps){let $=[];$.push(...So(d,u,o,l,N,k,r)),G.gaps=$=i.gaps(s,n,o,l,$),G.clip=Fs($,y.ori,h,A,C,M)}return E!=0&&(G.band=E==2?[sa(s,n,o,l,Z,-1),sa(s,n,o,l,Z,1)]:sa(s,n,o,l,Z,E)),G})}function nv(t){return sv(ov,t)}function ov(t,a,r,s,n,o){let l=t.length;if(l<2)return null;let i=new Path2D;if(r(i,t[0],a[0]),l==2)s(i,t[1],a[1]);else{let d=Array(l),u=Array(l-1),y=Array(l-1),f=Array(l-1);for(let v=0;v<l-1;v++)y[v]=a[v+1]-a[v],f[v]=t[v+1]-t[v],u[v]=y[v]/f[v];d[0]=u[0];for(let v=1;v<l-1;v++)u[v]===0||u[v-1]===0||u[v-1]>0!=u[v]>0?d[v]=0:(d[v]=3*(f[v-1]+f[v])/((2*f[v]+f[v-1])/u[v-1]+(f[v]+2*f[v-1])/u[v]),isFinite(d[v])||(d[v]=0));d[l-1]=u[l-2];for(let v=0;v<l-1;v++)n(i,t[v]+f[v]/3,a[v]+d[v]*f[v]/3,t[v+1]-f[v]/3,a[v+1]-d[v+1]*f[v]/3,t[v+1],a[v+1])}return i}var co=new Set;function xc(){for(let t of co)t.syncRect(!0)}wr&&(Ia(zp,gr,xc),Ia(Fp,gr,xc,!0),Ia(Ds,gr,()=>{st.pxRatio=me}));var lv=rd(),iv=td();function bc(t,a,r,s){return(s?[t[0],t[1]].concat(t.slice(2)):[t[0]].concat(t.slice(1))).map((o,l)=>uo(o,l,a,r))}function cv(t,a){return t.map((r,s)=>s==0?{}:We({},a,r))}function uo(t,a,r,s){return We({},a==0?r:s,t)}function sd(t,a,r){return a==null?br:[a,r]}var dv=sd;function uv(t,a,r){return a==null?br:Rs(a,r,yo,!0)}function nd(t,a,r,s){return a==null?br:Os(a,r,t.scales[s].log,!1)}var pv=nd;function od(t,a,r,s){return a==null?br:mo(a,r,t.scales[s].log,!1)}var fv=od;function vv(t,a,r,s,n){let o=pt(Zi(t),Zi(a)),l=a-t,i=Ft(n/s*l,r);do{let d=r[i],u=s*d/l;if(u>=n&&o+(d<5?ma.get(d):0)<=17)return[d,u]}while(++i<r.length);return[0,0]}function hc(t){let a,r;return t=t.replace(/(\d+)px/,(s,n)=>(a=Ye((r=+n)*me))+"px"),[t,a,r]}function mv(t){t.show&&[t.font,t.labelFont].forEach(a=>{let r=Ae(a[2]*me,1);a[0]=a[0].replace(/[0-9.]+px/,r+"px"),a[1]=r})}function st(t,a,r){let s={mode:ue(t.mode,1)},n=s.mode;function o(c,p,m,g){let b=p.valToPct(c);return g+m*(p.dir==-1?1-b:b)}function l(c,p,m,g){let b=p.valToPct(c);return g+m*(p.dir==-1?b:1-b)}function i(c,p,m,g){return p.ori==0?o(c,p,m,g):l(c,p,m,g)}s.valToPosH=o,s.valToPosV=l;let d=!1;s.status=0;let u=s.root=Lt(_p);if(t.id!=null&&(u.id=t.id),_t(u,t.class),t.title){let c=Lt(Sp,u);c.textContent=t.title}let y=zt("canvas"),f=s.ctx=y.getContext("2d"),v=Lt(Cp,u);Ia("click",v,c=>{c.target===h&&(Me!=ar||De!=rr)&&rt.click(s,c)},!0);let x=s.under=Lt(Ap,v);v.appendChild(y);let h=s.over=Lt(Tp,v);t=hr(t);let A=+ue(t.pxAlign,1),C=yc(A);(t.plugins||[]).forEach(c=>{c.opts&&(t=c.opts(s,t)||t)});let M=t.ms||.001,_=s.series=n==1?bc(t.series||[],cc,vc,!1):cv(t.series||[null],fc),k=s.axes=bc(t.axes||[],ic,uc,!0),S=s.scales={},O=s.bands=t.bands||[];O.forEach(c=>{c.fill=le(c.fill||null),c.dir=ue(c.dir,-1)});let P=n==2?_[1].facets[0].scale:_[0].scale,H={axes:du,series:nu},N=(t.drawOrder||["axes","series"]).map(c=>H[c]);function U(c){let p=c.distr==3?m=>ra(m>0?m:c.clamp(s,m,c.min,c.max,c.key)):c.distr==4?m=>Zn(m,c.asinh):c.distr==100?m=>c.fwd(m):m=>m;return m=>{let g=p(m),{_min:b,_max:w}=c,T=w-b;return(g-b)/T}}function j(c){let p=S[c];if(p==null){let m=(t.scales||Zr)[c]||Zr;if(m.from!=null){j(m.from);let g=We({},S[m.from],m,{key:c});g.valToPct=U(g),S[c]=g}else{p=S[c]=We({},c==P?Yc:Zf,m),p.key=c;let g=p.time,b=p.range,w=va(b);if((c!=P||n==2&&!g)&&(w&&(b[0]==null||b[1]==null)&&(b={min:b[0]==null?Yi:{mode:1,hard:b[0],soft:b[0]},max:b[1]==null?Yi:{mode:1,hard:b[1],soft:b[1]}},w=!1),!w&&zs(b))){let T=b;b=(D,R,z)=>R==null?br:Rs(R,z,T)}p.range=le(b||(g?dv:c==P?p.distr==3?pv:p.distr==4?fv:sd:p.distr==3?nd:p.distr==4?od:uv)),p.auto=le(w?!1:p.auto),p.clamp=le(p.clamp||Jf),p._min=p._max=null,p.valToPct=U(p)}}}j("x"),j("y"),n==1&&_.forEach(c=>{j(c.scale)}),k.forEach(c=>{j(c.scale)});for(let c in t.scales)j(c);let L=S[P],q=L.distr,G,Z;L.ori==0?(_t(u,wp),G=o,Z=l):(_t(u,kp),G=l,Z=o);let Y={};for(let c in S){let p=S[c];(p.min!=null||p.max!=null)&&(Y[c]={min:p.min,max:p.max},p.min=p.max=null)}let E=t.tzDate||(c=>new Date(Ye(c/M))),$=t.fmtDate||bo,re=M==1?kf(E):Af(E),we=nc(E,sc(M==1?wf:Cf,$)),se=lc(E,oc(Mf,$)),ge=[],ae=s.legend=We({},Pf,t.legend),K=s.cursor=We({},Of,{drag:{y:n==2}},t.cursor),Ve=ae.show,ot=K.show,Le=ae.markers;ae.idxs=ge,Le.width=le(Le.width),Le.dash=le(Le.dash),Le.stroke=le(Le.stroke),Le.fill=le(Le.fill);let xe,Rt,mt,Ne=[],jt=[],Xt,Ct=!1,na={};if(ae.live){let c=_[1]?_[1].values:null;Ct=c!=null,Xt=Ct?c(s,1,0):{_:0};for(let p in Xt)na[p]=fo}if(Ve)if(xe=zt("table",Dp,u),mt=zt("tbody",null,xe),ae.mount(s,xe),Ct){Rt=zt("thead",null,xe,mt);let c=zt("tr",null,Rt);zt("th",null,c);for(var ja in Xt)zt("th",Ii,c).textContent=ja}else _t(xe,Ip),ae.live&&_t(xe,Rp);let Ua={show:!0},Mr={show:!1};function ns(c,p){if(p==0&&(Ct||!ae.live||n==2))return br;let m=[],g=zt("tr",Np,mt,mt.childNodes[p]);_t(g,c.class),c.show||_t(g,Ra);let b=zt("th",null,g);if(Le.show){let D=Lt(Op,b);if(p>0){let R=Le.width(s,p);R&&(D.style.border=R+"px "+Le.dash(s,p)+" "+Le.stroke(s,p)),D.style.background=Le.fill(s,p)}}let w=Lt(Ii,b);c.label instanceof HTMLElement?w.appendChild(c.label):w.textContent=c.label,p>0&&(Le.show||(w.style.color=c.width>0?Le.stroke(s,p):Le.fill(s,p)),lt("click",b,D=>{if(K._lock)return;_a(D);let R=_.indexOf(c);if((D.ctrlKey||D.metaKey)!=ae.isolate){let z=_.some((F,V)=>V>0&&V!=R&&F.show);_.forEach((F,V)=>{V>0&&Vt(V,z?V==R?Ua:Mr:Ua,!0,je.setSeries)})}else Vt(R,{show:!c.show},!0,je.setSeries)},!1),qa&&lt(zi,b,D=>{K._lock||(_a(D),Vt(_.indexOf(c),nr,!0,je.setSeries))},!1));for(var T in Xt){let D=zt("td",Hp,g);D.textContent="--",m.push(D)}return[g,m]}let ya=new Map;function lt(c,p,m,g=!0){let b=ya.get(p)||{},w=K.bind[c](s,p,m,g);w&&(Ia(c,p,b[c]=w),ya.set(p,b))}function Wa(c,p,m){let g=ya.get(p)||{};for(let b in g)(c==null||b==c)&&(so(b,p,g[b]),delete g[b]);c==null&&ya.delete(p)}let ea=0,ga=0,te=0,W=0,Te=0,Ge=0,Va=Te,xa=Ge,Ut=te,ba=W,yt=0,At=0,ft=0,It=0;s.bbox={};let Zs=!1,os=!1,Ga=!1,ha=!1,ls=!1,Tt=!1;function Qs(c,p,m){(m||c!=s.width||p!=s.height)&&ll(c,p),Qa(!1),Ga=!0,os=!0,Xa()}function ll(c,p){s.width=ea=te=c,s.height=ga=W=p,Te=Ge=0,Qd(),Xd();let m=s.bbox;yt=m.left=La(Te*me,.5),At=m.top=La(Ge*me,.5),ft=m.width=La(te*me,.5),It=m.height=La(W*me,.5)}let Kd=3;function Jd(){let c=!1,p=0;for(;!c;){p++;let m=iu(p),g=cu(p);c=p==Kd||m&&g,c||(ll(s.width,s.height),os=!0)}}function Zd({width:c,height:p}){Qs(c,p)}s.setSize=Zd;function Qd(){let c=!1,p=!1,m=!1,g=!1;k.forEach((b,w)=>{if(b.show&&b._show){let{side:T,_size:D}=b,R=T%2,z=b.label!=null?b.labelSize:0,F=D+z;F>0&&(R?(te-=F,T==3?(Te+=F,g=!0):m=!0):(W-=F,T==0?(Ge+=F,c=!0):p=!0))}}),wa[0]=c,wa[1]=m,wa[2]=p,wa[3]=g,te-=oa[1]+oa[3],Te+=oa[3],W-=oa[2]+oa[0],Ge+=oa[0]}function Xd(){let c=Te+te,p=Ge+W,m=Te,g=Ge;function b(w,T){switch(w){case 1:return c+=T,c-T;case 2:return p+=T,p-T;case 3:return m-=T,m+T;case 0:return g-=T,g+T}}k.forEach((w,T)=>{if(w.show&&w._show){let D=w.side;w._pos=b(D,w._size),w.label!=null&&(w._lpos=b(D,w.labelSize))}})}if(K.dataIdx==null){let c=K.hover,p=c.skip=new Set(c.skip??[]);p.add(void 0);let m=c.prox=le(c.prox),g=c.bias??=0;K.dataIdx=(b,w,T,D)=>{if(w==0)return T;let R=T,z=m(b,w,T,D)??Ce,F=z>=0&&z<Ce,V=L.ori==0?te:W,X=K.left,pe=a[0],de=a[w];if(p.has(de[T])){R=null;let ne=null,Q=null,J;if(g==0||g==-1)for(J=T;ne==null&&J-- >0;)p.has(de[J])||(ne=J);if(g==0||g==1)for(J=T;Q==null&&J++<de.length;)p.has(de[J])||(Q=J);if(ne!=null||Q!=null)if(F){let $e=ne==null?-1/0:G(pe[ne],L,V,0),He=Q==null?1/0:G(pe[Q],L,V,0),tt=X-$e,Se=He-X;tt<=Se?tt<=z&&(R=ne):Se<=z&&(R=Q)}else R=Q==null?ne:ne==null?Q:T-ne<=Q-T?ne:Q}else F&&Ke(X-G(pe[T],L,V,0))>z&&(R=null);return R}}let _a=c=>{K.event=c};K.idxs=ge,K._lock=!1;let nt=K.points;nt.show=le(nt.show),nt.size=le(nt.size),nt.stroke=le(nt.stroke),nt.width=le(nt.width),nt.fill=le(nt.fill);let Wt=s.focus=We({},t.focus||{alpha:.3},K.focus),qa=Wt.prox>=0,Ya=qa&&nt.one,Mt=[],Ka=[],Ja=[];function il(c,p){let m=nt.show(s,p);if(m instanceof HTMLElement)return _t(m,Lp),_t(m,c.class),Zt(m,-10,-10,te,W),h.insertBefore(m,Mt[p]),m}function cl(c,p){if(n==1||p>0){let m=n==1&&S[c.scale].time,g=c.value;c.value=m?ec(g)?lc(E,oc(g,$)):g||se:g||qf,c.label=c.label||(m?zf:Hf)}if(Ya||p>0){c.width=c.width==null?1:c.width,c.paths=c.paths||lv||Jp,c.fillTo=le(c.fillTo||Qf),c.pxAlign=+ue(c.pxAlign,A),c.pxRound=yc(c.pxAlign),c.stroke=le(c.stroke||null),c.fill=le(c.fill||null),c._stroke=c._fill=c._paths=c._focus=null;let m=Yf(pt(1,c.width),1),g=c.points=We({},{size:m,width:pt(1,m*.2),stroke:c.stroke,space:m*2,paths:iv,_stroke:null,_fill:null},c.points);g.show=le(g.show),g.filter=le(g.filter),g.fill=le(g.fill),g.stroke=le(g.stroke),g.paths=le(g.paths),g.pxAlign=c.pxAlign}if(Ve){let m=ns(c,p);Ne.splice(p,0,m[0]),jt.splice(p,0,m[1]),ae.values.push(null)}if(ot){ge.splice(p,0,null);let m=null;Ya?p==0&&(m=il(c,p)):p>0&&(m=il(c,p)),Mt.splice(p,0,m),Ka.splice(p,0,0),Ja.splice(p,0,0)}et("addSeries",p)}function eu(c,p){p=p??_.length,c=n==1?uo(c,p,cc,vc):uo(c,p,{},fc),_.splice(p,0,c),cl(_[p],p)}s.addSeries=eu;function tu(c){if(_.splice(c,1),Ve){ae.values.splice(c,1),jt.splice(c,1);let p=Ne.splice(c,1)[0];Wa(null,p.firstChild),p.remove()}ot&&(ge.splice(c,1),Mt.splice(c,1)[0].remove(),Ka.splice(c,1),Ja.splice(c,1)),et("delSeries",c)}s.delSeries=tu;let wa=[!1,!1,!1,!1];function au(c,p){if(c._show=c.show,c.show){let m=c.side%2,g=S[c.scale];g==null&&(c.scale=m?_[1].scale:P,g=S[c.scale]);let b=g.time;c.size=le(c.size),c.space=le(c.space),c.rotate=le(c.rotate),va(c.incrs)&&c.incrs.forEach(T=>{!ma.has(T)&&ma.set(T,Ec(T))}),c.incrs=le(c.incrs||(g.distr==2?bf:b?M==1?_f:Sf:Da)),c.splits=le(c.splits||(b&&g.distr==1?re:g.distr==3?oo:g.distr==4?jf:Bf)),c.stroke=le(c.stroke),c.grid.stroke=le(c.grid.stroke),c.ticks.stroke=le(c.ticks.stroke),c.border.stroke=le(c.border.stroke);let w=c.values;c.values=va(w)&&!va(w[0])?le(w):b?va(w)?nc(E,sc(w,$)):ec(w)?Tf(E,w):w||we:w||Ff,c.filter=le(c.filter||(g.distr>=3&&g.log==10?Vf:g.distr==3&&g.log==2?Gf:Tc)),c.font=hc(c.font),c.labelFont=hc(c.labelFont),c._size=c.size(s,null,p,0),c._space=c._rotate=c._incrs=c._found=c._splits=c._values=null,c._size>0&&(wa[p]=!0,c._el=Lt(Mp,v))}}function Er(c,p,m,g){let[b,w,T,D]=m,R=p%2,z=0;return R==0&&(D||w)&&(z=p==0&&!b||p==2&&!T?Ye(ic.size/3):0),R==1&&(b||T)&&(z=p==1&&!w||p==3&&!D?Ye(uc.size/2):0),z}let dl=s.padding=(t.padding||[Er,Er,Er,Er]).map(c=>le(ue(c,Er))),oa=s._padding=dl.map((c,p)=>c(s,p,wa,0)),at,Je=null,Ze=null,is=n==1?_[0].idxs:null,Nt=null,$r=!1;function ul(c,p){if(a=c??[],s.data=s._data=a,n==2){at=0;for(let m=1;m<_.length;m++)at+=a[m][0].length}else{a.length==0&&(s.data=s._data=a=[[]]),Nt=a[0],at=Nt.length;let m=a;if(q==2){m=a.slice();let g=m[0]=Array(at);for(let b=0;b<at;b++)g[b]=b}s._data=a=m}if(Qa(!0),et("setData"),q==2&&(Ga=!0),p!==!1){let m=L;m.auto(s,$r)?Xs():ia(P,m.min,m.max),ha=ha||K.left>=0,Tt=!0,Xa()}}s.setData=ul;function Xs(){$r=!0;let c,p;n==1&&(at>0?(Je=is[0]=0,Ze=is[1]=at-1,c=a[0][Je],p=a[0][Ze],q==2?(c=Je,p=Ze):c==p&&(q==3?[c,p]=Os(c,c,L.log,!1):q==4?[c,p]=mo(c,c,L.log,!1):L.time?p=c+Ye(86400/M):[c,p]=Rs(c,p,yo,!0))):(Je=is[0]=c=null,Ze=is[1]=p=null)),ia(P,c,p)}let cs,Za,en,tn,an,rn,sn,nn,on,vt;function pl(c,p,m,g,b,w){c??=Oi,m??=xo,g??="butt",b??=Oi,w??="round",c!=cs&&(f.strokeStyle=cs=c),b!=Za&&(f.fillStyle=Za=b),p!=en&&(f.lineWidth=en=p),w!=an&&(f.lineJoin=an=w),g!=rn&&(f.lineCap=rn=g),m!=tn&&f.setLineDash(tn=m)}function fl(c,p,m,g){p!=Za&&(f.fillStyle=Za=p),c!=sn&&(f.font=sn=c),m!=nn&&(f.textAlign=nn=m),g!=on&&(f.textBaseline=on=g)}function ln(c,p,m,g,b=0){if(g.length>0&&c.auto(s,$r)&&(p==null||p.min==null)){let w=ue(Je,0),T=ue(Ze,g.length-1),D=m.min==null?Wp(g,w,T,b,c.distr==3):[m.min,m.max];c.min=Bt(c.min,m.min=D[0]),c.max=pt(c.max,m.max=D[1])}}let vl={min:null,max:null};function ru(){for(let g in S){let b=S[g];Y[g]==null&&(b.min==null||Y[P]!=null&&b.auto(s,$r))&&(Y[g]=vl)}for(let g in S){let b=S[g];Y[g]==null&&b.from!=null&&Y[b.from]!=null&&(Y[g]=vl)}Y[P]!=null&&Qa(!0);let c={};for(let g in Y){let b=Y[g];if(b!=null){let w=c[g]=hr(S[g],Xp);if(b.min!=null)We(w,b);else if(g!=P||n==2)if(at==0&&w.from==null){let T=w.range(s,null,null,g);w.min=T[0],w.max=T[1]}else w.min=Ce,w.max=-Ce}}if(at>0){_.forEach((g,b)=>{if(n==1){let w=g.scale,T=Y[w];if(T==null)return;let D=c[w];if(b==0){let R=D.range(s,D.min,D.max,w);D.min=R[0],D.max=R[1],Je=Ft(D.min,a[0]),Ze=Ft(D.max,a[0]),Ze-Je>1&&(a[0][Je]<D.min&&Je++,a[0][Ze]>D.max&&Ze--),g.min=Nt[Je],g.max=Nt[Ze]}else g.show&&g.auto&&ln(D,T,g,a[b],g.sorted);g.idxs[0]=Je,g.idxs[1]=Ze}else if(b>0&&g.show&&g.auto){let[w,T]=g.facets,D=w.scale,R=T.scale,[z,F]=a[b],V=c[D],X=c[R];V!=null&&ln(V,Y[D],w,z,w.sorted),X!=null&&ln(X,Y[R],T,F,T.sorted),g.min=T.min,g.max=T.max}});for(let g in c){let b=c[g],w=Y[g];if(b.from==null&&(w==null||w.min==null)){let T=b.range(s,b.min==Ce?null:b.min,b.max==-Ce?null:b.max,g);b.min=T[0],b.max=T[1]}}}for(let g in c){let b=c[g];if(b.from!=null){let w=c[b.from];if(w.min==null)b.min=b.max=null;else{let T=b.range(s,w.min,w.max,g);b.min=T[0],b.max=T[1]}}}let p={},m=!1;for(let g in c){let b=c[g],w=S[g];if(w.min!=b.min||w.max!=b.max){w.min=b.min,w.max=b.max;let T=w.distr;w._min=T==3?ra(w.min):T==4?Zn(w.min,w.asinh):T==100?w.fwd(w.min):w.min,w._max=T==3?ra(w.max):T==4?Zn(w.max,w.asinh):T==100?w.fwd(w.max):w.max,p[g]=m=!0}}if(m){_.forEach((g,b)=>{n==2?b>0&&p.y&&(g._paths=null):p[g.scale]&&(g._paths=null)});for(let g in p)Ga=!0,et("setScale",g);ot&&K.left>=0&&(ha=Tt=!0)}for(let g in Y)Y[g]=null}function su(c){let p=no(Je-1,0,at-1),m=no(Ze+1,0,at-1);for(;c[p]==null&&p>0;)p--;for(;c[m]==null&&m<at-1;)m++;return[p,m]}function nu(){if(at>0){let c=_.some(p=>p._focus)&&vt!=Wt.alpha;c&&(f.globalAlpha=vt=Wt.alpha),_.forEach((p,m)=>{if(m>0&&p.show&&(ml(m,!1),ml(m,!0),p._paths==null)){let g=vt;vt!=p.alpha&&(f.globalAlpha=vt=p.alpha);let b=n==2?[0,a[m][0].length-1]:su(a[m]);p._paths=p.paths(s,m,b[0],b[1]),vt!=g&&(f.globalAlpha=vt=g)}}),_.forEach((p,m)=>{if(m>0&&p.show){let g=vt;vt!=p.alpha&&(f.globalAlpha=vt=p.alpha),p._paths!=null&&yl(m,!1);{let b=p._paths!=null?p._paths.gaps:null,w=p.points.show(s,m,Je,Ze,b),T=p.points.filter(s,m,w,b);(w||T)&&(p.points._paths=p.points.paths(s,m,Je,Ze,T),yl(m,!0))}vt!=g&&(f.globalAlpha=vt=g),et("drawSeries",m)}}),c&&(f.globalAlpha=vt=1)}}function ml(c,p){let m=p?_[c].points:_[c];m._stroke=m.stroke(s,c),m._fill=m.fill(s,c)}function yl(c,p){let m=p?_[c].points:_[c],{stroke:g,fill:b,clip:w,flags:T,_stroke:D=m._stroke,_fill:R=m._fill,_width:z=m.width}=m._paths;z=Ae(z*me,3);let F=null,V=z%2/2;p&&R==null&&(R=z>0?"#fff":D);let X=m.pxAlign==1&&V>0;if(X&&f.translate(V,V),!p){let pe=yt-z/2,de=At-z/2,ne=ft+z,Q=It+z;F=new Path2D,F.rect(pe,de,ne,Q)}p?cn(D,z,m.dash,m.cap,R,g,b,T,w):ou(c,D,z,m.dash,m.cap,R,g,b,T,F,w),X&&f.translate(-V,-V)}function ou(c,p,m,g,b,w,T,D,R,z,F){let V=!1;R!=0&&O.forEach((X,pe)=>{if(X.series[0]==c){let de=_[X.series[1]],ne=a[X.series[1]],Q=(de._paths||Zr).band;va(Q)&&(Q=X.dir==1?Q[0]:Q[1]);let J,$e=null;de.show&&Q&&Gp(ne,Je,Ze)?($e=X.fill(s,pe)||w,J=de._paths.clip):Q=null,cn(p,m,g,b,$e,T,D,R,z,F,J,Q),V=!0}}),V||cn(p,m,g,b,w,T,D,R,z,F)}let gl=_r|io;function cn(c,p,m,g,b,w,T,D,R,z,F,V){pl(c,p,m,g,b),(R||z||V)&&(f.save(),R&&f.clip(R),z&&f.clip(z)),V?(D&gl)==gl?(f.clip(V),F&&f.clip(F),us(b,T),ds(c,w,p)):D&io?(us(b,T),f.clip(V),ds(c,w,p)):D&_r&&(f.save(),f.clip(V),F&&f.clip(F),us(b,T),f.restore(),ds(c,w,p)):(us(b,T),ds(c,w,p)),(R||z||V)&&f.restore()}function ds(c,p,m){m>0&&(p instanceof Map?p.forEach((g,b)=>{f.strokeStyle=cs=b,f.stroke(g)}):p!=null&&c&&f.stroke(p))}function us(c,p){p instanceof Map?p.forEach((m,g)=>{f.fillStyle=Za=g,f.fill(m)}):p!=null&&c&&f.fill(p)}function lu(c,p,m,g){let b=k[c],w;if(g<=0)w=[0,0];else{let T=b._space=b.space(s,c,p,m,g),D=b._incrs=b.incrs(s,c,p,m,g,T);w=vv(p,m,D,g,T)}return b._found=w}function dn(c,p,m,g,b,w,T,D,R,z){let F=T%2/2;A==1&&f.translate(F,F),pl(D,T,R,z,D),f.beginPath();let V,X,pe,de,ne=b+(g==0||g==3?-w:w);m==0?(X=b,de=ne):(V=b,pe=ne);for(let Q=0;Q<c.length;Q++)p[Q]!=null&&(m==0?V=pe=c[Q]:X=de=c[Q],f.moveTo(V,X),f.lineTo(pe,de));f.stroke(),A==1&&f.translate(-F,-F)}function iu(c){let p=!0;return k.forEach((m,g)=>{if(!m.show)return;let b=S[m.scale];if(b.min==null){m._show&&(p=!1,m._show=!1,Qa(!1));return}else m._show||(p=!1,m._show=!0,Qa(!1));let w=m.side,T=w%2,{min:D,max:R}=b,[z,F]=lu(g,D,R,T==0?te:W);if(F==0)return;let V=b.distr==2,X=m._splits=m.splits(s,g,D,R,z,F,V),pe=b.distr==2?X.map(J=>Nt[J]):X,de=b.distr==2?Nt[X[1]]-Nt[X[0]]:z,ne=m._values=m.values(s,m.filter(s,pe,g,F,de),g,F,de);m._rotate=w==2?m.rotate(s,ne,g,F):0;let Q=m._size;m._size=Dt(m.size(s,ne,g,c)),Q!=null&&m._size!=Q&&(p=!1)}),p}function cu(c){let p=!0;return dl.forEach((m,g)=>{let b=m(s,g,wa,c);b!=oa[g]&&(p=!1),oa[g]=b}),p}function du(){for(let c=0;c<k.length;c++){let p=k[c];if(!p.show||!p._show)continue;let m=p.side,g=m%2,b,w,T=p.stroke(s,c),D=m==0||m==3?-1:1,[R,z]=p._found;if(p.label!=null){let ct=p.labelGap*D,bt=Ye((p._lpos+ct)*me);fl(p.labelFont[0],T,"center",m==2?"top":Ni),f.save(),g==1?(b=w=0,f.translate(bt,Ye(At+It/2)),f.rotate((m==3?-Ls:Ls)/2)):(b=Ye(yt+ft/2),w=bt);let Ca=Cc(p.label)?p.label(s,c,R,z):p.label;f.fillText(Ca,b,w),f.restore()}if(z==0)continue;let F=S[p.scale],V=g==0?ft:It,X=g==0?yt:At,pe=p._splits,de=F.distr==2?pe.map(ct=>Nt[ct]):pe,ne=F.distr==2?Nt[pe[1]]-Nt[pe[0]]:R,Q=p.ticks,J=p.border,$e=Q.show?Q.size:0,He=Ye($e*me),tt=Ye((p.alignTo==2?p._size-$e-p.gap:p.gap)*me),Se=p._rotate*-Ls/180,ze=C(p._pos*me),gt=(He+tt)*D,it=ze+gt;w=g==0?it:0,b=g==1?it:0;let Et=p.font[0],Ot=p.align==1?mr:p.align==2?Yn:Se>0?mr:Se<0?Yn:g==0?"center":m==3?Yn:mr,qt=Se||g==1?"middle":m==2?"top":Ni;fl(Et,T,Ot,qt);let xt=p.font[1]*p.lineGap,$t=pe.map(ct=>C(i(ct,F,V,X))),Ht=p._values;for(let ct=0;ct<Ht.length;ct++){let bt=Ht[ct];if(bt!=null){g==0?b=$t[ct]:w=$t[ct],bt=""+bt;let Ca=bt.indexOf(`
`)==-1?[bt]:bt.split(/\n/gm);for(let dt=0;dt<Ca.length;dt++){let Nl=Ca[dt];Se?(f.save(),f.translate(b,w+dt*xt),f.rotate(Se),f.fillText(Nl,0,0),f.restore()):f.fillText(Nl,b,w+dt*xt)}}}Q.show&&dn($t,Q.filter(s,de,c,z,ne),g,m,ze,He,Ae(Q.width*me,3),Q.stroke(s,c),Q.dash,Q.cap);let Yt=p.grid;Yt.show&&dn($t,Yt.filter(s,de,c,z,ne),g,g==0?2:1,g==0?At:yt,g==0?It:ft,Ae(Yt.width*me,3),Yt.stroke(s,c),Yt.dash,Yt.cap),J.show&&dn([ze],[1],g==0?1:0,g==0?1:2,g==1?At:yt,g==1?It:ft,Ae(J.width*me,3),J.stroke(s,c),J.dash,J.cap)}et("drawAxes")}function Qa(c){_.forEach((p,m)=>{m>0&&(p._paths=null,c&&(n==1?(p.min=null,p.max=null):p.facets.forEach(g=>{g.min=null,g.max=null})))})}let ps=!1,un=!1,Pr=[];function uu(){un=!1;for(let c=0;c<Pr.length;c++)et(...Pr[c]);Pr.length=0}function Xa(){ps||(of(xl),ps=!0)}function pu(c,p=!1){ps=!0,un=p,c(s),xl(),p&&Pr.length>0&&queueMicrotask(uu)}s.batch=pu;function xl(){if(Zs&&(ru(),Zs=!1),Ga&&(Jd(),Ga=!1),os){if(Pe(x,mr,Te),Pe(x,"top",Ge),Pe(x,qr,te),Pe(x,Yr,W),Pe(h,mr,Te),Pe(h,"top",Ge),Pe(h,qr,te),Pe(h,Yr,W),Pe(v,qr,ea),Pe(v,Yr,ga),y.width=Ye(ea*me),y.height=Ye(ga*me),k.forEach(({_el:c,_show:p,_size:m,_pos:g,side:b})=>{if(c!=null)if(p){let w=b===3||b===0?m:0,T=b%2==1;Pe(c,T?"left":"top",g-w),Pe(c,T?"width":"height",m),Pe(c,T?"top":"left",T?Ge:Te),Pe(c,T?"height":"width",T?W:te),ro(c,Ra)}else _t(c,Ra)}),cs=Za=en=an=rn=sn=nn=on=tn=null,vt=1,Rr(!0),Te!=Va||Ge!=xa||te!=Ut||W!=ba){Qa(!1);let c=te/Ut,p=W/ba;if(ot&&!ha&&K.left>=0){K.left*=c,K.top*=p,er&&Zt(er,Ye(K.left),0,te,W),tr&&Zt(tr,0,Ye(K.top),te,W);for(let m=0;m<Mt.length;m++){let g=Mt[m];g!=null&&(Ka[m]*=c,Ja[m]*=p,Zt(g,Dt(Ka[m]),Dt(Ja[m]),te,W))}}if(Ee.show&&!ls&&Ee.left>=0&&Ee.width>0){Ee.left*=c,Ee.width*=c,Ee.top*=p,Ee.height*=p;for(let m in gn)Pe(sr,m,Ee[m])}Va=Te,xa=Ge,Ut=te,ba=W}et("setSize"),os=!1}ea>0&&ga>0&&(f.clearRect(0,0,y.width,y.height),et("drawClear"),N.forEach(c=>c()),et("draw")),Ee.show&&ls&&(fs(Ee),ls=!1),ot&&ha&&(Sa(null,!0,!1),ha=!1),ae.show&&ae.live&&Tt&&(mn(),Tt=!1),d||(d=!0,s.status=1,et("ready")),$r=!1,ps=!1}s.redraw=(c,p)=>{Ga=p||!1,c!==!1?ia(P,L.min,L.max):Xa()};function pn(c,p){let m=S[c];if(m.from==null){if(at==0){let g=m.range(s,p.min,p.max,c);p.min=g[0],p.max=g[1]}if(p.min>p.max){let g=p.min;p.min=p.max,p.max=g}if(at>1&&p.min!=null&&p.max!=null&&p.max-p.min<1e-16)return;c==P&&m.distr==2&&at>0&&(p.min=Ft(p.min,a[0]),p.max=Ft(p.max,a[0]),p.min==p.max&&p.max++),Y[c]=p,Zs=!0,Xa()}}s.setScale=pn;let fn,vn,er,tr,bl,hl,ar,rr,_l,wl,Me,De,la=!1,rt=K.drag,Qe=rt.x,Xe=rt.y;ot&&(K.x&&(fn=Lt($p,h)),K.y&&(vn=Lt(Pp,h)),L.ori==0?(er=fn,tr=vn):(er=vn,tr=fn),Me=K.left,De=K.top);let Ee=s.select=We({show:!0,over:!0,left:0,width:0,top:0,height:0},t.select),sr=Ee.show?Lt(Ep,Ee.over?h:x):null;function fs(c,p){if(Ee.show){for(let m in c)Ee[m]=c[m],m in gn&&Pe(sr,m,c[m]);p!==!1&&et("setSelect")}}s.setSelect=fs;function fu(c){if(_[c].show)Ve&&ro(Ne[c],Ra);else if(Ve&&_t(Ne[c],Ra),ot){let m=Ya?Mt[0]:Mt[c];m!=null&&Zt(m,-10,-10,te,W)}}function ia(c,p,m){pn(c,{min:p,max:m})}function Vt(c,p,m,g){p.focus!=null&&xu(c),p.show!=null&&_.forEach((b,w)=>{w>0&&(c==w||c==null)&&(b.show=p.show,fu(w),n==2?(ia(b.facets[0].scale,null,null),ia(b.facets[1].scale,null,null)):ia(b.scale,null,null),Xa())}),m!==!1&&et("setSeries",c,p),g&&Ir("setSeries",s,c,p)}s.setSeries=Vt;function vu(c,p){We(O[c],p)}function mu(c,p){c.fill=le(c.fill||null),c.dir=ue(c.dir,-1),p=p??O.length,O.splice(p,0,c)}function yu(c){c==null?O.length=0:O.splice(c,1)}s.addBand=mu,s.setBand=vu,s.delBand=yu;function gu(c,p){_[c].alpha=p,ot&&Mt[c]!=null&&(Mt[c].style.opacity=p),Ve&&Ne[c]&&(Ne[c].style.opacity=p)}let ta,ca,ka,nr={focus:!0};function xu(c){if(c!=ka){let p=c==null,m=Wt.alpha!=1;_.forEach((g,b)=>{if(n==1||b>0){let w=p||b==0||b==c;g._focus=p?null:w,m&&gu(b,w?1:Wt.alpha)}}),ka=c,m&&Xa()}}Ve&&qa&&lt(Fi,xe,c=>{K._lock||(_a(c),ka!=null&&Vt(null,nr,!0,je.setSeries))});function Gt(c,p,m){let g=S[p];m&&(c=c/me-(g.ori==1?Ge:Te));let b=te;g.ori==1&&(b=W,c=b-c),g.dir==-1&&(c=b-c);let w=g._min,T=g._max,D=c/b,R=w+(T-w)*D,z=g.distr;return z==3?xr(10,R):z==4?Yp(R,g.asinh):z==100?g.bwd(R):R}function bu(c,p){let m=Gt(c,P,p);return Ft(m,a[0],Je,Ze)}s.valToIdx=c=>Ft(c,a[0]),s.posToIdx=bu,s.posToVal=Gt,s.valToPos=(c,p,m)=>S[p].ori==0?o(c,S[p],m?ft:te,m?yt:0):l(c,S[p],m?It:W,m?At:0),s.setCursor=(c,p,m)=>{Me=c.left,De=c.top,Sa(null,p,m)};function kl(c,p){Pe(sr,mr,Ee.left=c),Pe(sr,qr,Ee.width=p)}function Sl(c,p){Pe(sr,"top",Ee.top=c),Pe(sr,Yr,Ee.height=p)}let Lr=L.ori==0?kl:Sl,Dr=L.ori==1?kl:Sl;function hu(){if(Ve&&ae.live)for(let c=n==2?1:0;c<_.length;c++){if(c==0&&Ct)continue;let p=ae.values[c],m=0;for(let g in p)jt[c][m++].firstChild.nodeValue=p[g]}}function mn(c,p){if(c!=null&&(c.idxs?c.idxs.forEach((m,g)=>{ge[g]=m}):Qp(c.idx)||ge.fill(c.idx),ae.idx=ge[0]),Ve&&ae.live){for(let m=0;m<_.length;m++)(m>0||n==1&&!Ct)&&_u(m,ge[m]);hu()}Tt=!1,p!==!1&&et("setLegend")}s.setLegend=mn;function _u(c,p){let m=_[c],g=c==0&&q==2?Nt:a[c],b;Ct?b=m.values(s,c,p)??na:(b=m.value(s,p==null?null:g[p],c,p),b=b==null?na:{_:b}),ae.values[c]=b}function Sa(c,p,m){_l=Me,wl=De,[Me,De]=K.move(s,Me,De),K.left=Me,K.top=De,ot&&(er&&Zt(er,Ye(Me),0,te,W),tr&&Zt(tr,0,Ye(De),te,W));let g,b=Je>Ze;ta=Ce,ca=null;let w=L.ori==0?te:W,T=L.ori==1?te:W;if(Me<0||at==0||b){g=K.idx=null;for(let D=0;D<_.length;D++){let R=Mt[D];R!=null&&Zt(R,-10,-10,te,W)}qa&&Vt(null,nr,!0,c==null&&je.setSeries),ae.live&&(ge.fill(g),Tt=!0)}else{let D,R,z;n==1&&(D=L.ori==0?Me:De,R=Gt(D,P),g=K.idx=Ft(R,a[0],Je,Ze),z=G(a[0][g],L,w,0));let F=-10,V=-10,X=0,pe=0,de=!0,ne="",Q="";for(let J=n==2?1:0;J<_.length;J++){let $e=_[J],He=ge[J],tt=He==null?null:n==1?a[J][He]:a[J][1][He],Se=K.dataIdx(s,J,g,R),ze=Se==null?null:n==1?a[J][Se]:a[J][1][Se];if(Tt=Tt||ze!=tt||Se!=He,ge[J]=Se,J>0&&$e.show){let gt=Se==null?-10:Se==g?z:G(n==1?a[0][Se]:a[J][0][Se],L,w,0),it=ze==null?-10:Z(ze,n==1?S[$e.scale]:S[$e.facets[1].scale],T,0);if(qa&&ze!=null){let Et=L.ori==1?Me:De,Ot=Ke(Wt.dist(s,J,Se,it,Et));if(Ot<ta){let qt=Wt.bias;if(qt!=0){let xt=Gt(Et,$e.scale),$t=ze>=0?1:-1,Ht=xt>=0?1:-1;Ht==$t&&(Ht==1?qt==1?ze>=xt:ze<=xt:qt==1?ze<=xt:ze>=xt)&&(ta=Ot,ca=J)}else ta=Ot,ca=J}}if(Tt||Ya){let Et,Ot;L.ori==0?(Et=gt,Ot=it):(Et=it,Ot=gt);let qt,xt,$t,Ht,Yt,ct,bt=!0,Ca=nt.bbox;if(Ca!=null){bt=!1;let dt=Ca(s,J);$t=dt.left,Ht=dt.top,qt=dt.width,xt=dt.height}else $t=Et,Ht=Ot,qt=xt=nt.size(s,J);if(ct=nt.fill(s,J),Yt=nt.stroke(s,J),Ya)J==ca&&ta<=Wt.prox&&(F=$t,V=Ht,X=qt,pe=xt,de=bt,ne=ct,Q=Yt);else{let dt=Mt[J];dt!=null&&(Ka[J]=$t,Ja[J]=Ht,qi(dt,qt,xt,bt),Vi(dt,ct,Yt),Zt(dt,Dt($t),Dt(Ht),te,W))}}}}if(Ya){let J=Wt.prox,$e=ka==null?ta<=J:ta>J||ca!=ka;if(Tt||$e){let He=Mt[0];He!=null&&(Ka[0]=F,Ja[0]=V,qi(He,X,pe,de),Vi(He,ne,Q),Zt(He,Dt(F),Dt(V),te,W))}}}if(Ee.show&&la)if(c!=null){let[D,R]=je.scales,[z,F]=je.match,[V,X]=c.cursor.sync.scales,pe=c.cursor.drag;if(Qe=pe._x,Xe=pe._y,Qe||Xe){let{left:de,top:ne,width:Q,height:J}=c.select,$e=c.scales[V].ori,He=c.posToVal,tt,Se,ze,gt,it,Et=D!=null&&z(D,V),Ot=R!=null&&F(R,X);Et&&Qe?($e==0?(tt=de,Se=Q):(tt=ne,Se=J),ze=S[D],gt=G(He(tt,V),ze,w,0),it=G(He(tt+Se,V),ze,w,0),Lr(Bt(gt,it),Ke(it-gt))):Lr(0,w),Ot&&Xe?($e==1?(tt=de,Se=Q):(tt=ne,Se=J),ze=S[R],gt=Z(He(tt,X),ze,T,0),it=Z(He(tt+Se,X),ze,T,0),Dr(Bt(gt,it),Ke(it-gt))):Dr(0,T)}else xn()}else{let D=Ke(_l-bl),R=Ke(wl-hl);if(L.ori==1){let X=D;D=R,R=X}Qe=rt.x&&D>=rt.dist,Xe=rt.y&&R>=rt.dist;let z=rt.uni;z!=null?Qe&&Xe&&(Qe=D>=z,Xe=R>=z,!Qe&&!Xe&&(R>D?Xe=!0:Qe=!0)):rt.x&&rt.y&&(Qe||Xe)&&(Qe=Xe=!0);let F,V;Qe&&(L.ori==0?(F=ar,V=Me):(F=rr,V=De),Lr(Bt(F,V),Ke(V-F)),Xe||Dr(0,T)),Xe&&(L.ori==1?(F=ar,V=Me):(F=rr,V=De),Dr(Bt(F,V),Ke(V-F)),Qe||Lr(0,w)),!Qe&&!Xe&&(Lr(0,0),Dr(0,0))}if(rt._x=Qe,rt._y=Xe,c==null){if(m){if(Il!=null){let[D,R]=je.scales;je.values[0]=D!=null?Gt(L.ori==0?Me:De,D):null,je.values[1]=R!=null?Gt(L.ori==1?Me:De,R):null}Ir(Kn,s,Me,De,te,W,g)}if(qa){let D=m&&je.setSeries,R=Wt.prox;ka==null?ta<=R&&Vt(ca,nr,!0,D):ta>R?Vt(null,nr,!0,D):ca!=ka&&Vt(ca,nr,!0,D)}}Tt&&(ae.idx=g,mn()),p!==!1&&et("setCursor")}let da=null;Object.defineProperty(s,"rect",{get(){return da==null&&Rr(!1),da}});function Rr(c=!1){c?da=null:(da=h.getBoundingClientRect(),et("syncRect",da))}function Cl(c,p,m,g,b,w,T){K._lock||la&&c!=null&&c.movementX==0&&c.movementY==0||(yn(c,p,m,g,b,w,T,!1,c!=null),c!=null?Sa(null,!0,!0):Sa(p,!0,!1))}function yn(c,p,m,g,b,w,T,D,R){if(da==null&&Rr(!1),_a(c),c!=null)m=c.clientX-da.left,g=c.clientY-da.top;else{if(m<0||g<0){Me=-10,De=-10;return}let[z,F]=je.scales,V=p.cursor.sync,[X,pe]=V.values,[de,ne]=V.scales,[Q,J]=je.match,$e=p.axes[0].side%2==1,He=L.ori==0?te:W,tt=L.ori==1?te:W,Se=$e?w:b,ze=$e?b:w,gt=$e?g:m,it=$e?m:g;if(de!=null?m=Q(z,de)?i(X,S[z],He,0):-10:m=He*(gt/Se),ne!=null?g=J(F,ne)?i(pe,S[F],tt,0):-10:g=tt*(it/ze),L.ori==1){let Et=m;m=g,g=Et}}R&&(p==null||p.cursor.event.type==Kn)&&((m<=1||m>=te-1)&&(m=La(m,te)),(g<=1||g>=W-1)&&(g=La(g,W))),D?(bl=m,hl=g,[ar,rr]=K.move(s,m,g)):(Me=m,De=g)}let gn={width:0,height:0,left:0,top:0};function xn(){fs(gn,!1)}let Al,Tl,Ml,El;function $l(c,p,m,g,b,w,T){la=!0,Qe=Xe=rt._x=rt._y=!1,yn(c,p,m,g,b,w,T,!0,!1),c!=null&&(lt(Jn,to,Pl,!1),Ir(Hi,s,ar,rr,te,W,null));let{left:D,top:R,width:z,height:F}=Ee;Al=D,Tl=R,Ml=z,El=F}function Pl(c,p,m,g,b,w,T){la=rt._x=rt._y=!1,yn(c,p,m,g,b,w,T,!1,!0);let{left:D,top:R,width:z,height:F}=Ee,V=z>0||F>0,X=Al!=D||Tl!=R||Ml!=z||El!=F;if(V&&X&&fs(Ee),rt.setScale&&V&&X){let pe=D,de=z,ne=R,Q=F;if(L.ori==1&&(pe=R,de=F,ne=D,Q=z),Qe&&ia(P,Gt(pe,P),Gt(pe+de,P)),Xe)for(let J in S){let $e=S[J];J!=P&&$e.from==null&&$e.min!=Ce&&ia(J,Gt(ne+Q,J),Gt(ne,J))}xn()}else K.lock&&(K._lock=!K._lock,Sa(p,!0,c!=null));c!=null&&(Wa(Jn,to),Ir(Jn,s,Me,De,te,W,null))}function wu(c,p,m,g,b,w,T){if(K._lock)return;_a(c);let D=la;if(la){let R=!0,z=!0,F=10,V,X;L.ori==0?(V=Qe,X=Xe):(V=Xe,X=Qe),V&&X&&(R=Me<=F||Me>=te-F,z=De<=F||De>=W-F),V&&R&&(Me=Me<ar?0:te),X&&z&&(De=De<rr?0:W),Sa(null,!0,!0),la=!1}Me=-10,De=-10,ge.fill(null),Sa(null,!0,!0),D&&(la=D)}function Ll(c,p,m,g,b,w,T){K._lock||(_a(c),Xs(),xn(),c!=null&&Ir(Bi,s,Me,De,te,W,null))}function Dl(){k.forEach(mv),Qs(s.width,s.height,!0)}Ia(Ds,gr,Dl);let or={};or.mousedown=$l,or.mousemove=Cl,or.mouseup=Pl,or.dblclick=Ll,or.setSeries=(c,p,m,g)=>{let b=je.match[2];m=b(s,p,m),m!=-1&&Vt(m,g,!0,!1)},ot&&(lt(Hi,h,$l),lt(Kn,h,Cl),lt(zi,h,c=>{_a(c),Rr(!1)}),lt(Fi,h,wu),lt(Bi,h,Ll),co.add(s),s.syncRect=Rr);let vs=s.hooks=t.hooks||{};function et(c,p,m){un?Pr.push([c,p,m]):c in vs&&vs[c].forEach(g=>{g.call(null,s,p,m)})}(t.plugins||[]).forEach(c=>{for(let p in c.hooks)vs[p]=(vs[p]||[]).concat(c.hooks[p])});let Rl=(c,p,m)=>m,je=We({key:null,setSeries:!1,filters:{pub:Qi,sub:Qi},scales:[P,_[1]?_[1].scale:null],match:[Xi,Xi,Rl],values:[null,null]},K.sync);je.match.length==2&&je.match.push(Rl),K.sync=je;let Il=je.key,bn=Kc(Il);function Ir(c,p,m,g,b,w,T){je.filters.pub(c,p,m,g,b,w,T)&&bn.pub(c,p,m,g,b,w,T)}bn.sub(s);function ku(c,p,m,g,b,w,T){je.filters.sub(c,p,m,g,b,w,T)&&or[c](null,p,m,g,b,w,T)}s.pub=ku;function Su(){bn.unsub(s),co.delete(s),ya.clear(),so(Ds,gr,Dl),u.remove(),xe?.remove(),et("destroy")}s.destroy=Su;function hn(){et("init",t,a),ul(a||t.data,!1),Y[P]?pn(P,Y[P]):Xs(),ls=Ee.show&&(Ee.width>0||Ee.height>0),ha=Tt=!0,Qs(t.width,t.height)}return _.forEach(cl),k.forEach(au),r?r instanceof HTMLElement?(r.appendChild(u),hn()):r(s,hn):hn(),s}st.assign=We;st.fmtNum=go;st.rangeNum=Rs;st.rangeLog=Os;st.rangeAsinh=mo;st.orient=Oa;st.pxRatio=me;st.join=nf;st.fmtDate=bo,st.tzDate=gf;st.sync=Kc;{st.addGap=Xf,st.clipGaps=Fs;let t=st.paths={points:td};t.linear=rd,t.stepped=av,t.bars=rv,t.spline=nv}function Ha({data:t,series:a,height:r,className:s,compact:n=!1}){r===void 0&&(r=n?32:120);let o=Pt(null),l=Pt(null);return oe(()=>{if(!o.current||!t||t.length===0)return;let i=getComputedStyle(document.documentElement),d=i.getPropertyValue("--text-tertiary").trim(),u=i.getPropertyValue("--border-subtle").trim(),y=i.getPropertyValue("--font-mono").trim()||"monospace";function f(x){return x.startsWith("var(")?i.getPropertyValue(x.slice(4,-1)).trim():x}let v={width:o.current.clientWidth,height:r,cursor:n?{show:!1}:{show:!0,drag:{x:!1,y:!1}},legend:{show:!1},padding:n?[0,0,0,0]:void 0,axes:n?[{show:!1},{show:!1}]:[{stroke:d,grid:{stroke:u,width:1},font:`10px ${y}`,ticks:{stroke:u,width:1}},{stroke:d,grid:{stroke:u,width:1},font:`10px ${y}`,ticks:{stroke:u,width:1},size:50}],series:[{},...a.map(x=>{let h=f(x.color);return{label:x.label,stroke:h,width:x.width||2,fill:n?void 0:h+"15"}})]};return l.current&&l.current.destroy(),l.current=new st(v,t,o.current),()=>{l.current&&(l.current.destroy(),l.current=null)}},[t,a,r,n]),oe(()=>{if(!o.current)return;let i=new ResizeObserver(()=>{l.current&&o.current&&l.current.setSize({width:o.current.clientWidth,height:r})});return i.observe(o.current),()=>i.disconnect()},[r]),n?e("div",{ref:o,class:s||"",role:"img","aria-label":t&&t.length>1?`Sparkline: ${a.map(i=>i.label).join(", ")}`:"Sparkline loading"}):e("figure",null,e("div",{ref:o,class:s||"",role:"img","aria-label":t&&t.length>1?`Chart: ${a.map(i=>i.label).join(", ")}`:"Chart loading"}),t&&t.length>1&&e("figcaption",{class:"sr-only"},a.map(i=>i.label).join(", ")," \u2014 ",t[0].length," data points"))}function Oe({value:t,label:a,unit:r,delta:s,warning:n,loading:o,sparkData:l,sparkColor:i}){return e("div",{class:`t-frame ${o?"cursor-working":"cursor-active"}`,"data-label":a,style:n?"border-left: 3px solid var(--status-warning);":""},e("div",{class:"flex items-baseline gap-2",style:"justify-content: space-between;"},e("div",{class:"flex items-baseline gap-2"},e("span",{class:"data-mono",style:`font-size: var(--type-hero); font-weight: 600; color: ${n?"var(--status-warning)":"var(--accent)"}; line-height: 1;`},t??"\u2014"),r&&e("span",{class:"data-mono",style:"font-size: var(--type-headline); color: var(--text-tertiary);"},r)),l&&l.length>1&&l[0].length>1&&e("div",{style:"width: 80px; height: 32px; flex-shrink: 0;"},e(Ha,{data:l,series:[{label:a||"trend",color:i||"var(--accent)",width:1.5}],compact:!0}))),s&&e("div",{style:"font-size: var(--type-label); color: var(--text-secondary); margin-top: 8px; font-family: var(--font-mono);"},s))}var yv={A:["01110","11011","11111","11011","11011"],B:["11110","11011","11110","11011","11110"],C:["0111","1100","1100","1100","0111"],D:["11110","11011","11011","11011","11110"],E:["1111","1100","1110","1100","1111"],F:["1111","1100","1110","1100","1100"],G:["01110","11000","11011","11011","01110"],H:["11011","11011","11111","11011","11011"],I:["1","1","1","1","1"],J:["0111","0011","0011","1011","0110"],K:["11001","11010","11100","11010","11001"],L:["1100","1100","1100","1100","1111"],M:["10001","11011","10101","10001","10001"],N:["10001","11001","10101","10011","10001"],O:["01110","11011","11011","11011","01110"],P:["11110","11011","11110","11000","11000"],Q:["01110","11011","11011","11010","01101"],R:["11111","11011","11110","11010","11001"],S:["0111","1100","0110","0011","1110"],T:["11111","00100","00100","00100","00100"],U:["11011","11011","11011","11011","01110"],V:["10001","10001","01010","01010","00100"],W:["10001","10001","10101","10101","01010"],X:["10001","01010","00100","01010","10001"],Y:["10001","01010","00100","00100","00100"],Z:["11111","00010","00100","01000","11111"]},gv=["000","010","111","010","000"],Qt=10,za=2,Cr=Qt-za,Ao=1,ld=2,id=3;function cd(t){let a=0,r=[];for(let s=0;s<t.length;s++){let n=t[s],o=yv[n];if(!o)continue;let l=o[0].length;for(let i=0;i<5;i++)for(let d=0;d<l;d++)o[i][d]==="1"&&r.push([a+d,i]);a+=l+ld}return{pixels:r,endX:a>0?a-ld:0}}function xv(t){let a=[];for(let r=0;r<5;r++)for(let s=0;s<3;s++)gv[r][s]==="1"&&a.push([t+s,r]);return{pixels:a,endX:t+3}}function ce({page:t,subtitle:a}){let r=Fe(()=>{let s=cd("ARIA"),n=s.endX+id,o=xv(n),l=o.endX+id,i=cd(t),d=i.pixels.map(([y,f])=>[y+l,f]),u=(l+i.endX)*Qt+Qt;return{ariaPixels:s.pixels,sepPixels:o.pixels,pagePixels:d,totalWidth:u}},[t]);return e("div",{style:"margin-bottom: 1.5rem"},e("svg",{viewBox:`0 0 ${r.totalWidth} ${5*Qt}`,style:"height: 2rem; max-width: 100%; width: auto; display: block;",role:"img","aria-label":`ARIA ${t}`},r.ariaPixels.map(([s,n],o)=>e("rect",{key:`a${o}`,x:s*Qt+za/2,y:n*Qt+za/2,width:Cr,height:Cr,rx:Ao,fill:"var(--accent)"})),r.sepPixels.map(([s,n],o)=>e("rect",{key:`s${o}`,x:s*Qt+za/2,y:n*Qt+za/2,width:Cr,height:Cr,rx:Ao,fill:"var(--text-tertiary)"})),r.pagePixels.map(([s,n],o)=>e("rect",{key:`p${o}`,x:s*Qt+za/2,y:n*Qt+za/2,width:Cr,height:Cr,rx:Ao,fill:"var(--text-primary)"}))),a&&e("p",{style:"margin-top: 0.5rem; font-size: var(--type-label); color: var(--text-secondary)"},a))}function bv({value:t}){let a=Math.round((t||0)*100),r=a>=70?"var(--status-healthy)":a>=30?"var(--status-warning)":"var(--status-error)";return e("div",{class:"flex items-center gap-2"},e("div",{class:"flex-1 h-1.5 rounded-full",style:"background: var(--bg-inset)"},e("div",{class:"h-1.5 rounded-full",style:`width: ${a}%; background: ${r}; min-width: ${a>0?"3px":"0"}; transition: width 0.3s ease;`})),e("span",{class:"data-mono text-xs",style:`color: ${r}; min-width: 28px; text-align: right;`},a,"%"))}function To(){let{data:t,loading:a}=Re("presence"),r=t&&t.data||{},s=r.rooms||{},n=r.identified_persons||{},o=r.camera_rooms||{},l=r.mqtt_connected,i=r.occupied_rooms||[],d=Object.entries(s).sort((A,C)=>(C[1].probability||0)-(A[1].probability||0)),u=Object.keys(n).length,y=Object.keys(o).length,f=d.reduce((A,[,C])=>A+(C.signals||[]).length,0),v=r.overall_probability!=null?r.overall_probability:d.length>0?Math.max(...d.map(([,A])=>A.probability||0)):0,x=Math.round(v*100),h=x>=70?"var(--status-healthy)":x>=30?"var(--status-warning)":"var(--status-error)";return a&&!t?e("div",{class:"t-frame","data-label":"presence",style:"min-height: 120px;"},e("div",{class:"flex items-center gap-2"},e("div",{class:"w-12 h-8 rounded",style:"background: var(--bg-inset); animation: pulse 1.5s infinite;"}),e("div",{class:"flex-1 h-3 rounded",style:"background: var(--bg-inset); animation: pulse 1.5s infinite;"}))):e("div",{class:"t-frame","data-label":"presence"},e("div",{class:"flex items-start justify-between mb-3"},e("div",null,e("div",{class:"flex items-baseline gap-2"},e("span",{class:"data-mono",style:`font-size: var(--type-hero); font-weight: 600; color: ${h}; line-height: 1;`},x,"%")),e("div",{class:"text-xs mt-1",style:"color: var(--text-tertiary)"},i.length===0?"No rooms occupied":i.length===1?"1 room occupied":`${i.length} rooms occupied`)),e("div",{class:"flex items-center gap-1.5 text-xs flex-shrink-0"},e("span",{class:"inline-block w-2 h-2 rounded-full",style:`background: ${l?"var(--status-healthy)":"var(--status-error)"}`}),e("span",{style:`color: ${l?"var(--status-healthy)":"var(--status-error)"}`},"MQTT"))),e("div",{class:"flex flex-wrap gap-x-4 gap-y-1 text-xs mb-3",style:"color: var(--text-tertiary)"},e("span",null,u," person",u!==1?"s":""),e("span",null,y," camera",y!==1?"s":""),e("span",null,f," signal",f!==1?"s":"")),d.length>0?e("div",{class:"space-y-2"},d.slice(0,6).map(([A,C])=>e("div",{key:A},e("div",{class:"text-xs mb-0.5",style:"color: var(--text-secondary); text-transform: capitalize;"},A.replace(/_/g," ")),e(bv,{value:C.probability}))),d.length>6&&e("div",{class:"text-xs",style:"color: var(--text-tertiary)"},"+",d.length-6," more room",d.length-6!==1?"s":"")):e("div",{class:"text-xs",style:"color: var(--text-tertiary)"},"No rooms detected yet."),e("a",{href:"#/presence",class:"block text-xs mt-3",style:"color: var(--accent); text-decoration: none;"},"View full presence data ","\u2192"))}var Mo=["collecting","baselines","ml-training","ml-active"],hv=["Collecting","Baselines","ML Training","ML Active"],dd=["Gathering daily snapshots","Statistical baselines active","Training ML models","Full intelligence active"],_v={data:{label:"DATA PLANE",nodes:[{id:"discovery",label:"Discovery",metricKey:"entity_count"},{id:"activity_monitor",label:"Activity",metricKey:"event_rate"},{id:"data_quality",label:"Curation",metricKey:"included_count"},{id:"activity_labeler",label:"Labeler",metricKey:"current_activity"}]},learning:{label:"LEARNING PLANE",nodes:[{id:"intelligence",label:"Intel.",metricKey:"day_count"},{id:"ml_engine",label:"ML Engine",metricKey:"mean_r2"},{id:"pattern_recognition",label:"Patterns",metricKey:"sequence_count"},{id:"drift_monitor",label:"Drift",metricKey:"drift_count"}]},action:{label:"ACTION PLANE",nodes:[{id:"shadow_engine",label:"Shadow",metricKey:"accuracy"},{id:"orchestrator",label:"Orchestr.",metricKey:"pending_count"},{id:"pipeline_gates",label:"Gates",metricKey:"pipeline_stage"},{id:"feedback_health",label:"Feedback",metricKey:"feedback_fresh"}]}};function wv(t,a){let r=t?.[a];return r==="running"?"healthy":r==="failed"?"blocked":"waiting"}function kv(t,a){let r=t?.capabilities?.data||{},s=t?.pipeline?.data||{},n=t?.shadow_accuracy?.data||{},o=t?.activity_labels?.data||{},l=t?.feedback_health||{};switch(a.id){case"discovery":{let i=Object.values(r).filter(d=>d&&typeof d=="object"&&d.entities).reduce((d,u)=>d+(u.entities?.length||0),0);return i?`${i} entities`:"\u2014"}case"activity_monitor":return s?.events_per_minute?`${s.events_per_minute.toFixed(1)} ev/m`:"\u2014";case"data_quality":return s?.included_entities?`${s.included_entities} incl.`:"\u2014";case"activity_labeler":return o?.current_activity?.predicted||"\u2014";case"intelligence":return s?.intelligence_day?`Day ${s.intelligence_day}`:"\u2014";case"ml_engine":{let i=Object.values(r).filter(u=>u?.ml_accuracy);return i.length===0?"\u2014":`R\xB2: ${(i.reduce((u,y)=>u+(y.ml_accuracy.mean_r2||0),0)/i.length).toFixed(2)}`}case"pattern_recognition":return"\u2014";case"drift_monitor":return`${Object.values(r).filter(d=>d?.drift_flagged).length} flagged`;case"shadow_engine":return n?.overall_accuracy?`${(n.overall_accuracy*100).toFixed(0)}%`:"\u2014";case"orchestrator":return"\u2014";case"pipeline_gates":return s?.stage||"shadow";case"feedback_health":return`${(l?.capabilities_with_ml_feedback||0)+(l?.capabilities_with_shadow_feedback||0)} fresh`;default:return"\u2014"}}function Sv({x:t,y:a,status:r,label:s,metric:n,glowing:o,animateMetric:l}){let i={healthy:"var(--status-healthy)",waiting:"var(--status-waiting)",blocked:"var(--status-error)",review:"var(--status-warning)"},d=i[r]||i.waiting;return e("g",{transform:`translate(${t}, ${a})`},e("rect",{width:"180",height:"55",rx:"4",fill:"var(--bg-surface)",stroke:o?"var(--accent)":"var(--border-primary)","stroke-width":o?"2":"1"}),o&&e("rect",{width:"180",height:"55",rx:"4",fill:"none",stroke:"var(--accent)","stroke-width":"1",opacity:"0.3"},e("animate",{attributeName:"opacity",values:"0.3;0.1;0.3",dur:"2s",repeatCount:"1"})),e("circle",{cx:"16",cy:"16",r:"5",fill:d,filter:"url(#led-glow)"},(r==="healthy"||o)&&e("animate",{attributeName:"opacity",values:"1;0.6;1",dur:o?"1s":"3s",repeatCount:"indefinite"})),e("text",{x:"28",y:"20",fill:"var(--text-primary)","font-size":"11","font-weight":"600","font-family":"var(--font-mono)"},s),e("text",{x:"16",y:"42",fill:"var(--text-tertiary)","font-size":"10","font-family":"var(--font-mono)",class:l?"t2-typewriter":""},n))}function Cv({x:t,y:a,label:r}){return e("text",{x:t,y:a,"text-anchor":"middle",fill:"var(--text-tertiary)","font-size":"10","font-weight":"700","font-family":"var(--font-mono)","letter-spacing":"2"},r)}function Ws({x:t,y1:a,y2:r,label:s,stale:n,flashing:o}){return e("g",{class:o?" animate-data-refresh":""},e("line",{x1:t,y1:a,x2:t,y2:r,class:n?"":"bus-connector-line",stroke:n?"var(--status-error)":"var(--border-primary)","stroke-width":"1","stroke-dasharray":n?"2 4":void 0}),n&&e("g",{transform:`translate(${t-4}, ${(a+r)/2-6})`},e("circle",{cx:"4",cy:"4",r:"6",fill:"var(--status-error)",opacity:"0.2"}),e("text",{x:"4",y:"7","text-anchor":"middle",fill:"var(--status-error)","font-size":"9","font-weight":"bold","font-family":"var(--font-mono)"},"!")),s&&e("text",{x:t+4,y:(a+r)/2,fill:n?"var(--status-error)":"var(--text-tertiary)","font-size":"8","font-family":"var(--font-mono)"},s))}var ud={capabilities:{section:"data",index:0},entities:{section:"data",index:0},activity_summary:{section:"data",index:1},entity_curation:{section:"data",index:2},activity_labels:{section:"data",index:3},ml_accuracy:{section:"learning",index:1},shadow_accuracy:{section:"learning",index:1}},Av=2880*60*1e3;function Eo(t){if(!t)return!0;let a=typeof t=="string"?new Date(t).getTime():t;return isNaN(a)?!0:Date.now()-a>Av}function Tv(t){if(!t)return 1.5;let r=[t.capabilities_with_ml_feedback,t.capabilities_with_shadow_feedback,t.total_feedback_entries,t.feedback_sources_active,t.capabilities_with_drift_feedback].filter(s=>s&&s>0).length;return r>=5?3:r>=3?2.5:r>=1?2:1.5}function Mv({moduleStatuses:t,cacheData:a,feedbackHealth:r}){let s=[50,260,470,680],n=["entities","events","rules","labels"],o=["","accuracy","",""],[l,i]=I({}),d=Pt({});oe(()=>{let P=Object.keys(ud),H={};P.forEach(U=>{let j=$a(U);H[U]=j.value.lastFetched||0});let N=setInterval(()=>{P.forEach(U=>{let L=$a(U).value.lastFetched||0;if(L>H[U]&&H[U]>0){let q=ud[U],G=`${q.section}-${q.index}`;i(Z=>({...Z,[G]:!0})),clearTimeout(d.current[G]),d.current[G]=setTimeout(()=>{i(Z=>({...Z,[G]:!1}))},300)}H[U]=L})},200);return()=>{clearInterval(N),Object.values(d.current).forEach(clearTimeout)}},[]);let u=Pt(null),[y,f]=I(!1),[v,x]=I(!1),h=Pt(null),A=a?.activity_labels?.data?.current_activity?.predicted||null;oe(()=>(u.current!==null&&A!==u.current&&A!==null&&(f(!0),x(!0),clearTimeout(h.current),h.current=setTimeout(()=>{f(!1),x(!1)},2e3)),u.current=A,()=>clearTimeout(h.current)),[A]);let C=r||{},M=[!1,Eo(C.last_ml_feedback_at),!1,!1],_=[Eo(C.last_shadow_feedback_at),!1,!1,Eo(C.last_feedback_at)],k=Tv(r);function S(P,H){let N=_v[P];return e("g",{transform:`translate(0, ${H})`},e(Cv,{x:450,y:15,label:N.label}),N.nodes.map((U,j)=>{let L=U.id==="activity_labeler";return e(Sv,{key:U.id,x:s[j],y:25,status:wv(t,U.id),label:U.label,metric:kv(a,U),glowing:L&&y,animateMetric:L&&v})}))}let O="M350,230 L350,272 L140,272 L140,122 L870,122 L870,175";return e("section",{class:"t-terminal-bg rounded-lg p-4 overflow-x-auto"},e("svg",{viewBox:"0 0 900 530",class:"w-full",style:"min-width: 700px; max-width: 100%;"},e("defs",null,e("pattern",{id:"bus-flow",width:"20",height:"4",patternUnits:"userSpaceOnUse"},e("rect",{width:"10",height:"4",fill:"var(--accent)",opacity:"0.5"},e("animate",{attributeName:"x",from:"-20",to:"20",dur:"1.5s",repeatCount:"indefinite"}))),e("pattern",{id:"feedback-flow",width:"20",height:"4",patternUnits:"userSpaceOnUse"},e("rect",{width:"10",height:"4",fill:"var(--status-healthy)",opacity:"0.5"},e("animate",{attributeName:"x",from:"20",to:"-20",dur:"2s",repeatCount:"indefinite"}))),e("filter",{id:"led-glow"},e("feGaussianBlur",{stdDeviation:"2",result:"blur"}),e("feMerge",null,e("feMergeNode",{in:"blur"}),e("feMergeNode",{in:"SourceGraphic"}))),e("filter",{id:"tracer-glow"},e("feGaussianBlur",{stdDeviation:"4",result:"blur"}),e("feMerge",null,e("feMergeNode",{in:"blur"}),e("feMergeNode",{in:"SourceGraphic"})))),S("data",0),s.map((P,H)=>e(Ws,{key:`dc${H}`,x:P+90,y1:80,y2:110,label:n[H],flashing:l[`data-${H}`]})),e("g",{transform:"translate(0, 110)"},e("rect",{x:"30",y:"0",width:"840",height:"24",rx:"4",fill:"url(#bus-flow)"}),e("rect",{x:"30",y:"0",width:"840",height:"24",rx:"4",fill:"none",stroke:"var(--accent)","stroke-width":k,opacity:"0.4",style:"transition: stroke-width 0.5s ease;"}),e("text",{x:"450",y:"16","text-anchor":"middle",fill:"var(--accent)","font-size":"9","font-family":"var(--font-mono)"},"CAPABILITIES BUS  [entities] [activity] [curation] [labels] [usefulness]"),e("circle",{r:"3",fill:"var(--accent)"},e("animateMotion",{dur:"3s",repeatCount:"indefinite",path:"M30,12 L870,12"}))),s.map((P,H)=>e(Ws,{key:`cl${H}`,x:P+90,y1:134,y2:160})),S("learning",150),s.map((P,H)=>e(Ws,{key:`lf${H}`,x:P+90,y1:230,y2:260,label:o[H],stale:M[H],flashing:l[`learning-${H}`]})),e("g",{transform:"translate(0, 260)"},e("rect",{x:"30",y:"0",width:"840",height:"24",rx:"4",fill:"url(#feedback-flow)"}),e("rect",{x:"30",y:"0",width:"840",height:"24",rx:"4",fill:"none",stroke:"var(--status-healthy)","stroke-width":k,opacity:"0.4",style:"transition: stroke-width 0.5s ease;"}),e("text",{x:"450",y:"16","text-anchor":"middle",fill:"var(--status-healthy)","font-size":"9","font-family":"var(--font-mono)"},"FEEDBACK BUS  [accuracy] [hit_rate] [suggestions] [drift] [corrections]"),e("circle",{r:"3",fill:"var(--status-healthy)"},e("animateMotion",{dur:"4s",repeatCount:"indefinite",path:"M870,12 L30,12"}))),s.map((P,H)=>e(Ws,{key:`fa${H}`,x:P+90,y1:284,y2:310,stale:_[H]})),S("action",300),e("g",{transform:"translate(310, 390)"},e("rect",{x:"0",y:"0",width:"280",height:"35",rx:"4",fill:"var(--bg-inset)",stroke:"var(--accent)","stroke-width":"2"}),e("text",{x:"140",y:"22","text-anchor":"middle",fill:"var(--accent)","font-size":"12","font-weight":"bold","font-family":"var(--font-mono)"},"YOU:  Label \xB7 Curate \xB7 Review \xB7 Advance")),e("circle",{r:"4",fill:"var(--status-healthy)",opacity:"0.9",filter:"url(#tracer-glow)"},e("animateMotion",{dur:"10s",repeatCount:"indefinite",path:O}),e("animate",{attributeName:"r",values:"4;6;4",dur:"10s",repeatCount:"indefinite"})),e("circle",{r:"7",fill:"var(--status-healthy)",opacity:"0.25",filter:"url(#tracer-glow)"},e("animateMotion",{dur:"10s",repeatCount:"indefinite",path:O,begin:"0.5s"}),e("animate",{attributeName:"r",values:"7;10;7",dur:"10s",repeatCount:"indefinite",begin:"0.5s"}))))}function Ev({maturity:t,shadowStage:a}){let r=t&&t.phase||"collecting",s=Mo.indexOf(r);return e("section",{class:"t-frame","data-label":"system maturity"},e("div",{class:"flex items-center gap-1 mb-2"},Mo.map((n,o)=>{let l="var(--bg-inset)";return o<s?l="var(--status-healthy)":o===s&&(l="var(--accent)"),e("div",{key:n,class:"h-2 flex-1",style:`border-radius: var(--radius); background: ${l};`})})),e("div",{class:"flex justify-between text-xs"},Mo.map((n,o)=>{let l="var(--text-tertiary)",i="normal";return o<s?l="var(--status-healthy)":o===s&&(l="var(--accent)",i="500"),e("span",{key:n,style:`color: ${l}; font-weight: ${i};`},hv[o])})),e("p",{class:"text-xs mt-2",style:"color: var(--text-tertiary)"},s>=0&&s<dd.length?dd[s]:"",a?` \u2014 Pipeline: ${a}`:""))}function $v({activity:t,intraday:a}){let r=t&&t.data&&t.data.data||null,s=r&&r.websocket||null,n=r&&r.activity_rate||null,o=n?n.current:null,l=r&&r.occupancy||null,i=Array.isArray(a)&&a.length>0?a[a.length-1]:null,d=i?i.lights_on??null:null,u=i?i.power_watts??null:null;return e("section",{class:"t-frame","data-label":"live metrics"},e("div",{class:"flex flex-wrap items-center gap-x-5 gap-y-2 text-sm"},e("div",{class:"flex items-center gap-1.5"},e("span",{style:"color: var(--text-tertiary)"},"Occupancy"),e("span",{class:"font-medium",style:"color: var(--text-primary)"},l&&l.anyone_home?"Home":l?"Away":"\u2014")),e("div",{class:"flex items-center gap-1.5"},e("span",{style:"color: var(--text-tertiary)"},"Events"),e("span",{class:"data-mono font-medium",style:"color: var(--text-primary)"},o!=null?`${o}/min`:"\u2014")),e("div",{class:"flex items-center gap-1.5"},e("span",{style:"color: var(--text-tertiary)"},"Lights"),e("span",{class:"data-mono font-medium",style:"color: var(--text-primary)"},d!=null?`${d} on`:"\u2014")),e("div",{class:"flex items-center gap-1.5"},e("span",{style:"color: var(--text-tertiary)"},"Power"),e("span",{class:"data-mono font-medium",style:"color: var(--text-primary)"},u!=null?`${Math.round(u)} W`:"\u2014")),e("div",{class:"flex items-center gap-1.5"},e("span",{class:"w-2 h-2 rounded-full",style:`background: ${s&&s.connected?"var(--status-healthy)":"var(--status-error)"};`}),e("span",{style:"color: var(--text-tertiary)"},"WebSocket"),e("span",{class:"font-medium",style:"color: var(--text-primary)"},s&&s.connected?"Connected":s===null?"\u2014":"Disconnected"))))}function $o(){let t=Re("intelligence"),a=Re("activity_summary"),r=Re("entities"),[s,n]=I(null),[o,l]=I(null),[i,d]=I(null),[u,y]=I(null),[f,v]=I(null),[x,h]=I(null);oe(()=>{Promise.all([ie("/health").catch(()=>null),ie("/api/shadow/accuracy").catch(()=>null),ie("/api/pipeline").catch(()=>null),ie("/api/curation/summary").catch(()=>null),ie("/api/capabilities/feedback/health").catch(()=>null),ie("/api/activity/current").catch(()=>null)]).then(([O,P,H,N,U,j])=>{n(O),l(P),d(H),y(N),v(U)}).catch(O=>h(O.message||String(O)))},[]);let A=t.loading||a.loading||r.loading,C=t.error||a.error||r.error,M=ve(()=>!t.data||!t.data.data?null:t.data.data.data_maturity||null,[t.data]),_=ve(()=>!t.data||!t.data.data?null:t.data.data.intraday_trend||null,[t.data]),k=ve(()=>i&&i.current_stage||null,[i]),S=ve(()=>({capabilities:r.data,pipeline:{data:i},shadow_accuracy:{data:o},activity_labels:a.data,feedback_health:f}),[r.data,i,o,a.data,f]);return A&&!t.data?e("div",{class:"space-y-6"},e("div",{class:"t-frame","data-label":"aria"},e(vr,{className:"w-24 mb-1",color:"var(--text-primary)"}),e("p",{class:"text-sm",style:"color: var(--text-tertiary); font-family: var(--font-mono);"},"Live system overview \u2014 data flow, module health, and your next steps.")),e(ke,{type:"full"})):C?e("div",{class:"space-y-6"},e("div",{class:"t-frame","data-label":"aria"},e(vr,{className:"w-24 mb-1",color:"var(--text-primary)"}),e("p",{class:"text-sm",style:"color: var(--text-tertiary); font-family: var(--font-mono);"},"Live system overview \u2014 data flow, module health, and your next steps.")),e(fe,{error:C,onRetry:()=>{t.refetch(),a.refetch(),r.refetch()}})):x?e("div",{class:"space-y-6"},e(ce,{page:"HOME",subtitle:"Live system overview \u2014 data flow, module health, and your next steps."}),e(fe,{error:x})):e("div",{class:"space-y-6 animate-page-enter"},e(ce,{page:"HOME",subtitle:"Live system overview \u2014 data flow, module health, and your next steps."}),e(Oe,{value:i?i.current_stage:"starting",label:"pipeline stage",delta:M?`Day ${M.days_of_data} \xB7 ${M.phase}`:null}),e(Ev,{maturity:M,shadowStage:k}),e($v,{activity:a,intraday:_}),e(To,null),e(Mv,{moduleStatuses:s?.modules||{},cacheData:S,feedbackHealth:f}))}function Po({items:t}){return!t||t.length===0?null:e("div",{class:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3"},t.map((a,r)=>e("div",{key:r,class:"t-frame",style:`padding: 12px 16px;${a.warning?" border-left: 3px solid var(--status-warning);":""}`},e("div",{class:"data-mono",style:`font-size: var(--type-data); font-weight: 600; color: ${a.warning?"var(--status-warning)":"var(--accent)"};`},a.value),e("div",{class:"t-bracket",style:"margin-top: 4px;"},a.label),a.subtitle&&e("div",{class:"text-xs",style:"color: var(--text-tertiary); margin-top: 2px;"},a.subtitle))))}function Lo(t,a,r=200){let[s,n]=I(""),[o,l]=I(""),i=Pt(null);oe(()=>(i.current!=null&&clearTimeout(i.current),i.current=setTimeout(()=>{l(s)},r),()=>{i.current!=null&&clearTimeout(i.current)}),[s,r]);let d=Fe(()=>{if(!t||!Array.isArray(t))return[];if(!o||!a||a.length===0)return t;let u=o.toLowerCase();return t.filter(y=>a.some(f=>{let v=y[f];return v==null?!1:String(v).toLowerCase().includes(u)}))},[t,o,a]);return{searchTerm:s,setSearchTerm:n,filteredData:d}}function Do(t,a=50){let[r,s]=I(0),n=t?t.length:0;oe(()=>{s(0)},[n]);let o=Math.max(1,Math.ceil(n/a)),l=Fe(()=>{if(!t||t.length===0)return[];let f=r*a;return t.slice(f,f+a)},[t,r,a]),i=n===0?0:r*a+1,d=Math.min((r+1)*a,n);function u(){s(f=>Math.min(f+1,o-1))}function y(){s(f=>Math.max(f-1,0))}return{page:r,pageData:l,nextPage:u,prevPage:y,totalPages:o,total:n,startIndex:i,endIndex:d}}function Vs({columns:t,data:a,searchFields:r=[],pageSize:s=50,searchPlaceholder:n="Search...",filterContent:o}){let l=a||[],{searchTerm:i,setSearchTerm:d,filteredData:u}=Lo(l,r),[y,f]=I({key:null,direction:"asc"});function v(N){f(U=>U.key===N?{key:N,direction:U.direction==="asc"?"desc":"asc"}:{key:N,direction:"asc"})}let x=Fe(()=>y.key?[...u].sort((N,U)=>{let j=N[y.key],L=U[y.key];if(j==null&&L==null)return 0;if(j==null)return 1;if(L==null)return-1;let q;return typeof j=="number"&&typeof L=="number"?q=j-L:q=String(j).localeCompare(String(L),void 0,{numeric:!0,sensitivity:"base"}),y.direction==="asc"?q:-q}):u,[u,y.key,y.direction]),{pageData:h,nextPage:A,prevPage:C,totalPages:M,total:_,startIndex:k,endIndex:S,page:O}=Do(x,s),P=O>0,H=O<M-1;return e("div",{class:"t-card",style:"overflow: hidden;"},e("div",{class:"px-4 py-3",style:"border-bottom: 1px solid var(--border-subtle);"},e("div",{class:"flex flex-col sm:flex-row sm:items-center gap-3"},e("div",{class:"relative flex-1 max-w-sm"},e("input",{type:"text",value:i,onInput:N=>d(N.target.value),placeholder:n,class:"t-input w-full px-3 py-1.5 text-sm"}),i&&e("span",{class:"absolute right-2 top-1/2 -translate-y-1/2 text-xs",style:"color: var(--text-tertiary);"},u.length," / ",l.length))),o&&e("div",{class:"mt-3"},o)),e("div",{class:"overflow-x-auto"},e("table",{class:"w-full"},e("thead",null,e("tr",{style:"background: var(--bg-surface-raised);"},t.map(N=>e("th",{key:N.key,class:`px-4 py-2 text-left ${N.sortable?"cursor-pointer select-none":""} ${N.className||""}`,style:"color: var(--text-tertiary); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 500;",onClick:N.sortable?()=>v(N.key):void 0},e("span",{class:"inline-flex items-center gap-1"},N.label,N.sortable&&e(Pv,{active:y.key===N.key,direction:y.direction})))))),e("tbody",null,h.length===0?e("tr",null,e("td",{colSpan:t.length,class:"px-4 py-12 text-center text-sm",style:"color: var(--text-tertiary);"},l.length===0?"No data available":"No results match your filters")):h.map((N,U)=>e("tr",{key:N.id||N.entity_id||U,style:"border-bottom: 1px solid var(--border-subtle);"},t.map(j=>e("td",{key:j.key,class:`px-4 py-2 text-sm ${j.className||""}`,style:"color: var(--text-secondary);"},j.render?j.render(N[j.key],N):N[j.key]!=null?N[j.key]:"\u2014"))))))),_>0&&e("div",{class:"px-4 py-3 flex items-center justify-between",style:"border-top: 1px solid var(--border-subtle);"},e("span",{class:"text-sm",style:"color: var(--text-tertiary);"},"Showing ",k,"\\u2013",S," of ",_),e("div",{class:"flex gap-2"},e("button",{onClick:C,disabled:!P,class:"px-3 py-1 text-sm disabled:opacity-50 disabled:cursor-not-allowed",style:"color: var(--text-secondary); background: var(--bg-surface-raised); border: 1px solid var(--border-primary); border-radius: var(--radius);"},"Previous"),e("button",{onClick:A,disabled:!H,class:"px-3 py-1 text-sm disabled:opacity-50 disabled:cursor-not-allowed",style:"color: var(--text-secondary); background: var(--bg-surface-raised); border: 1px solid var(--border-primary); border-radius: var(--radius);"},"Next"))))}function Pv({active:t,direction:a}){return t?a==="asc"?e("svg",{class:"w-3 h-3",style:"color: var(--text-primary);",viewBox:"0 0 12 12",fill:"currentColor"},e("path",{d:"M6 2l3 4H3z"})):e("svg",{class:"w-3 h-3",style:"color: var(--text-primary);",viewBox:"0 0 12 12",fill:"currentColor"},e("path",{d:"M6 10l-3-4h6z"})):e("svg",{class:"w-3 h-3",style:"color: var(--text-tertiary);",viewBox:"0 0 12 12",fill:"currentColor"},e("path",{d:"M6 2l3 4H3z"}),e("path",{d:"M6 10l-3-4h6z"}))}function Ro({data:t,total:a}){if(!t||t.length===0)return null;let r=t[0]?.count||1;return e("div",{class:"space-y-2"},t.map(s=>{let n=a>0?(s.count/a*100).toFixed(1):0,o=r>0?s.count/r*100:0;return e("div",{key:s.domain,class:"flex items-center gap-2"},e("span",{class:"w-28 text-sm text-right truncate",style:"color: var(--text-secondary);",title:s.domain},s.domain),e("div",{class:"flex-1 h-6 overflow-hidden",style:"background: var(--bg-inset); border-radius: var(--radius);"},e("div",{class:"h-full transition-all",style:`background: var(--accent); border-radius: var(--radius); width: ${o}%;`})),e("span",{class:"w-20 text-sm data-mono",style:"color: var(--text-tertiary);"},s.count," (",n,"%)"))}))}function Xr({state:t}){let a=(t||"").toLowerCase(),r;return a==="on"||a==="home"?r="t-status-healthy":a==="unavailable"||a==="unknown"?r="t-status-error":t!=null&&t!==""&&!isNaN(Number(t))?r="t-status-healthy":r="t-status-waiting",e("span",{class:`t-status ${r}`},e("span",{style:"display: inline-block; width: 5px; height: 5px; border-radius: 50%; background: currentColor;"}),t)}var Gs={};function Io(t,a){if(t.area_id)return t.area_id;if(t.device_id){let r=a[t.device_id];if(r&&r.area_id)return r.area_id}return null}function No(){let t=Re("entities"),a=Re("devices"),r=Re("areas"),s=Re("capabilities"),[n,o]=I(""),[l,i]=I(""),[d,u]=I(""),y=t.loading||a.loading||r.loading||s.loading,f=t.error||a.error||r.error||s.error,v=t.data?.data||Gs,x=a.data?.data||Gs,h=r.data?.data||Gs,A=s.data?.data||Gs,C=ve(()=>Object.entries(v).map(([E,$])=>({entity_id:E,...$})),[v]),M=ve(()=>{let E=C.filter(se=>se.state==="unavailable"),$=E.length,re=Date.now(),we=E.filter(se=>{if(!se.last_changed)return!1;let ge=new Date(se.last_changed).getTime();return re-ge>1440*60*1e3}).length;return{total:$,longUnavailable:we}},[C]),_=M.total,k=ve(()=>t.data?[{label:"Entities",value:C.length.toLocaleString()},{label:"Devices",value:Object.keys(x).length.toLocaleString()},{label:"Areas",value:Object.keys(h).length.toLocaleString()},{label:"Capabilities",value:Object.keys(A).length.toLocaleString()},{label:"Unavailable",value:_,subtitle:M.longUnavailable>0?`${M.longUnavailable} > 24h`:void 0,warning:_>100}]:null,[t.data,C,x,h,A,_,M]),S=ve(()=>{let E={};for(let $ of C){let re=$.domain||$.entity_id?.split(".")[0]||"unknown";E[re]=(E[re]||0)+1}return Object.entries(E).map(([$,re])=>({domain:$,count:re})).sort(($,re)=>re.count-$.count)},[C]),O=ve(()=>{let E={};for(let $ of C){let re=Io($,x);re&&(E[re]=(E[re]||0)+1)}return Object.entries(h).map(([$,re])=>({area_id:$,name:re.name||$,count:E[$]||0})).sort(($,re)=>re.count-$.count)},[C,h,x]),P=ve(()=>[...new Set(C.map($=>$.domain||$.entity_id?.split(".")[0]))].sort(),[C]),H=ve(()=>[...new Set(C.map($=>$.state).filter(Boolean))].sort(),[C]),N=ve(()=>Object.entries(h).map(([E,$])=>({id:E,name:$.name||E})).sort((E,$)=>E.name.localeCompare($.name)),[h]),U=Fe(()=>{let E=C;return n&&(E=E.filter($=>($.domain||$.entity_id?.split(".")[0])===n)),l&&(E=E.filter($=>$.state===l)),d&&(E=E.filter($=>Io($,x)===d)),E},[C,n,l,d,x]),j=[{key:"friendly_name",label:"Entity",sortable:!0,render:(E,$)=>e("div",null,e("div",{class:"font-semibold",style:"color: var(--text-primary)"},$.friendly_name||$.entity_id),e("div",{class:"text-xs data-mono",style:"color: var(--text-tertiary)"},$.entity_id))},{key:"state",label:"State",sortable:!0,render:(E,$)=>e("span",{class:"inline-flex items-center gap-1"},e(Xr,{state:E}),$.unit_of_measurement&&e("span",{class:"text-xs",style:"color: var(--text-tertiary)"},$.unit_of_measurement))},{key:"domain",label:"Domain",sortable:!0,render:(E,$)=>{let re=E||$.entity_id?.split(".")[0]||"\u2014";return e("span",{class:"inline-block px-2 py-0.5 text-xs font-medium",style:"background: var(--bg-inset); color: var(--text-primary); border-radius: var(--radius);"},re)}},{key:"device_class",label:"Class",sortable:!0,render:E=>E||"\u2014"},{key:"area_id",label:"Area",sortable:!0,render:(E,$)=>{let re=Io($,x);if(!re)return"\u2014";let we=h[re];return we?we.name:re}},{key:"device_id",label:"Device",sortable:!0,render:E=>{if(!E)return"\u2014";let $=x[E];return $?$.name:E}}],L=ve(()=>Object.entries(x).map(([E,$])=>({device_id:E,...$,area_name:$.area_id&&h[$.area_id]?h[$.area_id].name:$.area_id||"\u2014"})),[x,h]),q=[{key:"name",label:"Name",sortable:!0,render:(E,$)=>e("div",null,e("div",{class:"font-semibold",style:"color: var(--text-primary)"},E||$.device_id),e("div",{class:"text-xs data-mono",style:"color: var(--text-tertiary)"},$.device_id))},{key:"manufacturer",label:"Manufacturer",sortable:!0,render:E=>E||"\u2014"},{key:"model",label:"Model",sortable:!0,render:E=>E||"\u2014"},{key:"area_name",label:"Area",sortable:!0,render:E=>E||"\u2014"}],G=e("div",{class:"flex flex-wrap gap-3"},e("select",{value:n,onChange:E=>o(E.target.value),class:"t-input px-2 py-1.5 text-sm"},e("option",{value:""},"All domains"),P.map(E=>e("option",{key:E,value:E},E))),e("select",{value:l,onChange:E=>i(E.target.value),class:"t-input px-2 py-1.5 text-sm"},e("option",{value:""},"All states"),e("option",{value:"on"},"on"),e("option",{value:"off"},"off"),e("option",{value:"unavailable"},"unavailable"),H.filter(E=>E!=="on"&&E!=="off"&&E!=="unavailable").map(E=>e("option",{key:E,value:E},E))),e("select",{value:d,onChange:E=>u(E.target.value),class:"t-input px-2 py-1.5 text-sm"},e("option",{value:""},"All areas"),N.map(E=>e("option",{key:E.id,value:E.id},E.name))),(n||l||d)&&e("button",{onClick:()=>{o(""),i(""),u("")},class:"px-2 py-1.5 text-sm",style:"color: var(--accent);"},"Clear filters")),Z="Everything the hub found by scanning your Home Assistant instance. Rescans automatically every 24 hours.";if(y&&!t.data)return e("div",{class:"space-y-6"},e("div",null,e("h1",{class:"text-2xl font-bold",style:"color: var(--text-primary)"},"Discovery"),e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},Z)),e(ke,{type:"full"}));if(f)return e("div",{class:"space-y-6"},e("div",null,e("h1",{class:"text-2xl font-bold",style:"color: var(--text-primary)"},"Discovery"),e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},Z)),e(fe,{error:f,onRetry:()=>{t.refetch(),a.refetch(),r.refetch(),s.refetch()}}));let Y=Object.keys(h).length;return e("div",{class:"space-y-6 animate-page-enter"},e(ce,{page:"DISCOVERY",subtitle:"Every entity, device, and area in your home."}),e(Oe,{value:C.length.toLocaleString(),label:"entities discovered",delta:`across ${Y} area${Y!==1?"s":""}`,loading:y}),k?e(Po,{items:k}):e(ke,{type:"stats"}),e("section",null,e("div",{class:"t-section-header mb-4",style:"padding-bottom: 6px;"},e("h2",{class:"text-lg font-semibold",style:"color: var(--text-primary)"},"Domain Breakdown"),e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},"How your entities are distributed across HA domains. Larger bars = more entities in that domain.")),e("div",{class:"t-frame","data-label":"domains",style:"padding: 1rem;"},e(Ro,{data:S,total:C.length}))),O.length>0&&e("section",null,e("div",{class:"t-section-header mb-4",style:"padding-bottom: 6px;"},e("h2",{class:"text-lg font-semibold",style:"color: var(--text-primary)"},"Areas"),e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},"Physical locations defined in Home Assistant, with entity counts per area.")),e("div",{class:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-4"},O.map(E=>e("div",{key:E.area_id,class:"t-frame","data-label":E.name,style:"padding: 1rem;"},e("div",{class:"font-semibold text-sm truncate",style:"color: var(--text-primary)",title:E.name},E.name),e("div",{class:"text-sm mt-1",style:"color: var(--text-tertiary)"},E.count," entities"))))),e("section",null,e("div",{class:"t-section-header mb-4",style:"padding-bottom: 6px;"},e("h2",{class:"text-lg font-semibold",style:"color: var(--text-primary)"},"Entities"),e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},"Every entity registered in HA \u2014 sensors, switches, lights, and more. Filter by domain, state, or area.")),e(Vs,{columns:j,data:U,searchFields:["entity_id","friendly_name","domain","device_class"],pageSize:50,searchPlaceholder:"Search entities...",filterContent:G})),e("section",null,e("div",{class:"t-section-header mb-4",style:"padding-bottom: 6px;"},e("h2",{class:"text-lg font-semibold",style:"color: var(--text-primary)"},"Devices"),e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},"Physical devices registered in HA. Each device groups multiple entities (e.g., a thermostat has temperature, humidity, and mode entities).")),e(Vs,{columns:q,data:L,searchFields:["name","device_id","manufacturer","model"],pageSize:50,searchPlaceholder:"Search devices..."})))}function Ie({title:t,subtitle:a,summary:r,defaultOpen:s=!0,loading:n=!1,children:o}){let[l,i]=I(s),d="cursor-idle";n?d="cursor-working":l&&(d="cursor-active");function u(){n||i(!l)}return e("section",null,e("button",{type:"button",onClick:u,class:`${d} w-full text-left flex items-center justify-between`,style:"padding: 8px 0; cursor: pointer; background: none; border: none; border-bottom: 1px solid var(--border-subtle);","aria-expanded":l,"aria-label":`${l?"Collapse":"Expand"} ${t}`},e("div",{class:"flex-1 min-w-0"},e("h2",{style:"font-size: var(--type-headline); color: var(--text-primary); font-family: var(--font-mono); font-weight: 700;"},t),a&&!l&&r&&e("span",{class:"t-bracket",style:"margin-left: 8px;"},r),a&&l&&e("p",{style:"font-size: var(--type-label); color: var(--text-tertiary); margin-top: 2px;"},a))),l&&e("div",{class:"animate-page-enter",style:"padding-top: 12px;"},o))}function es({value:t,label:a,sublabel:r}){let s=Math.max(0,Math.min(100,t||0)),n=s>=70?"var(--status-healthy)":s>=40?"var(--status-warning)":"var(--status-error)";return e("div",{class:"space-y-1"},e("div",{class:"flex items-center justify-between"},e("span",{style:"font-size: var(--type-label); color: var(--text-secondary); font-family: var(--font-mono);"},a),e("span",{style:"font-size: var(--type-label); font-family: var(--font-mono);"},r&&e("span",{style:"color: var(--text-tertiary); margin-right: 6px;"},r),e("span",{style:`color: ${n};`},Math.round(s),"%"))),e("div",{style:"height: 6px; border-radius: 3px; background: var(--bg-inset); overflow: hidden;"},e("div",{style:`height: 100%; width: ${s}%; background: ${n}; border-radius: 3px; transition: width 0.3s ease;`})))}function pd(t){if(!t)return"\u2014";try{return new Date(t).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}catch{return t}}function Oo({name:t,capability:a,onAction:r}){let[s,n]=I(!1),[o,l]=I(null),i=a.usefulness_components||{},d=a.entities||[],u=a.temporal_pattern||{},y=a.status||"promoted",f=[{key:"predictability",label:"Predictability"},{key:"stability",label:"Stability"},{key:"coverage",label:"Coverage"},{key:"activity",label:"Activity"},{key:"cohesion",label:"Cohesion"}],v=[{key:"description",label:"Description"},{key:"source",label:"Source"},{key:"layer",label:"Layer"},{key:"naming_method",label:"Naming"},{key:"first_seen",label:"First seen",format:pd},{key:"promoted_at",label:"Promoted",format:pd}];async function x(C){l(C);try{await fa(`/api/capabilities/${t}/${C}`),r&&r()}catch(M){console.error(`Failed to ${C} capability:`,M)}finally{l(null)}}let h=s?d:d.slice(0,5),A=d.length>5;return e("div",{class:"space-y-4",style:"padding-top: 12px; border-top: 1px solid var(--border-subtle);"},Object.keys(i).length>0&&e("div",{class:"space-y-2"},e("span",{style:"font-size: var(--type-label); color: var(--text-tertiary); font-family: var(--font-mono); text-transform: uppercase;"},"Usefulness breakdown"),f.map(({key:C,label:M})=>i[C]!=null?e(es,{key:C,value:i[C],label:M}):null)),e("div",{class:"space-y-1"},v.map(({key:C,label:M,format:_})=>{let k=a[C];if(k==null)return null;let S=_?_(k):String(k);return e("div",{key:C,class:"flex justify-between",style:"font-size: var(--type-label); font-family: var(--font-mono);"},e("span",{style:"color: var(--text-tertiary);"},M),e("span",{style:"color: var(--text-secondary);"},S))})),(u.peak_hours||u.weekday_bias)&&e("div",{class:"space-y-1"},e("span",{style:"font-size: var(--type-label); color: var(--text-tertiary); font-family: var(--font-mono); text-transform: uppercase;"},"Temporal pattern"),u.peak_hours&&e("div",{class:"flex justify-between",style:"font-size: var(--type-label); font-family: var(--font-mono);"},e("span",{style:"color: var(--text-tertiary);"},"Peak hours"),e("span",{style:"color: var(--text-secondary);"},Array.isArray(u.peak_hours)?u.peak_hours.join(", "):String(u.peak_hours))),u.weekday_bias&&e("div",{class:"flex justify-between",style:"font-size: var(--type-label); font-family: var(--font-mono);"},e("span",{style:"color: var(--text-tertiary);"},"Weekday bias"),e("span",{style:"color: var(--text-secondary);"},String(u.weekday_bias)))),d.length>0&&e("div",null,e("span",{style:"font-size: var(--type-label); color: var(--text-tertiary); font-family: var(--font-mono); text-transform: uppercase;"},"Entities (",d.length,")"),e("ul",{class:"space-y-0.5",style:"margin-top: 4px;"},h.map(C=>e("li",{key:C,class:"truncate data-mono",style:"font-size: var(--type-label); color: var(--text-tertiary);"},C))),A&&e("button",{onClick:()=>n(!s),class:"cursor-pointer",style:"font-size: var(--type-label); color: var(--accent); background: none; border: none; padding: 0; margin-top: 4px; font-family: var(--font-mono);"},s?"Show less":`Show all ${d.length}`)),e("div",{class:"flex gap-2",style:"padding-top: 8px;"},y!=="promoted"&&e("button",{onClick:()=>x("promote"),disabled:o!==null,class:"cursor-pointer",style:`font-size: var(--type-label); font-family: var(--font-mono); padding: 4px 12px; border: 1px solid var(--status-healthy); color: var(--status-healthy); background: var(--status-healthy-glow); border-radius: 4px; opacity: ${o?"0.5":"1"};`},o==="promote"?"Promoting...":"Promote"),y!=="archived"&&e("button",{onClick:()=>x("archive"),disabled:o!==null,class:"cursor-pointer",style:`font-size: var(--type-label); font-family: var(--font-mono); padding: 4px 12px; border: 1px solid var(--text-tertiary); color: var(--text-tertiary); background: none; border-radius: 4px; opacity: ${o?"0.5":"1"};`},o==="archive"?"Archiving...":"Archive")))}function fd(t){let a=(t||"").replace(/_/g," ");return a.charAt(0).toUpperCase()+a.slice(1)}var Lv={power_monitoring:{why:"Power usage follows daily patterns \u2014 morning coffee, evening TV, overnight baseline. ARIA learns your typical wattage curves and flags unusual spikes or drops.",on:"ARIA will predict your expected power draw and alert when it deviates.",off:"Power predictions disabled. ARIA will still track power but won't flag anomalies."},lighting:{why:"Lights follow routines \u2014 on at sunset, off at bedtime. ARIA learns which lights are typically on at what time of day.",on:"ARIA will predict which lights should be on and notice unexpected changes.",off:"Light predictions disabled. ARIA will still count lights but won't predict patterns."},occupancy:{why:"Presence follows your schedule \u2014 leave for work, come home in the evening. ARIA learns your typical comings and goings.",on:"ARIA will predict when you're likely home and notice unexpected absences or arrivals.",off:"Occupancy predictions disabled. ARIA will still track presence but won't predict it."},climate:{why:"Thermostats follow schedules and seasons. ARIA learns your comfort patterns and heating/cooling cycles.",on:"ARIA will predict temperature trends and notice when climate behavior changes.",off:"Climate predictions disabled. ARIA will still monitor temperature data."},battery_devices:{why:"Batteries drain predictably \u2014 sensors last weeks, tablets last hours. ARIA learns each device's discharge curve.",on:"ARIA will predict when batteries need charging and flag unusual drain.",off:"Battery predictions disabled. Levels are still tracked."},motion:{why:"Motion sensors are inherently reactive \u2014 they fire when someone walks by. Individual triggers are hard to predict, but daily patterns (busy mornings, quiet nights) can be learned.",on:"ARIA will learn your typical motion patterns and flag unusual quiet or busy periods.",off:"Motion predictions off. This is the default because individual motion events are noisy."},doors_windows:{why:"Door and window sensors track openings. Some follow routines (garage door at 8am), others are random (bathroom door). Predictions work best when you have consistent habits.",on:"ARIA will learn your door/window patterns and notice unusual activity.",off:"Door/window predictions off. This is the default because contact events vary widely."},locks:{why:"Smart locks often follow routines \u2014 lock at bedtime, unlock in the morning. If your lock usage is consistent, predictions can spot when something breaks the pattern.",on:"ARIA will learn your locking patterns and notice when they change.",off:"Lock predictions off. This is the default because lock events are security-sensitive."},media:{why:"Media playback depends on mood, not schedule. But if you have routines (morning news, bedtime podcast), ARIA can learn those patterns.",on:"ARIA will learn your media habits and predict typical playback times.",off:"Media predictions off. This is the default because playback is usually on-demand."},vacuum:{why:"Robot vacuums usually run on their own schedule, set in the robot's app. ARIA can learn when cleaning typically happens.",on:"ARIA will learn your vacuum schedule and notice missed or extra runs.",off:"Vacuum predictions off. Most vacuums have their own scheduling."}},Dv={why:"ARIA can attempt to learn patterns for this capability based on your historical data.",on:"Predictions enabled \u2014 ARIA will look for patterns.",off:"Predictions disabled \u2014 ARIA will still track data but won't predict."};function Rv({name:t,canPredict:a,onToggle:r}){let[s,n]=I(!1),[o,l]=I(!1),i=Lv[t]||Dv;async function d(){n(!0);try{await r(t,!a)}finally{n(!1)}}return e("div",{class:"space-y-2"},e("div",{class:"flex items-center justify-between"},e("div",{class:"flex items-center gap-2"},e("span",{class:"text-sm font-medium",style:"color: var(--text-secondary)"},"Predictions"),e("button",{onClick:()=>l(!o),class:"text-xs cursor-pointer",style:"color: var(--accent); background: none; border: none; padding: 0;",title:"Why?"},o?"hide":"why?")),e("button",{onClick:d,disabled:s,class:"relative inline-flex items-center h-6 w-11 rounded-full cursor-pointer transition-colors",style:`background: ${a?"var(--accent)":"var(--bg-inset)"}; border: 2px solid ${a?"var(--accent)":"var(--border-subtle)"}; opacity: ${s?"0.5":"1"};`,title:a?"Click to disable predictions":"Click to enable predictions"},e("span",{class:"inline-block h-4 w-4 rounded-full transition-transform",style:`background: ${a?"var(--bg-base)":"var(--text-tertiary)"}; transform: translateX(${a?"20px":"2px"});`}))),e("p",{class:"text-xs",style:`color: ${a?"var(--status-healthy)":"var(--text-tertiary)"}`},a?i.on:i.off),o&&e("div",{class:"t-callout p-2 text-xs",style:"color: var(--text-secondary); line-height: 1.5;"},i.why))}function Ho({name:t,capability:a,onTogglePredict:r,onAction:s}){let[n,o]=I(!1),l=a.entities||[],i=a.entity_count||l.length,d=a.can_predict??!1,u=a.usefulness??null,y=a.source||null,f=a.layer||null,v=a.status||"promoted",x=a.stability_streak??null;return e("div",{class:"t-frame","data-label":fd(t),style:"padding: 1rem; cursor: pointer;",onClick:()=>o(!n)},e("div",{class:"flex items-center justify-between mb-2",style:"flex-wrap: wrap; gap: 4px;"},e("h3",{class:"text-base font-bold",style:"color: var(--text-primary); margin: 0;"},fd(t)),e("div",{class:"flex items-center gap-1",style:"flex-wrap: wrap;"},e("span",{class:"inline-block px-2 py-0.5 rounded-full text-xs font-medium",style:"background: var(--accent-glow); color: var(--accent); white-space: nowrap;"},i," ",i===1?"entity":"entities"),y&&e("span",{class:"inline-block px-2 py-0.5 rounded-full text-xs font-medium",style:`white-space: nowrap; ${y==="organic"?"background: var(--status-healthy-glow); color: var(--status-healthy);":"background: var(--bg-surface-raised); color: var(--text-tertiary);"}`},y),f&&e("span",{class:"inline-block px-2 py-0.5 rounded-full text-xs font-medium",style:`white-space: nowrap; ${f==="behavioral"?"background: color-mix(in srgb, var(--accent-purple) 15%, transparent); color: var(--accent-purple);":"background: var(--bg-surface-raised); color: var(--text-secondary);"}`},f))),u!=null&&e("div",{style:"margin-bottom: 8px;"},e(es,{value:u,label:"Usefulness"})),v==="candidate"&&x!=null&&e("div",{style:"font-size: var(--type-label); color: var(--text-tertiary); font-family: var(--font-mono); margin-bottom: 8px;"},"Stability streak: ",e("span",{style:`color: ${x>=7?"var(--status-healthy)":"var(--text-secondary)"};`},x,"d")),v==="promoted"&&e("div",{class:"mb-2 pb-2",style:"border-bottom: 1px solid var(--border-subtle);",onClick:h=>h.stopPropagation()},e(Rv,{name:t,canPredict:d,onToggle:r})),n&&e("div",{onClick:h=>h.stopPropagation()},e(Oo,{name:t,capability:a,onAction:s})))}function Iv({data:t}){if(!t)return null;let a=t.discovery_metadata||t.metadata||{},r=a.last_organic_run||a.last_run||null,s=a.autonomy_mode||null,n=a.naming_backend||null;return!r&&!s&&!n?null:e("div",{class:"t-frame","data-label":"Discovery",style:"padding: 0.75rem;"},e("div",{class:"flex items-center gap-4",style:"flex-wrap: wrap; font-size: var(--type-label); font-family: var(--font-mono);"},r&&e("span",{style:"color: var(--text-secondary);"},"Last run: ",e("span",{style:"color: var(--text-primary);"},Nv(r))),s&&e("span",{style:"color: var(--text-secondary);"},"Mode: ",e("span",{style:"color: var(--accent);"},s)),n&&e("span",{style:"color: var(--text-secondary);"},"Naming: ",e("span",{style:"color: var(--text-primary);"},n))))}function Nv(t){if(!t)return"\u2014";try{let a=new Date(t),s=new Date-a,n=Math.floor(s/6e4);if(n<1)return"just now";if(n<60)return`${n}m ago`;let o=Math.floor(n/60);return o<24?`${o}h ago`:a.toLocaleDateString(void 0,{month:"short",day:"numeric"})}catch{return t}}function vd(t){switch(t){case"stable":return"var(--status-healthy)";case"experimental":return"var(--status-warning)";case"planned":return"var(--text-tertiary)";default:return"var(--text-secondary)"}}function md(t){switch(t){case"stable":return"var(--status-healthy-glow)";case"experimental":return"var(--status-warning-glow)";case"planned":return"var(--bg-surface-raised)";default:return"var(--bg-surface-raised)"}}function yd(t){switch(t){case"hub":return"var(--accent)";case"engine":return"var(--accent-purple)";case"dashboard":return"var(--status-warning)";default:return"var(--text-secondary)"}}function Ov(){let[t,a]=I(null),[r,s]=I(!0),[n,o]=I(null);if(oe(()=>{ie("/api/capabilities/registry").then(u=>{a(u),s(!1)}).catch(u=>{o(u.message),s(!1)})},[]),r)return e(Ie,{title:"System Registry",subtitle:"Code-declared capability inventory for regression tracking.",summary:"Loading...",defaultOpen:!1},e(ke,{type:"table"}));if(n)return e(Ie,{title:"System Registry",subtitle:"Code-declared capability inventory for regression tracking.",summary:"Error",defaultOpen:!1},e("div",{class:"t-callout p-3 text-sm",style:"color: var(--status-error);"},n));if(!t)return null;let l=t.capabilities||[],i=t.by_layer||{},d=t.by_status||{};return e(Ie,{title:"System Registry",subtitle:"Code-declared capability inventory for regression tracking.",summary:`${t.total} capabilities`,defaultOpen:!1},e("div",{class:"flex flex-wrap gap-2 mb-4"},Object.entries(i).map(([u,y])=>e("span",{key:u,class:"inline-block px-2 py-1 rounded text-xs font-medium",style:`color: ${yd(u)}; background: var(--bg-surface-raised); font-family: var(--font-mono);`},u,": ",y)),e("span",{style:"color: var(--border-subtle);"},"|"),Object.entries(d).map(([u,y])=>e("span",{key:u,class:"inline-block px-2 py-1 rounded text-xs font-medium",style:`color: ${vd(u)}; background: ${md(u)};`},u,": ",y))),e("div",{style:"overflow-x: auto;"},e("table",{style:"width: 100%; border-collapse: collapse; font-size: var(--type-body);"},e("thead",null,e("tr",{style:"border-bottom: 1px solid var(--border-subtle);"},e("th",{style:"text-align: left; padding: 8px 12px; color: var(--text-tertiary); font-weight: 600; font-size: var(--type-label);"},"ID"),e("th",{style:"text-align: left; padding: 8px 12px; color: var(--text-tertiary); font-weight: 600; font-size: var(--type-label);"},"Name"),e("th",{style:"text-align: left; padding: 8px 12px; color: var(--text-tertiary); font-weight: 600; font-size: var(--type-label);"},"Layer"),e("th",{style:"text-align: left; padding: 8px 12px; color: var(--text-tertiary); font-weight: 600; font-size: var(--type-label);"},"Status"),e("th",{style:"text-align: right; padding: 8px 12px; color: var(--text-tertiary); font-weight: 600; font-size: var(--type-label);"},"Tests"),e("th",{style:"text-align: right; padding: 8px 12px; color: var(--text-tertiary); font-weight: 600; font-size: var(--type-label);"},"Config"),e("th",{style:"text-align: left; padding: 8px 12px; color: var(--text-tertiary); font-weight: 600; font-size: var(--type-label);"},"Deps"))),e("tbody",null,l.map(u=>e("tr",{key:u.id,style:"border-bottom: 1px solid var(--border-subtle);"},e("td",{style:"padding: 8px 12px; font-family: var(--font-mono); color: var(--text-primary);"},u.id),e("td",{style:"padding: 8px 12px; color: var(--text-secondary);"},u.name),e("td",{style:"padding: 8px 12px;"},e("span",{class:"inline-block px-1.5 py-0.5 rounded text-xs",style:`color: ${yd(u.layer)}; background: var(--bg-surface-raised);`},u.layer)),e("td",{style:"padding: 8px 12px;"},e("span",{class:"inline-block px-1.5 py-0.5 rounded text-xs",style:`color: ${vd(u.status)}; background: ${md(u.status)};`},u.status)),e("td",{style:"padding: 8px 12px; text-align: right; font-family: var(--font-mono); color: var(--text-secondary);"},(u.test_paths||[]).length),e("td",{style:"padding: 8px 12px; text-align: right; font-family: var(--font-mono); color: var(--text-secondary);"},(u.config_keys||[]).length),e("td",{style:"padding: 8px 12px; font-family: var(--font-mono); font-size: var(--type-label); color: var(--text-tertiary);"},(u.depends_on||[]).length>0?u.depends_on.join(", "):"\u2014")))))))}function zo(){let{data:t,loading:a,error:r,refetch:s}=Re("capabilities"),n=ve(()=>{if(!t||!t.data)return[];let v=t.data;return Object.entries(v).map(([x,h])=>({name:x,...h}))},[t]),o=ve(()=>n.filter(v=>v.status==="promoted"||!v.status),[n]),l=ve(()=>n.filter(v=>v.status==="candidate"),[n]),i=ve(()=>n.filter(v=>v.status==="archived"),[n]),d=ve(()=>n.reduce((v,x)=>v+(x.entity_count||(x.entities||[]).length),0),[n]);async function u(v,x){try{await fa(`/api/capabilities/${v}/can-predict`,{can_predict:x}),s()}catch(h){console.error("Failed to toggle can_predict:",h)}}function y(){s()}let f=`${o.length} promoted \xB7 ${l.length} candidate${l.length!==1?"s":""} \xB7 ${d} entities`;return a&&!t?e("div",{class:"space-y-6"},e(ce,{page:"CAPABILITIES",subtitle:"Detected home capabilities and features."}),e(ke,{type:"cards"})):r?e("div",{class:"space-y-6"},e(ce,{page:"CAPABILITIES",subtitle:"Detected home capabilities and features."}),e(fe,{error:r,onRetry:s})):e("div",{class:"space-y-6 animate-page-enter"},e(ce,{page:"CAPABILITIES",subtitle:"Detected home capabilities and features."}),e(Oe,{value:n.length,label:"capabilities",delta:f,loading:a}),e(Iv,{data:t}),e("div",{class:"t-callout p-3 text-sm",style:"color: var(--text-secondary); line-height: 1.5;"},"ARIA automatically detects what your home can do by scanning your entities. Each capability can be toggled for ",e("strong",{style:"color: var(--text-primary)"},"predictions")," \u2014 when enabled, ARIA learns the patterns for that capability and flags when something changes. Organic discovery finds new groupings automatically; candidates are promoted once they prove stable."),n.length===0?e("div",{class:"t-callout",style:"padding: 0.75rem;"},e("span",{class:"text-sm",style:"color: var(--text-secondary)"},"No capabilities detected yet. Capabilities are identified during discovery by matching entity domains and device classes. They appear after the first successful discovery scan.")):e("div",{class:"space-y-6"},o.length>0&&e(Ie,{title:"Promoted",subtitle:"Active capabilities tracked by ARIA.",summary:`${o.length} capabilities`,defaultOpen:!0,loading:a},e("div",{class:"grid grid-cols-1 lg:grid-cols-2 gap-4 stagger-children"},o.map(v=>e(Ho,{key:v.name,name:v.name,capability:v,onTogglePredict:u,onAction:y})))),l.length>0&&e(Ie,{title:"Candidates",subtitle:"Organically discovered capabilities awaiting promotion.",summary:`${l.length} candidates`,defaultOpen:!0,loading:a},e("div",{class:"grid grid-cols-1 lg:grid-cols-2 gap-4 stagger-children"},l.map(v=>e(Ho,{key:v.name,name:v.name,capability:v,onTogglePredict:u,onAction:y})))),i.length>0&&e(Ie,{title:"Archived",subtitle:"Capabilities removed from active tracking.",summary:`${i.length} archived`,defaultOpen:!1,loading:a},e("div",{class:"grid grid-cols-1 lg:grid-cols-2 gap-4 stagger-children"},i.map(v=>e(Ho,{key:v.name,name:v.name,capability:v,onTogglePredict:u,onAction:y}))))),e(Ov,null))}function Ar(t){return t>=70?"color: var(--status-healthy)":t>=40?"color: var(--status-warning)":"color: var(--status-error)"}function qs(t){return t>=.7?"background: var(--status-healthy-glow); color: var(--status-healthy);":t>=.4?"background: var(--status-warning-glow); color: var(--status-warning);":"background: var(--status-error-glow); color: var(--status-error);"}var Ys=20,Ks=100,gd=20,xd=10,bd=360*60*1e3,hd=3600*1e3;var Fo=["collecting","baselines","ml-training","ml-active"],_d=["Collecting","Baselines","ML Training","ML Active"];function Hv({prediction:t}){let[a,r]=I(!1),s=t.confidence??0,n=Math.round(s*100);return e("div",{class:"t-frame","data-label":t.entity_id||t.metric||"prediction",style:"padding: 1rem;"},e("div",{class:"flex items-center justify-between mb-3"},e("h3",{class:"text-sm font-bold truncate mr-2 data-mono",style:"color: var(--text-primary)"},t.entity_id),e("span",{class:"inline-block px-2 py-0.5 rounded-full text-xs font-medium whitespace-nowrap",style:qs(s)},n,"%")),e("div",{class:"flex items-center gap-2 mb-3"},e("span",{class:"text-xs",style:"color: var(--text-tertiary)"},"Predicted:"),e(Xr,{state:String(t.predicted_value??"")}),t.current_value!=null&&e("span",{class:"text-xs ml-2",style:"color: var(--text-tertiary)"},"current: ",t.current_value)),e("div",{class:"mb-3"},e("div",{class:"flex items-center justify-between text-xs mb-1",style:"color: var(--text-tertiary)"},e("span",null,"Confidence"),e("span",null,n,"%")),e("div",{class:"h-2 rounded-full",style:"background: var(--bg-inset)"},e("div",{class:"h-2 rounded-full transition-all",style:`background: var(--accent); width: ${n}%`}))),e("div",{class:"text-xs space-y-0.5",style:"color: var(--text-tertiary)"},t.model&&e("div",null,"Model: ",e("span",{style:"color: var(--text-secondary)"},t.model)),t.prediction_time&&e("div",null,"Time: ",e("span",{style:"color: var(--text-secondary)"},new Date(t.prediction_time).toLocaleString()))),t.features&&e("div",{class:"mt-3"},e("button",{onClick:()=>r(!a),class:"text-sm cursor-pointer",style:"color: var(--accent)"},a?"Hide details":"Show details"),a&&e("pre",{class:"mt-2 p-3 text-xs overflow-x-auto",style:"background: var(--bg-inset); color: var(--text-primary); border-radius: var(--radius); font-family: var(--font-mono)"},JSON.stringify(t.features,null,2))))}function Bo(){let{data:t,loading:a,error:r,refetch:s}=Re("ml_predictions"),{metadata:n,predictions:o}=ve(()=>{if(!t||!t.data)return{metadata:null,predictions:[]};let i=t.data;return{metadata:i.metadata||null,predictions:i.predictions||[]}},[t]),l="ML model predictions for individual entity states. Each card shows what the model expects and how confident it is.";return a&&!t?e("div",{class:"space-y-6"},e("div",null,e("h1",{class:"text-2xl font-bold",style:"color: var(--text-primary)"},"Predictions"),e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},l)),e(ke,{type:"cards"})):r?e("div",{class:"space-y-6"},e("div",null,e("h1",{class:"text-2xl font-bold",style:"color: var(--text-primary)"},"Predictions"),e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},l)),e(fe,{error:r,onRetry:s})):e("div",{class:"space-y-6 animate-page-enter"},e(ce,{page:"PREDICTIONS",subtitle:"ML model outputs with confidence scores."}),e(Oe,{value:o.length,label:"predictions",delta:o.length>0?`${o.filter(i=>(i.confidence??0)>=.7).length} high confidence`:null,loading:a}),n&&e("div",{class:"flex flex-wrap gap-3 text-sm",style:"color: var(--text-tertiary)"},n.model_version&&e("span",{style:"background: var(--bg-surface-raised); border-radius: var(--radius); padding: 0.25rem 0.5rem;"},"v",n.model_version),n.features_used!=null&&e("span",{style:"background: var(--bg-surface-raised); border-radius: var(--radius); padding: 0.25rem 0.5rem;"},n.features_used," features"),n.generated_at&&e("span",{style:"background: var(--bg-surface-raised); border-radius: var(--radius); padding: 0.25rem 0.5rem;"},"Generated: ",new Date(n.generated_at).toLocaleString())),o.length===0?e("div",{class:"t-callout",style:"padding: 0.75rem;"},e("span",{class:"text-sm",style:"color: var(--text-secondary)"},"No entity-level predictions yet. The ML engine trains models after 14+ days of data, then predicts individual entity states. Until then, aggregate predictions are available on the Intelligence page.")):e("div",{class:"grid grid-cols-1 lg:grid-cols-2 gap-4 stagger-children"},o.map((i,d)=>e(Hv,{key:i.entity_id||d,prediction:i}))))}function zv(t){switch((t||"").toLowerCase()){case"temporal":return"background: var(--accent-glow); color: var(--accent);";case"correlation":return"background: var(--accent-purple-glow); color: var(--accent-purple);";case"sequence":return"background: var(--status-warning-glow); color: var(--status-warning);";case"anomaly":return"background: var(--status-error-glow); color: var(--status-error);";default:return"background: var(--bg-surface-raised); color: var(--text-secondary);"}}function Fv({pattern:t}){let[a,r]=I(!1),s=t.confidence??0,n=Math.round(s*100),o=t.entities||[];return e("div",{class:"t-frame","data-label":t.name||"pattern",style:"padding: 1.25rem;"},e("div",{class:"flex items-center justify-between mb-2"},e("h3",{class:"text-base font-bold",style:"color: var(--text-primary)"},t.name||"Unnamed pattern"),t.type&&e("span",{class:"inline-block px-2 py-0.5 rounded-full text-xs font-medium",style:zv(t.type)},t.type)),t.description&&e("p",{class:"text-sm mb-3",style:"color: var(--text-secondary)"},t.description),e("div",{class:"grid grid-cols-2 gap-x-6 gap-y-2 text-sm mb-3"},t.frequency&&e("div",null,e("span",{style:"color: var(--text-tertiary)"},"Frequency"),e("div",{class:"font-medium",style:"color: var(--text-secondary)"},t.frequency)),o.length>0&&e("div",null,e("span",{style:"color: var(--text-tertiary)"},"Entities"),e("div",{class:"font-medium",style:"color: var(--text-secondary)"},o.length)),e("div",null,e("span",{style:"color: var(--text-tertiary)"},"Confidence"),e("div",{class:"font-medium",style:"color: var(--text-secondary)"},n,"%")),t.time_window&&e("div",null,e("span",{style:"color: var(--text-tertiary)"},"Time window"),e("div",{class:"font-medium",style:"color: var(--text-secondary)"},t.time_window)),t.support!=null&&e("div",null,e("span",{style:"color: var(--text-tertiary)"},"Support"),e("div",{class:"font-medium",style:"color: var(--text-secondary)"},Math.round(t.support*100),"%"))),o.length>0&&e("div",{class:"flex flex-wrap gap-1 mb-3"},o.map(l=>e("span",{key:l,class:"inline-block px-1.5 py-0.5 text-xs data-mono",style:"background: var(--bg-surface-raised); border-radius: var(--radius); color: var(--text-secondary)"},l))),t.raw_data&&e("div",null,e("button",{onClick:()=>r(!a),class:"text-sm cursor-pointer",style:"color: var(--accent)"},a?"Hide raw data":"Show raw data"),a&&e("pre",{class:"mt-2 p-3 text-xs overflow-x-auto",style:"background: var(--bg-inset); color: var(--text-primary); border-radius: var(--radius); font-family: var(--font-mono)"},JSON.stringify(t.raw_data,null,2))))}function jo(){let{data:t,loading:a,error:r,refetch:s}=Re("patterns"),{metadata:n,patterns:o}=ve(()=>{if(!t||!t.data)return{metadata:null,patterns:[]};let i=t.data;return{metadata:i.metadata||null,patterns:i.patterns||[]}},[t]),l="Recurring behaviors the system has found \u2014 things that happen at the same time, in the same sequence, or that correlate with each other.";return a&&!t?e("div",{class:"space-y-6"},e("div",null,e("h1",{class:"text-2xl font-bold",style:"color: var(--text-primary)"},"Patterns"),e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},l)),e(ke,{type:"cards"})):r?e("div",{class:"space-y-6"},e("div",null,e("h1",{class:"text-2xl font-bold",style:"color: var(--text-primary)"},"Patterns"),e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},l)),e(fe,{error:r,onRetry:s})):e("div",{class:"space-y-6 animate-page-enter"},e(ce,{page:"PATTERNS",subtitle:"Recurring event sequences from your logbook."}),e(Oe,{value:o.length,label:"patterns detected",loading:a}),n&&e("div",{class:"flex flex-wrap gap-3 text-sm",style:"color: var(--text-tertiary)"},n.time_range&&e("span",{style:"background: var(--bg-surface-raised); border-radius: var(--radius); padding: 0.25rem 0.5rem;"},"Range: ",n.time_range),n.pattern_count!=null&&e("span",{style:"background: var(--bg-surface-raised); border-radius: var(--radius); padding: 0.25rem 0.5rem;"},n.pattern_count," patterns"),n.analyzed_at&&e("span",{style:"background: var(--bg-surface-raised); border-radius: var(--radius); padding: 0.25rem 0.5rem;"},"Analyzed: ",new Date(n.analyzed_at).toLocaleString())),o.length===0?e("div",{class:"t-callout",style:"padding: 0.75rem;"},e("span",{class:"text-sm",style:"color: var(--text-secondary)"},"No patterns detected yet. The pattern recognition module analyzes HA logbook sequences to find temporal, correlation, and sequence patterns. It needs several days of logbook data with meaningful device events to identify reliable patterns.")):e("div",{class:"space-y-4 stagger-children"},o.map((i,d)=>e(Fv,{key:i.name||d,pattern:i}))))}function Bv(t){switch((t||"").toLowerCase()){case"approved":return"background: var(--status-healthy-glow); color: var(--status-healthy);";case"rejected":return"background: var(--status-error-glow); color: var(--status-error);";default:return"background: var(--status-warning-glow); color: var(--status-warning);"}}function Uo({obj:t}){return t?typeof t=="string"?e("span",{class:"text-sm",style:"color: var(--text-secondary)"},t):e("dl",{class:"text-xs space-y-0.5",style:"color: var(--text-secondary)"},Object.entries(t).map(([a,r])=>e("div",{key:a,class:"flex gap-2"},e("dt",{class:"min-w-[80px]",style:"color: var(--text-tertiary)"},a,":"),e("dd",{class:"break-all",style:"color: var(--text-secondary)"},typeof r=="object"?JSON.stringify(r):String(r))))):null}function jv({suggestion:t,onStatusChange:a,updating:r}){let s=t.confidence??0,n=Math.round(s*100),o=(t.status||"pending").toLowerCase(),l=o==="approved"?"border-left: 4px solid var(--status-healthy);":o==="rejected"?"border-left: 4px solid var(--status-error); opacity: 0.6;":"";return e("div",{class:"t-frame","data-label":t.name||t.trigger||"suggestion",style:`padding: 1.25rem; ${l}`},e("div",{class:"flex items-center justify-between mb-2"},e("h3",{class:"text-base font-bold",style:"color: var(--text-primary)"},t.name||"Unnamed automation"),e("span",{class:"inline-block px-2 py-0.5 rounded-full text-xs font-medium",style:Bv(o)},o)),t.description&&e("p",{class:"text-sm mb-3",style:"color: var(--text-secondary)"},t.description),e("div",{class:"mb-4"},e("div",{class:"flex items-center justify-between text-xs mb-1",style:"color: var(--text-tertiary)"},e("span",null,"Confidence"),e("span",null,n,"%")),e("div",{class:"h-2 rounded-full",style:"background: var(--bg-inset)"},e("div",{class:"h-2 rounded-full transition-all",style:`background: var(--accent); width: ${n}%`}))),t.trigger&&e("div",{class:"mb-3"},e("h4",{class:"text-xs font-semibold uppercase tracking-wide mb-1",style:"color: var(--text-tertiary)"},"Trigger"),e(Uo,{obj:t.trigger})),t.conditions&&t.conditions.length>0&&e("div",{class:"mb-3"},e("h4",{class:"text-xs font-semibold uppercase tracking-wide mb-1",style:"color: var(--text-tertiary)"},"Conditions"),e("div",{class:"space-y-1"},t.conditions.map((i,d)=>e(Uo,{key:d,obj:i})))),t.actions&&t.actions.length>0&&e("div",{class:"mb-3"},e("h4",{class:"text-xs font-semibold uppercase tracking-wide mb-1",style:"color: var(--text-tertiary)"},"Actions"),e("div",{class:"space-y-1"},t.actions.map((i,d)=>e(Uo,{key:d,obj:i})))),t.yaml&&e("details",{class:"mb-3"},e("summary",{class:"text-sm cursor-pointer",style:"color: var(--accent)"},"Show YAML"),e("pre",{class:"mt-2 p-3 text-xs overflow-x-auto",style:"background: var(--bg-inset); color: var(--text-primary); border-radius: var(--radius); font-family: var(--font-mono)"},t.yaml)),o==="pending"&&e("div",{class:"flex gap-2 mt-4"},e("button",{onClick:()=>a(t.id,"approved"),disabled:r,class:"t-btn px-4 py-1.5 text-sm font-medium disabled:opacity-50 transition-colors",style:"background: var(--status-healthy); color: var(--text-inverse); border: none;"},"Approve"),e("button",{onClick:()=>a(t.id,"rejected"),disabled:r,class:"t-btn px-4 py-1.5 text-sm font-medium disabled:opacity-50 transition-colors",style:"background: var(--status-error); color: var(--text-inverse); border: none;"},"Reject")))}function Wo(){let{data:t,loading:a,error:r,refetch:s}=Re("automation_suggestions"),[n,o]=I(!1),[l,i]=I(null),[d,u]=I({}),{metadata:y,suggestions:f}=ve(()=>{if(!t||!t.data)return{metadata:null,suggestions:[]};let A=t.data;return{metadata:A.metadata||null,suggestions:A.suggestions||[]}},[t]),v=ve(()=>f.map(A=>d[A.id]?{...A,status:d[A.id]}:A),[f,d]);async function x(A,C){o(!0),i(null),u(M=>({...M,[A]:C}));try{let M=f.map(S=>S.id===A?{...S,status:C}:S),_={...t.data||{},suggestions:M},k=await fetch(`${pa}/api/cache/automation_suggestions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:_})});if(!k.ok)throw new Error(`HTTP ${k.status}: ${k.statusText}`);u(S=>{let O={...S};return delete O[A],O}),s()}catch(M){u(_=>{let k={..._};return delete k[A],k}),i(M.message||String(M))}finally{o(!1)}}let h="Automation ideas generated from discovered patterns. Review, approve, or reject \u2014 approved automations can be exported to HA.";return a&&!t?e("div",{class:"space-y-6"},e("div",null,e("h1",{class:"text-2xl font-bold",style:"color: var(--text-primary)"},"Automations"),e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},h)),e(ke,{type:"cards"})):r?e("div",{class:"space-y-6"},e("div",null,e("h1",{class:"text-2xl font-bold",style:"color: var(--text-primary)"},"Automations"),e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},h)),e(fe,{error:r,onRetry:s})):e("div",{class:"space-y-6 animate-page-enter"},e(ce,{page:"AUTOMATIONS",subtitle:"LLM-suggested Home Assistant automation YAML."}),e(Oe,{value:v.length,label:"automation suggestions",loading:a}),y&&e("div",{class:"flex flex-wrap gap-3 text-sm",style:"color: var(--text-tertiary)"},y.total_suggestions!=null&&e("span",{style:"background: var(--bg-surface-raised); border-radius: var(--radius); padding: 0.25rem 0.5rem;"},y.total_suggestions," suggestions"),y.model&&e("span",{style:"background: var(--bg-surface-raised); border-radius: var(--radius); padding: 0.25rem 0.5rem;"},"Model: ",y.model),y.generated_at&&e("span",{style:"background: var(--bg-surface-raised); border-radius: var(--radius); padding: 0.25rem 0.5rem;"},"Generated: ",new Date(y.generated_at).toLocaleString())),l&&e(fe,{error:l,onRetry:()=>i(null)}),v.length===0?e("div",{class:"t-callout",style:"padding: 0.75rem;"},e("span",{class:"text-sm",style:"color: var(--text-secondary)"},"No automation suggestions yet. The orchestrator generates suggestions when it finds patterns with high enough confidence and matching capabilities. This requires the pattern recognition and discovery modules to have populated data first.")):e("div",{class:"grid grid-cols-1 lg:grid-cols-2 gap-4 stagger-children"},v.map((A,C)=>e(jv,{key:A.id||C,suggestion:A,onStatusChange:x,updating:n}))))}function wd(t){return t==="high"?"background: var(--status-healthy-glow); color: var(--status-healthy);":t==="medium"?"background: var(--status-warning-glow); color: var(--status-warning);":"background: var(--status-error-glow); color: var(--status-error);"}function St(t){if(!t)return"\u2014";let a=Date.now()-new Date(t).getTime(),r=Math.floor(a/6e4);if(r<1)return"just now";if(r<60)return`${r}m ago`;let s=Math.floor(r/60);return s<24?`${s}h ago`:`${Math.floor(s/24)}d ago`}function Vo(t){if(!t)return"";let a=Date.now()-new Date(t).getTime(),r=Math.floor(a/6e4);if(r<60)return`${r}m`;let s=Math.floor(r/60),n=r%60;return n>0?`${s}h ${n}m`:`${s}h`}function ee({title:t,subtitle:a,summary:r,defaultOpen:s=!0,loading:n,children:o}){return e(Ie,{title:t,subtitle:a,summary:r,defaultOpen:s,loading:n},o)}function ye({children:t}){return e("div",{class:"t-callout p-3 text-sm"},t)}var Fa={light:"Lights",switch:"Switches",binary_sensor:"Sensors",lock:"Locks",media_player:"Media",cover:"Covers",climate:"Climate",vacuum:"Vacuum",person:"People",device_tracker:"Trackers",fan:"Fans",sensor:"Power"},kd={arrive:"\u25B6",depart:"\u25C0",person:"\u25CF",unlock:"\u25CB",lock:"\u25CF",motion:"\u25B8",clear:"\xB7",door:"\u25A0",window:"\u25A1",light_on:"\u25CF",light_off:"\xB7",switch:"\u25C6",sensor:"\u25B8",media:"\u25B6",climate:"\u223F",cover:"\u25A1",default:"\xB7"};function Sd(t){let a=t.friendly_name||t.entity||"?",r=t.domain||"",s=t.device_class||"",n=t.to||"",o=t.from||"";return r==="person"||r==="device_tracker"?n==="home"?{text:`${a} arrived home`,icon:"arrive"}:o==="home"?{text:`${a} left`,icon:"depart"}:{text:`${a}: ${n}`,icon:"person"}:r==="lock"?n==="unlocked"?{text:`${a} unlocked`,icon:"unlock"}:n==="locked"?{text:`${a} locked`,icon:"lock"}:{text:`${a}: ${n}`,icon:"lock"}:r==="binary_sensor"?s==="motion"?n==="on"?{text:`Motion in ${a}`,icon:"motion"}:{text:`${a} cleared`,icon:"clear"}:s==="door"?n==="on"?{text:`${a} opened`,icon:"door"}:{text:`${a} closed`,icon:"door"}:s==="window"?n==="on"?{text:`${a} opened`,icon:"window"}:{text:`${a} closed`,icon:"window"}:s==="occupancy"?n==="on"?{text:`${a} occupied`,icon:"motion"}:{text:`${a} clear`,icon:"clear"}:n==="on"?{text:`${a} active`,icon:"sensor"}:{text:`${a} inactive`,icon:"clear"}:r==="light"?n==="on"?{text:`${a} on`,icon:"light_on"}:{text:`${a} off`,icon:"light_off"}:r==="switch"?n==="on"?{text:`${a} on`,icon:"switch"}:{text:`${a} off`,icon:"switch"}:r==="media_player"?n==="playing"?{text:`${a} playing`,icon:"media"}:n==="paused"?{text:`${a} paused`,icon:"media"}:n==="idle"||n==="off"?{text:`${a} stopped`,icon:"media"}:{text:`${a}: ${n}`,icon:"media"}:r==="climate"?{text:`${a} set to ${n}`,icon:"climate"}:r==="cover"?n==="open"?{text:`${a} opened`,icon:"cover"}:n==="closed"?{text:`${a} closed`,icon:"cover"}:{text:`${a}: ${n}`,icon:"cover"}:{text:`${a}: ${o} \u2192 ${n}`,icon:"default"}}function Cd({maturity:t,shadowStage:a,shadowAccuracy:r}){if(!t)return null;let s=Fo.indexOf(t.phase),n=Math.max((s+1)/Fo.length*100,10),o=s<2?'The system needs enough data to tell the difference between "normal Tuesday" and "something unusual." More days = better predictions.':"The system has enough data to predict your home's behavior and flag anomalies.";return e(ee,{title:"Learning Progress",summary:t.phase},e("div",{class:"t-frame p-4 space-y-4","data-label":"learning"},e("div",null,e("div",{class:"flex justify-between text-xs mb-1",style:"color: var(--text-tertiary)"},_d.map((l,i)=>{let d=i<s?"color: var(--status-healthy)":i===s?"color: var(--accent); font-weight: 700":"";return e("span",{key:l,style:d},l)})),e("div",{class:"h-3 rounded-full",style:"background: var(--bg-inset)"},e("div",{class:"h-3 rounded-full transition-all",style:`background: var(--accent); width: ${n}%`}))),e("p",{class:"text-sm",style:"color: var(--text-secondary)"},t.description),e("p",{class:"text-xs italic",style:"color: var(--text-tertiary)"},o),e("div",{class:"flex flex-wrap gap-3 text-sm"},e("span",{class:"rounded px-2 py-1",style:"background: var(--bg-surface-raised)"},t.days_of_data," day",t.days_of_data!==1?"s":""," of data"),e("span",{class:"rounded px-2 py-1",style:"background: var(--bg-surface-raised)"},t.intraday_count," intraday snapshot",t.intraday_count!==1?"s":""),t.first_date&&e("span",{class:"rounded px-2 py-1",style:"background: var(--bg-surface-raised)"},"Since ",t.first_date)),t.next_milestone&&t.phase!=="ml-active"&&e("p",{class:"text-xs",style:"color: var(--text-tertiary)"},"Next: ",t.next_milestone),a&&e("div",{class:"flex items-center gap-2 text-xs pt-1",style:"color: var(--text-tertiary); border-top: 1px solid var(--border-subtle)"},e("span",{class:"font-medium rounded-full px-2 py-0.5 capitalize",style:"background: var(--accent-glow); color: var(--accent)"},a),e("span",null,"Shadow engine",r!=null?` \u2014 ${Math.round(r*100)}% accuracy`:""))))}function Td({intraday:t,baselines:a}){if(!t||t.length===0)return null;let r=t[t.length-1],s=new Date().toLocaleDateString("en-US",{weekday:"long"}),n=a&&a[s];function o(d,u){if(u==null||!n||!n[d])return null;let y=n[d].mean;if(y==null)return null;let f=u-y,v=y>0?Math.round(f/y*100):0;return Math.abs(v)<10?{text:"typical",style:"color: var(--text-tertiary)"}:v>0?{text:`+${v}% vs ${s}`,style:"color: var(--status-warning)"}:{text:`${v}% vs ${s}`,style:"color: var(--accent)"}}let l=[{label:"Power (W)",value:r.power_watts!=null?r.power_watts:"\u2014",note:o("power_watts",r.power_watts)},{label:"Lights On",value:r.lights_on!=null?r.lights_on:"\u2014",note:o("lights_on",r.lights_on)},{label:"Devices Home",value:r.devices_home!=null?r.devices_home:"\u2014"},{label:"Unavailable",value:r.unavailable!=null?r.unavailable:"\u2014",warning:(r.unavailable||0)>100,note:(r.unavailable||0)>100?{text:"High \u2014 check devices",style:"color: var(--status-warning)"}:null}],i=n?`Latest snapshot compared to your typical ${s}. Updated every 4 hours (more often when home is active).`:"Latest snapshot of your home. Comparisons to baseline will appear after 7 days of data.";return e(ee,{title:"Home Right Now",subtitle:i,summary:l.length+" metrics"},e("div",{class:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-4"},l.map((d,u)=>e("div",{key:u,class:"t-frame p-4","data-label":d.label,style:d.warning?"border: 2px solid var(--status-warning)":""},e("div",{class:"text-2xl font-bold",style:d.warning?"color: var(--status-warning)":"color: var(--accent)"},d.value),e("div",{class:"text-sm mt-1",style:"color: var(--text-tertiary)"},d.label),d.note&&e("div",{class:"text-xs mt-1",style:d.note.style},d.note.text)))))}var Md={light:"var(--accent-warm)",switch:"var(--accent)",binary_sensor:"var(--accent-purple)",person:"var(--status-healthy)",device_tracker:"var(--status-healthy)"};function Uv({events:t}){if(!t||t.length===0)return null;let a=new Date,r=new Date(a-hd),s=t.map(u=>{let[y,f]=(u.time||"").split(":").map(Number),v=new Date;return v.setHours(y,f,0,0),v>a&&v.setDate(v.getDate()-1),{...u,_date:v}}).filter(u=>u._date>=r&&u._date<=a);if(s.length===0)return null;let n={};s.forEach(u=>{let y=u.domain||"unknown";n[y]||(n[y]=[]),n[y].push(u)});let o=Object.keys(n);if(o.length===0)return null;let l=a-r,i=r.toTimeString().slice(0,5),d=a.toTimeString().slice(0,5);return e("div",{class:"t-frame p-4","data-label":"swim lanes"},e("p",{class:"text-xs mb-2",style:"color: var(--text-tertiary)"},"What happened in the last hour, organized by device type. Each dot is one state change. Hover a dot to see which device changed."),e("div",{style:"display: grid; grid-template-columns: 60px 1fr; gap: 0;"},o.map(u=>e("div",{key:u,style:"display: contents;"},e("div",{style:"height: 20px; margin-bottom: 2px; display: flex; align-items: center; font-size: 10px; color: var(--text-tertiary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"},Fa[u]||u),e("div",{style:"height: 20px; margin-bottom: 2px; position: relative; background: var(--bg-inset); border-radius: 2px;"},n[u].map((y,f)=>{let v=(y._date-r)/l*100,x=Md[u]||"var(--text-tertiary)";return e("div",{key:f,title:`${y.friendly_name||y.entity} \u2014 ${y.state} at ${y.time}`,style:{position:"absolute",left:`${v}%`,top:"6px",width:"8px",height:"8px",borderRadius:"50%",backgroundColor:x,transform:"translateX(-4px)"}})}),e("div",{style:"position: absolute; right: 0; top: 0; bottom: 0; border-right: 2px dashed var(--text-tertiary); opacity: 0.5;"})))),e("div",{style:"height: 14px;"}),e("div",{style:"height: 14px; position: relative; display: flex; justify-content: space-between; font-size: 10px; color: var(--text-tertiary);"},e("span",null,i),e("span",null,"now"))),e("div",{class:"flex flex-wrap items-center gap-3 mt-2 pt-2",style:"border-top: 1px solid var(--border-subtle); font-size: 10px; color: var(--text-tertiary);"},o.map(u=>e("div",{key:u,class:"flex items-center gap-1"},e("span",{style:`display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: ${Md[u]||"var(--text-tertiary)"};`}),e("span",null,Fa[u]||u))),e("div",{class:"flex items-center gap-1"},e("span",{style:"display: inline-block; width: 1px; height: 10px; border-left: 2px dashed var(--text-tertiary); opacity: 0.5;"}),e("span",null,"Now"))))}function Wv({windows:t}){if(!t||t.length===0)return null;let a=new Date,r=new Date(a-bd).toISOString(),s=t.filter(d=>d.window_start>=r);if(s.length===0)return null;let n=Math.max(...s.map(d=>d.event_count),1),o=s.reduce((d,u)=>d+u.event_count,0),l=s.filter(d=>d.occupancy).length,i=s.length>0?Math.round(l/s.length*100):0;return e("div",{class:"space-y-2"},e("div",{class:"flex justify-between items-baseline"},e("div",{class:"text-xs font-medium",style:"color: var(--text-secondary)"},"Activity Timeline (6h)"),e("div",{class:"text-xs",style:"color: var(--text-tertiary)"},o," events, home ",i,"% of the time")),e("div",{class:"flex items-end gap-0.5 h-16"},s.map((d,u)=>{let y=Math.max(d.event_count/n*100,4),f=d.occupancy?"var(--accent-purple)":"var(--text-tertiary)",v=d.window_start.slice(11,16);return e("div",{key:u,class:"flex-1 rounded-t transition-all",style:{height:`${y}%`,backgroundColor:f,minWidth:"3px"},title:`${v} \u2014 ${d.event_count} events${d.occupancy?"":" (away)"}`})})),e("div",{class:"flex justify-between",style:"font-size: 10px; color: var(--text-tertiary)"},e("span",null,s[0]?.window_start?.slice(11,16)),e("div",{class:"flex items-center gap-2"},e("span",{class:"inline-block w-2 h-2 rounded-sm",style:{backgroundColor:"var(--accent-purple)"}})," home",e("span",{class:"inline-block w-2 h-2 rounded-sm",style:"background: var(--text-tertiary)"})," away"),s.length>1&&e("span",null,s[s.length-1]?.window_start?.slice(11,16))))}function Vv({ws:t}){if(!t)return null;let a=t.connected;return e("div",{class:"flex items-center gap-2 text-xs"},e("span",{class:"inline-block w-2.5 h-2.5 rounded-full",style:`background: ${a?"var(--status-healthy)":"var(--status-error)"}`}),e("span",{style:`color: ${a?"var(--status-healthy)":"var(--status-error)"}`},a?"Connected":"Disconnected"),t.disconnect_count>0&&e("span",{style:"color: var(--text-tertiary)"},"(",t.disconnect_count," reconnect",t.disconnect_count!==1?"s":"",")"),t.total_disconnect_s>0&&e("span",{style:"color: var(--text-tertiary)"},Math.round(t.total_disconnect_s),"s downtime"))}function Ed({activity:t}){if(!t)return e(ee,{title:"Activity Monitor",subtitle:"Waiting for WebSocket to connect to Home Assistant..."},e(ye,null,"Activity monitoring is starting up. State changes will appear here once the WebSocket connection is established."));let a=t.activity_summary,r=t.activity_log;if(!a&&!r)return e(ee,{title:"Activity Monitor",subtitle:"Waiting for first events..."},e(ye,null,"Activity monitoring is starting up. State changes will appear here once the WebSocket connection is established."));let s=a?.occupancy||{},n=a?.activity_rate||{},o=a?.snapshot_status||{},l=a?.domains_active_1h||{},i=a?.recent_activity||[],d=r?.windows||[],u=a?.websocket||{},y=a?.event_predictions||{},f=a?.patterns||[],v=a?.occupancy_prediction||{},x=a?.anomalies||[],h=[];if(s.anyone_home){let _=Vo(s.since),k=(s.people||[]).join(" & ")||"Someone";h.push(_?`${k} home for ${_}`:`${k} home`)}else h.push("Nobody home");n.trend==="increasing"?h.push("activity picking up"):n.trend==="decreasing"&&h.push("quieting down");let A=r?.events_today;A!=null&&h.push(`${A} events today`);let C=h.join(" \xB7 "),M="";return o.today_count>0?M=`${o.today_count} adaptive snapshot${o.today_count!==1?"s":""} captured today \u2014 the system saw enough activity to grab extra data points.`:s.anyone_home?M="Watching for sustained activity to trigger an adaptive snapshot. Cooldown and event thresholds are configurable in Settings.":M="Adaptive snapshots only trigger when someone is home.",e(ee,{title:"Activity Monitor",subtitle:C,summary:s.anyone_home?"Home":"Away"},e("div",{class:"space-y-4"},e("div",{class:"flex items-center justify-between"},e(Vv,{ws:u}),y.predicted_next_domain&&e("div",{class:"text-xs",style:"color: var(--text-tertiary)"},"Next likely: ",e("span",{class:"font-medium",style:"color: var(--text-secondary)"},Fa[y.predicted_next_domain]||y.predicted_next_domain)," ","(",Math.round(y.probability*100),"%)")),x.length>0&&x.map((_,k)=>e(ye,{key:k},_.message)),e("div",{class:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-4"},e("div",{class:"t-frame p-4",style:`border-left: 4px solid ${s.anyone_home?"var(--status-healthy)":"var(--border-subtle)"}`},e("div",{class:"text-2xl font-bold",style:`color: ${s.anyone_home?"var(--status-healthy)":"var(--text-tertiary)"}`},s.anyone_home?"Home":"Away"),e("div",{class:"text-sm mt-1",style:"color: var(--text-tertiary)"},"Occupancy"),s.anyone_home&&s.since&&e("div",{class:"text-xs mt-1",style:"color: var(--text-tertiary)"},"for ",Vo(s.since)),!s.anyone_home&&v.predicted_arrival&&v.status==="predicted"&&e("div",{class:"text-xs mt-1",style:"color: var(--accent)"},"ETA ~",v.predicted_arrival,e("span",{style:"color: var(--text-tertiary)"}," (",v.confidence,", ",v.based_on," samples)")),!s.anyone_home&&v.status==="past_predicted"&&e("div",{class:"text-xs mt-1",style:"color: var(--text-tertiary)"},"Typical arrival (",v.predicted_arrival,") passed")),e("div",{class:"t-frame p-4"},e("div",{class:"text-2xl font-bold",style:"color: var(--accent)"},n.current!=null?n.current:"\u2014"),e("div",{class:"text-sm mt-1",style:"color: var(--text-tertiary)"},"Events (15m window)"),n.avg_1h>0&&e("div",{class:"text-xs mt-1",style:`color: ${n.trend==="increasing"?"var(--status-warning)":n.trend==="decreasing"?"var(--accent)":"var(--text-tertiary)"}`},n.trend==="increasing"?"Above":n.trend==="decreasing"?"Below":"Near"," avg (",n.avg_1h,"/window)")),e("div",{class:"t-frame p-4"},e("div",{class:"text-2xl font-bold",style:"color: var(--accent)"},A??"\u2014"),e("div",{class:"text-sm mt-1",style:"color: var(--text-tertiary)"},"Events Today")),e("div",{class:"t-frame p-4"},e("div",{class:"text-2xl font-bold",style:"color: var(--accent)"},o.today_count!=null?`${o.today_count}/${o.daily_cap}`:"\u2014"),e("div",{class:"text-sm mt-1",style:"color: var(--text-tertiary)"},"Adaptive Snapshots"),o.cooldown_remaining_s>0&&e("div",{class:"text-xs mt-1",style:"color: var(--text-tertiary)"},"Next eligible in ",Math.ceil(o.cooldown_remaining_s/60),"m"))),e("div",{class:"text-xs italic px-1",style:"color: var(--text-tertiary)"},M),e("div",{class:"grid grid-cols-1 sm:grid-cols-1 lg:grid-cols-3 gap-4"},e("div",{class:"lg:col-span-2 t-frame p-4","data-label":"recent"},e("div",{class:"text-xs font-bold uppercase mb-2",style:"color: var(--text-tertiary)"},"What Just Happened"),e(Uv,{events:i}),i.length===0?e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},"Waiting for state changes..."):e("div",{class:"sr-only space-y-0.5 max-h-64 overflow-y-auto"},i.map((_,k)=>{let S=Sd(_),O=kd[S.icon]||"\xB7",P=["lock","person","device_tracker"].includes(_.domain)||_.domain==="binary_sensor"&&["door","window"].includes(_.device_class),H=`${_.entity||_.friendly_name}-${_.time}-${k}`;return e("div",{key:H,class:"flex items-center gap-2 py-1 px-1 rounded",style:P?"background: var(--status-warning-glow)":""},e("span",{class:"w-5 text-center text-sm flex-shrink-0"},O),e("span",{class:`flex-1 text-sm ${P?"font-medium":""}`,style:`color: ${P?"var(--text-primary)":"var(--text-secondary)"}`},S.text),e("span",{class:"text-xs flex-shrink-0",style:"color: var(--text-tertiary)"},_.time))}))),e("div",{class:"t-frame p-4","data-label":"domains"},e("div",{class:"text-xs font-bold uppercase mb-2",style:"color: var(--text-tertiary)"},"Active Domains (1h)"),Object.keys(l).length===0?e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},"No activity yet."):e("div",{class:"space-y-2"},(()=>{let _=Math.max(...Object.values(l),1);return Object.entries(l).map(([k,S])=>{let O=Fa[k]||k,P=S/_*100;return e("div",{key:k,class:"space-y-0.5"},e("div",{class:"flex justify-between text-xs"},e("span",{style:"color: var(--text-secondary)"},O),e("span",{style:"color: var(--text-tertiary)"},S)),e("div",{class:"h-1.5 rounded-full",style:"background: var(--bg-inset)"},e("div",{class:"h-1.5 rounded-full",style:`background: var(--accent-dim); width: ${P}%`})))})})()))),f.length>0&&e("div",{class:"t-frame p-4","data-label":"patterns"},e("div",{class:"text-xs font-bold uppercase mb-2",style:"color: var(--text-tertiary)"},"Detected Patterns (24h)"),e("p",{class:"text-xs mb-2",style:"color: var(--text-tertiary)"},"Recurring event sequences that suggest routines or automations."),e("div",{class:"space-y-1.5"},f.map((_,k)=>e("div",{key:k,class:"flex items-center gap-2 text-sm"},e("div",{class:"flex items-center gap-1"},_.sequence.map((S,O)=>e("span",{key:O},e("span",{class:"rounded px-1.5 py-0.5 text-xs font-medium",style:"background: var(--accent-glow); color: var(--accent)"},Fa[S]||S),O<_.sequence.length-1&&e("span",{class:"mx-0.5",style:"color: var(--text-tertiary)"},"\u2192")))),e("span",{class:"text-xs ml-auto flex-shrink-0",style:"color: var(--text-tertiary)"},_.count,"x",_.last_seen?`, last ${_.last_seen.slice(11,16)||_.last_seen}`:""))))),e("div",{class:"t-frame p-4","data-label":"timeline"},e(Wv,{windows:d}),d.length===0&&e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},"Timeline will appear after the first 15-minute window.")),o.log_today&&o.log_today.length>0&&e("details",{class:"t-frame"},e("summary",{class:"px-4 py-3 cursor-pointer text-sm font-medium",style:"color: var(--text-secondary)"},"Snapshot Log \\u2014 ",o.log_today.length," adaptive snapshot",o.log_today.length!==1?"s":""," today"),e("div",{class:"overflow-x-auto"},e("table",{class:"w-full text-sm"},e("thead",null,e("tr",{class:"text-left text-xs",style:"border-bottom: 1px solid var(--border-subtle); color: var(--text-tertiary)"},e("th",{class:"px-4 py-1"},"#"),e("th",{class:"px-4 py-1"},"Time"),e("th",{class:"px-4 py-1"},"Events"),e("th",{class:"px-4 py-1"},"People"),e("th",{class:"px-4 py-1"},"What Triggered It"))),e("tbody",null,o.log_today.map((_,k)=>e("tr",{key:k,style:"border-bottom: 1px solid var(--border-subtle)"},e("td",{class:"px-4 py-1.5",style:"color: var(--text-tertiary)"},_.number),e("td",{class:"px-4 py-1.5",style:"color: var(--text-secondary)"},_.timestamp?.slice(11,16)),e("td",{class:"px-4 py-1.5"},_.buffered_events," buffered"),e("td",{class:"px-4 py-1.5",style:"color: var(--text-secondary)"},(_.people||[]).join(", ")||"\u2014"),e("td",{class:"px-4 py-1.5"},e("div",{class:"flex flex-wrap gap-1"},Object.entries(_.domains||{}).slice(0,4).map(([S,O])=>e("span",{key:S,class:"rounded px-1.5 py-0.5 text-xs",style:"background: var(--bg-surface-raised)"},Fa[S]||S,": ",O))))))))))))}function ts(t,a,r){let s=t.map(o=>{if(a==="date")return Math.floor(new Date(o.date).getTime()/1e3);{let l=new Date;return Math.floor(new Date(l.getFullYear(),l.getMonth(),l.getDate(),o.hour).getTime()/1e3)}}),n=t.map(o=>o[r]??null);return[s,n]}function as({label:t,data:a,color:r,height:s=80}){return e("div",null,e("div",{class:"text-xs font-bold uppercase",style:{color:"var(--text-tertiary)"}},t),e(Ha,{data:a,series:[{label:t,color:r}],height:s}))}function $d({trendData:t,intradayTrend:a}){let r=t&&t.length>0,s=a&&a.length>0;if(!r&&!s)return e(ee,{title:"Trends Over Time",subtitle:"Spot when something changed \u2014 a new device, a routine shift, or a problem building."},e(ye,null,"No trend data yet. Daily snapshots are collected each night at 11:30 PM."));let n=null;if(r&&t.length>=2){let o=t[t.length-1],l=t[t.length-2],i=[];if(o.power_watts!=null&&l.power_watts!=null){let d=o.power_watts-l.power_watts;Math.abs(d)>50&&i.push(`Power ${d>0?"up":"down"} ${Math.abs(Math.round(d))}W vs yesterday`)}if(o.unavailable!=null&&l.unavailable!=null){let d=o.unavailable-l.unavailable;d>10&&i.push(`${d} more entities unavailable than yesterday \u2014 check your network`)}i.length>0&&(n=i.join(". ")+".")}return e(ee,{title:"Trends Over Time",subtitle:"Spot when something changed \u2014 a new device, a routine shift, or a problem building."},n&&e(ye,null,n),e("p",{class:"text-xs",style:{color:"var(--text-secondary)",marginBottom:"0.75rem"}},"Each chart tracks one measurement over time. Power is your home's total electricity usage. Lights is how many are on. Unavailable means devices that stopped reporting \u2014 a spike usually means a network issue."),e("div",{class:"t-frame","data-label":"trends"},r&&e("div",{class:"space-y-2"},e("div",{class:"text-xs font-bold uppercase",style:{color:"var(--text-tertiary)"}},"Daily (30d)"),e(as,{label:"Power (W)",data:ts(t,"date","power_watts"),color:"var(--accent)"}),e(as,{label:"Lights On",data:ts(t,"date","lights_on"),color:"var(--accent-warm)"}),e(as,{label:"Unavailable",data:ts(t,"date","unavailable"),color:"var(--status-error)"})),s&&e("div",{class:"space-y-2"},e("div",{class:"text-xs font-bold uppercase",style:{color:"var(--text-tertiary)"}},"Today (Intraday)"),e(as,{label:"Power (W)",data:ts(a,"hour","power_watts"),color:"var(--accent-dim)"}),e(as,{label:"Unavailable",data:ts(a,"hour","unavailable"),color:"var(--status-error)"}))))}function Pd({predictions:t,intradayTrend:a}){if(!t||!t.target_date)return e(ee,{title:"Predictions vs Actuals",subtitle:"Once active, large deltas here mean something unusual is happening \\u2014 worth investigating."},e(ye,null,'Predictions need at least 7 days of data. The system is still learning what "normal" looks like for each day of the week.'));let r=a&&a.length>0?a[a.length-1]:{},s=["power_watts","lights_on","devices_home","unavailable","useful_events"],n=null;return s.forEach(o=>{let l=t[o]||{},i=r[o];if(i!=null&&l.predicted!=null&&l.predicted>0){let d=Math.abs((i-l.predicted)/l.predicted*100);d>30&&(!n||d>n.pct)&&(n={metric:o.replace(/_/g," "),pct:Math.round(d),actual:i,predicted:l.predicted})}}),e(ee,{title:"Predictions vs Actuals",subtitle:"Large deltas mean something unusual is happening. Small deltas mean the system understands your patterns.",summary:t.target_date},n&&e(ye,null,n.metric," is ",n.pct,"% off prediction (",n.actual," actual vs ",n.predicted," predicted). Worth a look?"),e("div",{class:"t-frame overflow-x-auto","data-label":"predictions"},e("table",{class:"w-full text-sm"},e("thead",null,e("tr",{class:"text-left text-xs uppercase",style:"border-bottom: 1px solid var(--border-subtle); color: var(--text-tertiary)"},e("th",{class:"px-4 py-2"},"Metric"),e("th",{class:"px-4 py-2"},"Predicted"),e("th",{class:"px-4 py-2"},"Actual"),e("th",{class:"px-4 py-2"},"Delta"),e("th",{class:"px-4 py-2"},"Confidence"))),e("tbody",null,s.map(o=>{let l=t[o]||{},i=r[o],d=i!=null&&l.predicted!=null?Math.round((i-l.predicted)*10)/10:null,u=d!=null&&l.predicted>0&&Math.abs(d/l.predicted)>.3;return e("tr",{key:o,style:`border-bottom: 1px solid var(--border-subtle)${u?"; background: var(--status-warning-glow)":""}`},e("td",{class:"px-4 py-2 font-medium",style:"color: var(--text-secondary)"},o.replace(/_/g," ")),e("td",{class:"px-4 py-2"},l.predicted!=null?l.predicted:"\u2014"),e("td",{class:"px-4 py-2"},i??"\u2014"),e("td",{class:"px-4 py-2"},d!=null?(d>=0?"+":"")+d:"\u2014"),e("td",{class:"px-4 py-2"},e("span",{class:"inline-block px-2 py-0.5 rounded-full text-xs font-medium",style:wd(l.confidence)},l.confidence||"n/a")))})))))}var Ld=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Gv={Monday:"Mon",Tuesday:"Tue",Wednesday:"Wed",Thursday:"Thu",Friday:"Fri",Saturday:"Sat",Sunday:"Sun"},Js=[{key:"power_watts",label:"Power",unit:"W",color:"var(--accent)",isNegative:!1},{key:"lights_on",label:"Lights",unit:"",color:"var(--accent)",isNegative:!1},{key:"devices_home",label:"Devices",unit:"",color:"var(--accent)",isNegative:!1},{key:"unavailable",label:"Unavail",unit:"",color:"var(--status-error)",isNegative:!0}];function qv(t){let a={};for(let r of Js){let s=1/0,n=-1/0;for(let o of Ld){let l=t[o];if(!l)continue;let i=l[r.key]?.mean;i!=null&&(i<s&&(s=i),i>n&&(n=i))}a[r.key]={min:s===1/0?0:s,max:n===-1/0?0:n}}return a}function Yv(t,a,r){return r===a?.5:Math.max(0,Math.min(1,(t-a)/(r-a)))}function Kv(t,a){return t==null?"\u2014":a.key==="power_watts"?Math.round(t).toLocaleString():Math.round(t).toString()}function Jv({value:t,std:a,metric:r,range:s}){let n=t!=null,o=n?Yv(t,s.min,s.max):0,l=Kv(t,r),i=n&&a!=null?`${r.label}: ${l}${r.unit?" "+r.unit:""} \xB1 ${Math.round(a*10)/10}`:r.label;return e("div",{class:"relative flex items-center justify-center rounded",style:"min-height: 2.5rem; min-width: 3.5rem;",title:i},e("div",{class:"absolute inset-0 rounded",style:`background: ${n?r.color:"var(--bg-surface-raised)"}; opacity: ${n?.12+o*.55:.15};`}),e("span",{class:"relative z-10 font-mono",style:"font-size: var(--type-micro); color: var(--text-primary);"},l))}function Dd({baselines:t}){if(!t||Object.keys(t).length===0)return e(ee,{title:"Baselines",subtitle:"This is what 'normal' looks like for each day. Deviations from these numbers trigger anomaly detection."},e(ye,null,"No baselines yet. The first baseline is calculated after the first daily snapshot."));let a=new Date().toLocaleDateString("en-US",{weekday:"long"}),r=qv(t);return e(ee,{title:"Baselines",subtitle:"This is 'normal' for each day of the week. The system flags deviations from these averages. More samples = tighter predictions.",summary:Object.keys(t).length+" days"},e("p",{class:"text-xs",style:"color: var(--text-tertiary)"},"Each cell shows what's typical for that day and metric. Darker color = higher value. Hover any cell to see the exact number with its margin of error. The 'n' column is how many readings were averaged."),e("div",{class:"t-frame","data-label":"baselines"},e("div",{style:`
            display: grid;
            grid-template-columns: auto repeat(${Js.length}, 1fr) auto;
            gap: 0.25rem;
            padding: 0.5rem;
          `},e("div",null),Js.map(s=>e("div",{key:s.key,class:"text-center text-xs uppercase",style:"color: var(--text-tertiary); padding-bottom: 0.25rem;"},s.label)),e("div",{class:"text-center text-xs uppercase",style:"color: var(--text-tertiary); padding-bottom: 0.25rem; padding-left: 0.5rem;"},"n"),Ld.map(s=>{let n=t[s],o=s===a;return[e("div",{key:s+"-label",class:"flex items-center text-xs font-medium pr-2",style:`
                  color: ${o?"var(--accent)":"var(--text-secondary)"};
                  ${o?"border-left: 2px solid var(--accent); padding-left: 0.375rem;":"padding-left: calc(2px + 0.375rem);"}
                `},Gv[s]),...Js.map(l=>e(Jv,{key:s+"-"+l.key,value:n?.[l.key]?.mean,std:n?.[l.key]?.stddev,metric:l,range:r[l.key]})),e("div",{key:s+"-samples",class:"flex items-center justify-center text-xs",style:"color: var(--text-tertiary); padding-left: 0.5rem;"},n?.sample_count??"\u2014")]})),e("div",{class:"flex flex-wrap items-center gap-3 mt-2 pt-2",style:"border-top: 1px solid var(--border-subtle); font-size: var(--type-micro); color: var(--text-tertiary); padding: 0 0.5rem 0.5rem;"},e("div",{class:"flex items-center gap-1"},e("span",{style:"display: inline-block; width: 12px; height: 12px; border-radius: 2px; background: var(--accent); opacity: 0.2;"}),e("span",null,"Low")),e("div",{class:"flex items-center gap-1"},e("span",{style:"display: inline-block; width: 12px; height: 12px; border-radius: 2px; background: var(--accent); opacity: 0.65;"}),e("span",null,"High")),e("div",{class:"flex items-center gap-1"},e("span",{style:"display: inline-block; width: 12px; height: 12px; border-radius: 2px; background: var(--status-error); opacity: 0.65;"}),e("span",null,"High unavail (bad)")),e("span",{style:"color: var(--accent);"},"\\u25C0 today"))))}function Rd({insight:t}){if(!t)return e(ee,{title:"Daily Insight",subtitle:"An AI-generated analysis of your home's patterns. Generated each night at 11:30 PM from the day's data."},e(ye,null,"No insight report yet. The first report is generated after the first full pipeline run."));let a=(t.report||"").split(`
`);return e(ee,{title:"Daily Insight",subtitle:"AI analysis of what happened yesterday and what to watch for. Generated nightly from your full data set.",summary:t.date},e("div",{class:"t-frame p-4","data-label":"insight"},e("span",{class:"inline-block rounded px-2 py-0.5 text-xs mb-3",style:"background: var(--bg-surface-raised); color: var(--text-tertiary)"},t.date),e("div",{class:"space-y-2",style:"color: var(--text-secondary)"},a.map((r,s)=>r.startsWith("###")?e("h3",{key:s,class:"text-sm font-bold mt-3",style:"color: var(--text-primary)"},r.replace(/^###\s*/,"")):r.trim()===""?null:e("p",{key:s,class:"text-sm leading-relaxed"},r)))))}function Tr(t){let a=t.indexOf(".");return a>=0?t.slice(a+1):t}var Zv={very_strong:.9,strong:.7,moderate:.5,weak:.3};function Qv(t){let a=t.conditional_prob_a_given_b,r=t.conditional_prob_b_given_a;return a!=null&&r!=null?(a+r)/2/100:typeof t.strength=="string"?Zv[t.strength]??.5:parseFloat(t.strength!=null?t.strength:t[2])||0}function Xv(t){let a=t.map(o=>({a:o.entity_a||o[0],b:o.entity_b||o[1],strength:Qv(o)})),r={};for(let o of a)for(let l of[o.a,o.b])r[l]||(r[l]={sum:0,count:0}),r[l].sum+=Math.abs(o.strength),r[l].count+=1;let s=Object.keys(r).sort((o,l)=>{let i=r[o].sum/r[o].count;return r[l].sum/r[l].count-i}),n={};for(let o of a)n[o.a+"|"+o.b]=o.strength,n[o.b+"|"+o.a]=o.strength;return{entities:s,pairMap:n}}function em(t){let a=Math.abs(t);if(t===1&&a===1)return"var(--bg-surface-raised)";if(a<=.3)return"var(--bg-surface)";let r=(.3+(a-.3)*(.7/.7)).toFixed(2);return t>0?`color-mix(in srgb, var(--accent) ${Math.round(r*100)}%, transparent)`:`color-mix(in srgb, var(--accent-purple) ${Math.round(r*100)}%, transparent)`}function Id({correlations:t}){let a=t&&t.length>0;return e(ee,{title:"Correlations",subtitle:a?"Devices that change together. Strong correlations suggest automation opportunities or shared failure modes.":"Devices that tend to change together \u2014 useful for creating automations or finding shared failure points.",summary:a?t.length+" pairs":null},a?e(B,null,e("p",{class:"text-xs",style:"color: var(--text-tertiary)"},"This grid shows which devices tend to change at the same time. Blue means they move together (both turn on/off). Purple means they move opposite (one on, the other off). Faded cells are too weak to matter. Numbers closer to 1.0 or -1.0 are stronger relationships."),e(tm,{correlations:t})):e(ye,null,"No correlations yet. Needs enough data to detect statistically reliable relationships between devices."))}function tm({correlations:t}){let{entities:a,pairMap:r}=Xv(t),s=a.length,n={display:"grid",gridTemplateColumns:`auto repeat(${s}, minmax(2.5rem, 1fr))`,gridTemplateRows:`auto repeat(${s}, minmax(2rem, 1fr))`,gap:"1px",overflowX:"auto"};return e("div",{class:"t-frame overflow-x-auto","data-label":"correlation-matrix"},e("div",{style:n},e("div",{style:{gridRow:1,gridColumn:1}}),a.map((o,l)=>e("div",{key:"ch-"+l,style:{gridRow:1,gridColumn:l+2,display:"flex",alignItems:"flex-end",justifyContent:"flex-start",height:"5rem",overflow:"visible",paddingBottom:"0.25rem"}},e("span",{class:"data-mono",style:{fontSize:"var(--type-micro)",color:"var(--text-secondary)",transform:"rotate(-45deg)",transformOrigin:"bottom left",whiteSpace:"nowrap",display:"inline-block"}},Tr(o)))),a.map((o,l)=>e(B,null,e("div",{key:"rh-"+l,class:"data-mono",style:{gridRow:l+2,gridColumn:1,display:"flex",alignItems:"center",paddingRight:"0.5rem",fontSize:"var(--type-micro)",color:"var(--text-secondary)",whiteSpace:"nowrap"}},Tr(o)),a.map((i,d)=>{let u=l===d,y=u?1:r[o+"|"+i]??null,f=y!==null,v=f?Math.abs(y):0,x=f&&!u&&v<=.3;return e("div",{key:l+"-"+d,style:{gridRow:l+2,gridColumn:d+2,background:f?em(y):"transparent",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"2px",minHeight:"2rem"},title:f?`${Tr(o)} \u2194 ${Tr(i)}: ${y.toFixed(2)}`:`${Tr(o)} \u2194 ${Tr(i)}: no data`},f&&e("span",{style:{fontSize:"var(--type-micro)",color:x?"var(--text-tertiary)":v>.6?"var(--text-primary)":"var(--text-secondary)",fontVariantNumeric:"tabular-nums"}},u?"":y.toFixed(2)))})))),e("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid var(--border-subtle)",fontSize:"var(--type-micro)",color:"var(--text-tertiary)",flexWrap:"wrap"}},e("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"}},e("span",{style:{display:"inline-block",width:"12px",height:"12px",borderRadius:"2px",background:"color-mix(in srgb, var(--accent-purple) 70%, transparent)"}}),e("span",null,"Negative")),e("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"}},e("span",{style:{display:"inline-block",width:"12px",height:"12px",borderRadius:"2px",background:"var(--bg-surface)"}}),e("span",null,"Weak (|r| \u2264 0.3)")),e("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"}},e("span",{style:{display:"inline-block",width:"12px",height:"12px",borderRadius:"2px",background:"color-mix(in srgb, var(--accent) 70%, transparent)"}}),e("span",null,"Positive"))))}function Nd({runLog:t,mlModels:a,metaLearning:r}){let s=t&&t.some(l=>l.status==="error"),n=t&&t.length>0?t[0]:null,o=s?"Errors detected in recent runs \u2014 the pipeline may be missing data.":n?`Last run ${St(n.timestamp)}. Everything healthy.`:"No runs recorded yet.";return e(ee,{title:"System Status",subtitle:`If something is red here, the intelligence pipeline is broken and won't catch issues in your home. ${o}`,summary:s?"errors":"healthy"},e("div",{class:"space-y-4"},e("div",{class:"t-frame overflow-x-auto","data-label":"run-log"},e("div",{class:"px-4 py-2 text-xs font-bold uppercase",style:"border-bottom: 1px solid var(--border-subtle); color: var(--text-tertiary)"},"Run Log"),!t||t.length===0?e("div",{class:"px-4 py-3 text-sm",style:"color: var(--text-tertiary)"},"No runs recorded yet."):e("table",{class:"w-full text-sm"},e("thead",null,e("tr",{class:"text-left text-xs",style:"border-bottom: 1px solid var(--border-subtle); color: var(--text-tertiary)"},e("th",{class:"px-4 py-1"},"When"),e("th",{class:"px-4 py-1"},"Type"),e("th",{class:"px-4 py-1"},"Status"))),e("tbody",null,t.map((l,i)=>e("tr",{key:i,style:"border-bottom: 1px solid var(--border-subtle)"},e("td",{class:"px-4 py-1.5",style:"color: var(--text-secondary)",title:l.timestamp},St(l.timestamp)),e("td",{class:"px-4 py-1.5"},e("span",{class:"rounded px-1.5 py-0.5 text-xs",style:"background: var(--bg-surface-raised)"},l.type)),e("td",{class:"px-4 py-1.5"},e("span",{class:"inline-block w-2 h-2 rounded-full",style:`background: ${l.status==="ok"?"var(--status-healthy)":"var(--status-error)"}`}),l.message&&e("span",{class:"ml-1 text-xs",style:"color: var(--status-error)"},l.message))))))),e("div",{class:"t-frame p-4","data-label":"ml-models"},e("div",{class:"text-xs font-bold uppercase mb-2",style:"color: var(--text-tertiary)"},"ML Models"),!a||a.count===0?e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},"ML models activate after 14 days of data. Until then, predictions use statistical baselines only."):e("div",{class:"space-y-2"},e("div",{class:"flex gap-3 text-sm"},e("span",{class:"rounded px-2 py-0.5",style:"background: var(--bg-surface-raised)"},a.count," model",a.count!==1?"s":""),a.last_trained&&e("span",{style:"color: var(--text-tertiary)"},"Last trained: ",St(a.last_trained))),a.scores&&Object.keys(a.scores).length>0&&e("table",{class:"w-full text-xs"},e("thead",null,e("tr",{class:"text-left",style:"color: var(--text-tertiary)"},e("th",{class:"py-1"},"Model"),e("th",null,"R2"),e("th",null,"MAE"))),e("tbody",null,Object.entries(a.scores).map(([l,i])=>e("tr",{key:l},e("td",{class:"py-1 data-mono"},l),e("td",null,i.r2!=null?i.r2.toFixed(3):"\u2014"),e("td",null,i.mae!=null?i.mae.toFixed(2):"\u2014"))))))),e("div",{class:"t-frame p-4","data-label":"meta-learning"},e("div",{class:"text-xs font-bold uppercase mb-2",style:"color: var(--text-tertiary)"},"Meta-Learning"),!r||r.applied_count===0?e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},"Meta-learning reviews model performance weekly and auto-tunes feature selection. Activates after the first training cycle."):e("div",{class:"space-y-2"},e("div",{class:"flex gap-3 text-sm"},e("span",{class:"rounded px-2 py-0.5",style:"background: var(--bg-surface-raised)"},r.applied_count," suggestion",r.applied_count!==1?"s":""," applied"),r.last_applied&&e("span",{style:"color: var(--text-tertiary)"},"Last: ",St(r.last_applied))),r.suggestions&&r.suggestions.length>0&&e("ul",{class:"text-xs space-y-1 list-disc ml-4",style:"color: var(--text-secondary)"},r.suggestions.map((l,i)=>e("li",{key:i},l.description||l.action||JSON.stringify(l))))))))}function Od({drift:t}){if(!t||t.days_analyzed===0)return e(ee,{title:"Drift Detection",subtitle:"Concept drift means your home's patterns have changed \u2014 maybe a new schedule, seasonal shift, or new devices. ARIA uses Page-Hinkley and ADWIN algorithms to detect this automatically."},e(ye,null,"Drift detection data is not yet available. It will populate after ARIA runs its drift check (aria check-drift) with enough prediction history."));let a=Object.keys(t.rolling_mae||{});return e(ee,{title:"Drift Detection",subtitle:"Concept drift means your home's patterns have changed \u2014 maybe a new schedule, seasonal shift, or new devices. ARIA uses Page-Hinkley and ADWIN algorithms to detect this and retrains when needed.",summary:t.needs_retrain?"drift detected":"stable"},e("div",{class:"space-y-3"},e("div",{class:"t-frame p-4","data-label":"status"},e("div",{class:"flex items-center gap-3"},e("span",{class:"inline-block w-3 h-3 rounded-full",style:`background: ${t.needs_retrain?"var(--status-warning)":"var(--status-healthy)"}`}),e("span",{class:"text-sm font-bold",style:`color: ${t.needs_retrain?"var(--status-warning)":"var(--status-healthy)"}`},t.needs_retrain?"Drift Detected":"Stable"),e("span",{class:"text-xs",style:"color: var(--text-tertiary)"},t.days_analyzed," days analyzed")),t.reason&&t.reason!=="no data"&&e("p",{class:"text-xs mt-2",style:"color: var(--text-secondary)"},t.reason)),a.length>0&&e("div",{class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3"},a.map(r=>{let s=(t.drifted_metrics||[]).includes(r),n=t.rolling_mae[r],o=t.current_mae?.[r],l=t.threshold?.[r],i=t.page_hinkley?.[r];return e("div",{key:r,class:"t-frame p-3","data-label":r.replace(/_/g," "),style:s?"border-left: 3px solid var(--status-warning)":""},e("div",{class:"flex items-center justify-between mb-2"},e("span",{class:"text-xs font-bold",style:"color: var(--text-primary)"},r.replace(/_/g," ")),e("span",{class:"inline-block w-2 h-2 rounded-full",style:`background: ${s?"var(--status-warning)":"var(--status-healthy)"}`})),e("div",{class:"space-y-1 text-xs",style:"color: var(--text-secondary)"},e("div",{class:"flex justify-between"},e("span",{style:"color: var(--text-tertiary)"},"Rolling MAE"),e("span",{class:"data-mono"},n??"\u2014")),o!=null&&e("div",{class:"flex justify-between"},e("span",{style:"color: var(--text-tertiary)"},"Current MAE"),e("span",{class:"data-mono",style:o>(l||1/0)?"color: var(--status-warning)":""},o)),l!=null&&e("div",{class:"flex justify-between"},e("span",{style:"color: var(--text-tertiary)"},"Threshold"),e("span",{class:"data-mono"},l)),i&&i.drift_detected&&e("div",{class:"text-xs mt-1",style:"color: var(--status-warning)"},"Page-Hinkley: drift at point ",i.drift_point," (score: ",i.drift_score,")")))})),e("div",{class:"flex items-center gap-4 text-xs pt-2",style:"color: var(--text-tertiary)"},e("div",{class:"flex items-center gap-1"},e("span",{class:"inline-block w-2 h-2 rounded-full",style:"background: var(--status-healthy)"}),e("span",null,"Stable")),e("div",{class:"flex items-center gap-1"},e("span",{class:"inline-block w-2 h-2 rounded-full",style:"background: var(--status-warning)"}),e("span",null,"Drift detected")))))}function Hd({anomalies:t}){if(!t)return e(ee,{title:"Anomaly Detection",subtitle:"Anomaly detection flags things that look unusual compared to your home's normal patterns \u2014 like high power draw at 3 AM or unexpected device activity."},e(ye,null,"Anomaly detection data is not yet available. It will appear after the first ML training cycle."));let a=t.anomalies||[],r=t.autoencoder,s=t.isolation_forest;return e(ee,{title:"Anomaly Detection",subtitle:"Anomaly detection flags things that look unusual compared to your home's normal patterns \u2014 like high power draw at 3 AM or unexpected device activity.",summary:a.length>0?`${a.length} anomal${a.length===1?"y":"ies"}`:"clear"},e("div",{class:"space-y-3"},e("div",{class:"flex items-center gap-3"},s&&e("span",{class:"text-xs font-medium rounded-full px-2.5 py-0.5",style:`background: ${s.contamination?"var(--accent-glow)":"var(--bg-inset)"}; color: ${s.contamination?"var(--accent)":"var(--text-tertiary)"}`},"Isolation Forest",s.contamination?` (${(s.contamination*100).toFixed(1)}%)`:""),r&&e("span",{class:"text-xs font-medium rounded-full px-2.5 py-0.5",style:`background: ${r.enabled?"var(--accent-glow)":"var(--bg-inset)"}; color: ${r.enabled?"var(--accent)":"var(--text-tertiary)"}`},"Autoencoder ",r.enabled?"active":"inactive")),a.length===0?e(ye,null,"No anomalies detected. This means your home's behavior matches its normal patterns."):e("div",{class:"space-y-2"},a.map((n,o)=>e("div",{key:o,class:"t-frame p-3","data-label":"anomaly",style:"border-left: 3px solid var(--status-warning)"},e("div",{class:"flex items-center justify-between"},e("div",{class:"flex items-center gap-2"},e("span",{class:"inline-block w-2 h-2 rounded-full",style:"background: var(--status-warning)"}),e("span",{class:"text-xs font-bold",style:"color: var(--text-primary)"},n.entity_id||n.metric||"unknown")),e("span",{class:"text-xs",style:"color: var(--text-tertiary)"},St(n.timestamp))),e("div",{class:"flex items-center gap-4 mt-1 text-xs",style:"color: var(--text-secondary)"},e("span",null,"Score: ",e("span",{class:"data-mono",style:"color: var(--status-warning)"},typeof(n.score??n.severity)=="number"?(n.score??n.severity).toFixed(3):n.score??n.severity)),e("span",{class:"text-xs rounded-full px-2 py-0.5",style:"background: var(--bg-inset); color: var(--text-tertiary)"},n.type))))),e("div",{class:"flex items-center gap-4 text-xs pt-2",style:"color: var(--text-tertiary)"},e("div",{class:"flex items-center gap-1"},e("span",{class:"inline-block w-2 h-2 rounded-full",style:"background: var(--status-warning)"}),e("span",null,"Anomalous")),e("span",null,"Lower scores = more unusual"))))}function zd({shap:t}){if(!t||!t.available)return e(ee,{title:"Feature Attributions (SHAP)",subtitle:"SHAP values explain WHY ARIA made a prediction. Each bar shows how much a feature pushed the prediction up or down. Longer bars = more influence."},e(ye,null,"SHAP attributions are not yet available. They require trained ML models and are computed during prediction generation."));let a=t.attributions||[],r=Math.max(...a.map(s=>Math.abs(s.contribution)),.001);return e(ee,{title:"Feature Attributions (SHAP)",subtitle:"SHAP values explain WHY ARIA made a prediction. Each bar shows how much a feature pushed the prediction up or down. Longer bars = more influence.",summary:t.model_type||"active"},e("div",{class:"space-y-3"},t.model_type&&e("div",null,e("span",{class:"text-xs font-medium rounded-full px-2.5 py-0.5",style:"background: var(--accent-glow); color: var(--accent)"},t.model_type)),a.length>0?e("div",{class:"t-frame p-4","data-label":"attributions"},e("div",{class:"space-y-1"},a.map((s,n)=>e("div",{key:n,class:"flex items-center gap-2",style:"height: 24px;"},e("span",{class:"text-xs w-32 text-right truncate",style:"color: var(--text-secondary); flex-shrink: 0;"},s.feature.replace(/_/g," ")),e("div",{class:"flex-1 flex items-center",style:"position: relative; min-width: 0;"},e("div",{style:"position: absolute; left: 50%; width: 1px; height: 100%; background: var(--border-subtle);"}),e("div",{style:`
                      position: absolute;
                      ${s.direction==="positive"?"left: 50%":"right: 50%"};
                      width: ${Math.abs(s.contribution)/r*50}%;
                      height: 16px;
                      background: ${s.direction==="positive"?"var(--accent)":"var(--accent-purple)"};
                      opacity: 0.7;
                      border-radius: 2px;
                    `})),e("span",{class:"text-xs w-12 data-mono",style:"color: var(--text-tertiary); flex-shrink: 0;"},s.contribution>0?"+":"",s.contribution.toFixed(3)))))):e(ye,null,"No feature attributions computed yet."),e("div",{class:"flex items-center gap-4 text-xs pt-2",style:"color: var(--text-tertiary)"},e("div",{class:"flex items-center gap-1"},e("span",{class:"inline-block w-3 h-3 rounded",style:"background: var(--accent); opacity: 0.7;"}),e("span",null,"Pushes prediction up")),e("div",{class:"flex items-center gap-1"},e("span",{class:"inline-block w-3 h-3 rounded",style:"background: var(--accent-purple); opacity: 0.7;"}),e("span",null,"Pushes prediction down")))))}function am({shadowAccuracy:t,pipeline:a}){if(!t&&!a)return null;let r=t?.predictions_total??0,s=t?.predictions_correct??0,n=t?.overall_accuracy??0,o=a?.current_stage||t?.stage||"backtest",l=Math.round(n*100),i=l>=70?"color: var(--status-healthy)":l>=40?"color: var(--status-warning)":"color: var(--status-error)",d=r>0?`${l}% accuracy`:o;return e(ee,{title:"Shadow Engine",subtitle:"Predict-compare-score loop running alongside the main engine.",summary:d},e("div",{class:"t-frame p-4","data-label":"shadow"},e("div",{class:"flex items-center justify-between"},e("div",{class:"flex items-center gap-4"},e("span",{class:"text-xs font-medium rounded-full px-2.5 py-0.5 capitalize",style:"background: var(--accent-glow); color: var(--accent)"},o),r>0?e("span",{class:"text-sm",style:"color: var(--text-secondary)"},e("span",{class:"font-bold",style:i},l,"%")," accuracy (",s,"/",r,")"):e("span",{class:"text-sm",style:"color: var(--text-tertiary)"},"No predictions yet")),e("a",{href:"#/shadow",class:"text-sm font-medium",style:"color: var(--accent)"},"Full details \u2192")),a&&(()=>{let u=a.current_stage||"backtest",f=(a.gates||{})[u];if(!f)return null;let v=a[f.field]??0,x=Math.min(100,Math.round(v/f.threshold*100)),h=v>=f.threshold;return e("div",{class:"mt-3 pt-3",style:"border-top: 1px solid var(--border-subtle)"},e("div",{class:"flex items-center justify-between text-xs mb-1"},e("span",{style:"color: var(--text-tertiary)"},"Gate: ",f.label," \u2265 ",Math.round(f.threshold*100),"%"),e("span",{class:h?"font-medium":"",style:h?"color: var(--status-healthy)":"color: var(--text-tertiary)"},Math.round(v*100),"%")),e("div",{class:"h-1.5 rounded-full",style:"background: var(--bg-inset)"},e("div",{class:"h-1.5 rounded-full",style:`background: ${h?"var(--status-healthy)":"var(--accent)"}; width: ${x}%`})))})()))}function qo(){let{data:t,loading:a,error:r,refetch:s}=Re("intelligence"),[n,o]=I(null),[l,i]=I(null),[d,u]=I(null),[y,f]=I(null),[v,x]=I(null);oe(()=>{ie("/api/shadow/accuracy").then(o).catch(()=>{}),ie("/api/pipeline").then(i).catch(()=>{}),ie("/api/ml/drift").then(u).catch(()=>{}),ie("/api/ml/anomalies").then(f).catch(()=>{}),ie("/api/ml/shap").then(x).catch(()=>{})},[]);let h=ve(()=>!t||!t.data?null:t.data,[t]);if(a&&!t)return e("div",{class:"space-y-6"},e("h1",{class:"text-2xl font-bold",style:"color: var(--text-primary)"},"Intelligence"),e(ke,{type:"cards"}));if(r)return e("div",{class:"space-y-6"},e("h1",{class:"text-2xl font-bold",style:"color: var(--text-primary)"},"Intelligence"),e(fe,{error:r,onRetry:s}));if(!h)return e("div",{class:"space-y-6"},e("h1",{class:"text-2xl font-bold",style:"color: var(--text-primary)"},"Intelligence"),e(ye,null,"Intelligence data is loading. The engine collects its first snapshot automatically via cron."));let C=(h.intraday_trend?.length>0?h.intraday_trend[h.intraday_trend.length-1]:null)?.power_watts??null,M=null;if(C!=null&&h.baselines){let k=new Date().toLocaleDateString("en-US",{weekday:"long"}),S=h.baselines[k];if(S?.power_watts?.mean!=null){let O=C-S.power_watts.mean,P=S.power_watts.mean>0?Math.round(O/S.power_watts.mean*100):0;Math.abs(P)>=10?M=`${P>0?"+":""}${P}% vs ${k}`:M=`typical for ${k}`}}let _=Fe(()=>{let k=h.intraday_trend;if(!k||k.length<2)return null;let S=new Date;S.setHours(0,0,0,0);let O=Math.floor(S.getTime()/1e3),P=[],H=[];for(let N of k)P.push(O+(N.hour??0)*3600),H.push(N.power_watts??null);return[P,H]},[h.intraday_trend]);return e("div",{class:"space-y-8 animate-page-enter"},e(ce,{page:"INTELLIGENCE",subtitle:"Your home's learning engine \u2014 baselines, trends, correlations, and insights."}),e("div",{class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},e("div",{class:"sm:col-span-2"},e(Oe,{value:C,label:"home right now",unit:"W",delta:M,sparkData:_})),e(Cd,{maturity:h.data_maturity,shadowStage:l?.current_stage,shadowAccuracy:n?.overall_accuracy}),e(am,{shadowAccuracy:n,pipeline:l}),e("div",{class:"sm:col-span-2"},e(Td,{intraday:h.intraday_trend,baselines:h.baselines})),e("div",{class:"sm:col-span-2"},e(Ed,{activity:h.activity})),e($d,{trendData:h.trend_data,intradayTrend:h.intraday_trend}),e(Pd,{predictions:h.predictions,intradayTrend:h.intraday_trend}),e(Dd,{baselines:h.baselines}),e(Rd,{insight:h.daily_insight}),e(Id,{correlations:h.entity_correlations?.top_co_occurrences}),e(Nd,{runLog:h.run_log,mlModels:h.ml_models,metaLearning:h.meta_learning}),e(Od,{drift:d}),e(Hd,{anomalies:y}),e("div",{class:"sm:col-span-2"},e(zd,{shap:v})),e("div",{class:"sm:col-span-2"},e(ee,{title:"Configuration",subtitle:"Engine parameters are now managed in Settings."},e("div",{class:"t-callout p-3 text-sm flex items-center justify-between"},e("span",null,"Engine settings have moved to the dedicated Settings page."),e("a",{href:"#/settings",class:"font-medium whitespace-nowrap",style:"color: var(--accent)"},"Settings \u2192"))))))}function Ko({children:t}){return e("div",{class:"t-callout p-3 text-sm"},t)}function Ba({label:t,color:a}){return e("span",{class:"data-mono",style:`display: inline-block; font-size: var(--type-label); padding: 2px 8px; border-radius: var(--radius); background: ${a}; color: var(--bg-base); font-weight: 600;`},t)}function rm(t){switch(t){case"stable":return"var(--status-healthy)";case"behavioral_drift":return"var(--status-warning)";case"meta_learner_error":return"var(--status-error)";case"meta_learner_improvement":return"var(--accent)";default:return"var(--text-tertiary)"}}function ss(t){if(!t)return"\u2014";let a=new Date(t);return isNaN(a.getTime())?"\u2014":a.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}function Yo(t){return t==null?"\u2014":`${(t*100).toFixed(1)}%`}function sm({status:t}){let a=t==="active"||t==="passing"||t==="connected"?"var(--status-healthy)":t==="stale"||t==="warning"?"var(--status-warning)":"var(--text-tertiary)";return e("span",{class:"pipeline-led",style:`background: ${a}; box-shadow: 0 0 6px ${a};`})}function rs({label:t,metric:a,status:r}){return e("div",{class:"pipeline-node"},e(sm,{status:r}),e("span",{class:"pipeline-node-label"},t),e("span",{class:"pipeline-node-metric data-mono"},a))}function nm({pipeline:t}){if(!t)return null;let a=t.data_collection||{},r=t.feature_engineering||{},s=t.model_training||{},n=t.predictions||{},o=t.feedback_loop||{};return e("div",{class:"pipeline-flow-bar"},e(rs,{label:"Data",metric:`${a.entity_count||0} entities`,status:a.last_snapshot?"active":"unknown"}),e("span",{class:"pipeline-arrow"},"\u2192"),e(rs,{label:"Features",metric:`${r.total_features||0} signals`,status:r.total_features>0?"active":"unknown"}),e("span",{class:"pipeline-arrow"},"\u2192"),e(rs,{label:"Models",metric:s.last_trained?ss(s.last_trained):"untrained",status:s.last_trained?"active":"unknown"}),e("span",{class:"pipeline-arrow"},"\u2192"),e(rs,{label:"Predictions",metric:n.scores?`${Object.keys(n.scores).length} targets`:"none",status:n.scores&&Object.keys(n.scores).length>0?"active":"unknown"}),e("span",{class:"pipeline-arrow"},"\u2192"),e(rs,{label:"Feedback",metric:`${(o.ml_feedback_caps||0)+(o.shadow_feedback_caps||0)} caps`,status:(o.ml_feedback_caps||0)+(o.shadow_feedback_caps||0)>0?"active":"unknown"}))}function om({pipeline:t,loading:a}){if(!t&&!a)return null;let r=t?.data_collection||{},s=t?.feature_engineering||{},n=t?.model_training||{},o=t?.predictions||{},l=t?.feedback_loop||{};return e("div",{class:"space-y-4"},e(nm,{pipeline:t}),e(Ie,{title:"1. Data Collection",subtitle:"Raw sensor readings from Home Assistant",summary:r.last_snapshot?`${r.snapshot_count_intraday||0} snapshots`:"no data",defaultOpen:!1,loading:a},e("p",{style:"font-size: var(--type-body); color: var(--text-secondary); line-height: 1.6; margin-bottom: 12px;"},"ARIA snapshots your home's state every hour \u2014 sensors, lights, motion, power, and presence. Each snapshot captures ~",r.entity_count||"?"," entities into a single data point."),e("div",{class:"grid grid-cols-1 sm:grid-cols-3 gap-3"},e("div",{class:"t-frame","data-label":"Intraday Snapshots"},e("span",{class:"data-mono",style:"font-size: var(--type-headline); color: var(--accent);"},r.snapshot_count_intraday||0)),e("div",{class:"t-frame","data-label":"Daily Snapshots"},e("span",{class:"data-mono",style:"font-size: var(--type-headline); color: var(--accent);"},r.snapshot_count_daily||0)),e("div",{class:"t-frame","data-label":"Health Guard"},e(Ba,{label:r.health_guard||"unknown",color:r.health_guard==="passing"?"var(--status-healthy)":"var(--status-warning)"}))),r.presence_connected&&e("p",{style:"font-size: var(--type-label); color: var(--text-tertiary); margin-top: 8px;"},"Presence detection connected \u2014 camera and sensor signals feeding into snapshots.")),e(Ie,{title:"2. Feature Engineering",subtitle:"Transforming raw data into learnable signals",summary:s.total_features>0?`${s.total_features} features`:"not computed",defaultOpen:!1,loading:a},e("p",{style:"font-size: var(--type-body); color: var(--text-secondary); line-height: 1.6; margin-bottom: 12px;"},"Raw sensor readings are transformed into ",s.total_features||"?"," features the models can learn from \u2014 time patterns (hour, day-of-week, seasonality), home state (power, lights, occupancy), presence signals, and rolling activity trends."),s.selected_features&&s.selected_features.length>0&&e("div",{class:"t-frame","data-label":`Top Features (${s.method||"ranked"})`},e("div",{style:"display: flex; flex-wrap: wrap; gap: 6px;"},s.selected_features.slice(0,10).map(i=>e("span",{key:i,class:"data-mono",style:"font-size: var(--type-label); padding: 2px 8px; border: 1px solid var(--border-subtle); border-radius: var(--radius);"},i)),s.selected_features.length>10&&e("span",{class:"data-mono",style:"font-size: var(--type-label); color: var(--text-tertiary);"},"+",s.selected_features.length-10," more")))),e(Ie,{title:"3. Model Training",subtitle:"Learning your home's patterns",summary:n.last_trained?`trained ${ss(n.last_trained)}`:"untrained",defaultOpen:!1,loading:a},e("p",{style:"font-size: var(--type-body); color: var(--text-secondary); line-height: 1.6; margin-bottom: 12px;"},"Three model types learn your home's patterns independently \u2014 Gradient Boosting (precise sequential learning), Random Forest (robust ensemble averaging), and LightGBM (fast gradient-based). Their predictions are blended for better accuracy than any single model."),e("div",{class:"grid grid-cols-1 sm:grid-cols-3 gap-3"},e("div",{class:"t-frame","data-label":"Snapshots Used"},e("span",{class:"data-mono",style:"font-size: var(--type-headline); color: var(--accent);"},n.total_snapshots_used||0)),e("div",{class:"t-frame","data-label":"Targets"},e("span",{class:"data-mono",style:"font-size: var(--type-headline); color: var(--accent);"},(n.targets||[]).length)),e("div",{class:"t-frame","data-label":"Validation Split"},e("span",{class:"data-mono",style:"font-size: var(--type-body); color: var(--text-primary);"},n.validation_split||"80/20"))),n.targets&&n.targets.length>0&&e("div",{style:"display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px;"},n.targets.map(i=>e(Ba,{key:i,label:i,color:"var(--accent)"})))),e(Ie,{title:"4. Predictions",subtitle:"What your home should look like right now",summary:o.scores?`${Object.keys(o.scores).length} targets`:"no predictions",defaultOpen:!1,loading:a},e("p",{style:"font-size: var(--type-body); color: var(--text-secondary); line-height: 1.6; margin-bottom: 12px;"},"Each model predicts what your home should look like right now. The difference between prediction and reality reveals anomalies \u2014 unexpected power spikes, unusual occupancy, or lighting changes that don't match your patterns."),o.scores&&Object.keys(o.scores).length>0&&e("div",{class:"t-frame","data-label":"Prediction Accuracy"},e("div",{style:"overflow-x: auto;"},e("table",{style:"width: 100%; border-collapse: collapse; font-family: var(--font-mono); font-size: var(--type-body);"},e("thead",null,e("tr",{style:"border-bottom: 2px solid var(--border-subtle);"},e("th",{style:"text-align: left; padding: 8px 12px; color: var(--text-secondary); font-weight: 600;"},"Target"),e("th",{style:"text-align: right; padding: 8px 12px; color: var(--text-secondary); font-weight: 600;"},"R\xB2"),e("th",{style:"text-align: right; padding: 8px 12px; color: var(--text-secondary); font-weight: 600;"},"MAE"))),e("tbody",null,Object.entries(o.scores).map(([i,d])=>e("tr",{key:i,style:"border-bottom: 1px solid var(--border-subtle);"},e("td",{style:"padding: 8px 12px; color: var(--text-primary);"},i),e("td",{style:"text-align: right; padding: 8px 12px; color: var(--accent);"},d?.r2!=null?d.r2.toFixed(3):"\u2014"),e("td",{style:"text-align: right; padding: 8px 12px; color: var(--text-primary);"},d?.mae!=null?d.mae.toFixed(3):"\u2014")))))))),e(Ie,{title:"5. Feedback Loop",subtitle:"Closing the loop \u2014 accuracy feeds back into learning",summary:(l.ml_feedback_caps||0)+(l.shadow_feedback_caps||0)>0?`${(l.ml_feedback_caps||0)+(l.shadow_feedback_caps||0)} capabilities updated`:"awaiting feedback",defaultOpen:!1,loading:a},e("p",{style:"font-size: var(--type-body); color: var(--text-secondary); line-height: 1.6; margin-bottom: 12px;"},"Model accuracy feeds back into capability scoring, so ARIA focuses on what it can actually predict well. Shadow mode tests new capabilities before they go live. Drift detection flags when your home's patterns change and models need retraining."),e("div",{class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},e("div",{class:"t-frame","data-label":"ML Feedback"},e("span",{class:"data-mono",style:"font-size: var(--type-headline); color: var(--accent);"},l.ml_feedback_caps||0),e("span",{style:"font-size: var(--type-label); color: var(--text-tertiary); display: block;"},"capabilities scored")),e("div",{class:"t-frame","data-label":"Shadow Feedback"},e("span",{class:"data-mono",style:"font-size: var(--type-headline); color: var(--accent);"},l.shadow_feedback_caps||0),e("span",{style:"font-size: var(--type-label); color: var(--text-tertiary); display: block;"},"shadow-tested"))),l.drift_flagged>0&&e("div",{style:"margin-top: 8px;"},e(Ba,{label:`${l.drift_flagged} drift`,color:"var(--status-warning)"}))))}function lm({features:t,loading:a}){let r=t?.selected||[],s=t?.total||0,n=t?.method||"none",o=t?.last_computed,l=r.length===0,i={mrmr:"mRMR",importance:"Importance",none:"None"};return e(Ie,{title:"Feature Selection",subtitle:"mRMR-ranked input signals",summary:l?"not yet computed":`${r.length} of ${s}`,defaultOpen:!0,loading:a},l?e(Ko,null,"Feature selection data is not yet available. It will populate once ML models are trained and mRMR feature ranking is computed."):e("div",{class:"space-y-4"},e(Oe,{value:`${r.length} of ${s}`,label:"Selected Features"}),e("div",{class:"flex items-center gap-3 flex-wrap",style:"margin-top: 12px;"},e(Ba,{label:i[n]||n,color:"var(--accent)"}),o&&e("span",{class:"data-mono",style:"font-size: var(--type-label); color: var(--text-tertiary);"},"computed ",ss(o))),e("div",{class:"t-frame","data-label":"Ranked Features"},e("ol",{style:"list-style: none; padding: 0; margin: 0;"},r.map((d,u)=>e("li",{key:d,style:`display: flex; align-items: center; gap: 8px; padding: 6px 0; font-family: var(--font-mono); font-size: var(--type-body); color: var(--text-primary);${u>0?" border-top: 1px solid var(--border-subtle);":""}`},e("span",{class:"data-mono",style:"min-width: 28px; text-align: right; color: var(--text-tertiary); font-size: var(--type-label);"},u+1,"."),e("span",null,d))))),e("p",{style:"font-size: var(--type-label); color: var(--text-tertiary); line-height: 1.5; margin-top: 8px;"},"Feature selection picks the most informative signals from your home's data. Using mRMR (minimum Redundancy Maximum Relevance), ARIA selects features that are individually useful but not redundant with each other.")))}function im({models:t,loading:a}){let r=t?.reference,s=t?.incremental,n=t?.forecaster,o=!r&&!s&&!n;return e(Ie,{title:"Model Health",subtitle:"Reference comparison, training mode, forecaster",summary:o?"awaiting data":r?.interpretation||"active",defaultOpen:!0,loading:a},o?e(Ko,null,"Model health data is not yet available. It will populate once ML models are trained and reference model comparison is active."):e("div",{class:"space-y-4"},r&&e("div",{class:"t-frame","data-label":"Reference Model"},e("div",{class:"flex items-center gap-3 flex-wrap",style:"margin-bottom: 12px;"},e(Ba,{label:r.interpretation||"unknown",color:rm(r.interpretation)})),e("div",{class:"grid grid-cols-1 sm:grid-cols-3 gap-3"},e("div",{class:"t-frame","data-label":"Primary Trend"},e("span",{class:"data-mono",style:"font-size: var(--type-headline); color: var(--text-primary);"},r.primary_trend!=null?Yo(r.primary_trend):"\u2014")),e("div",{class:"t-frame","data-label":"Reference Trend"},e("span",{class:"data-mono",style:"font-size: var(--type-headline); color: var(--text-primary);"},r.reference_trend!=null?Yo(r.reference_trend):"\u2014")),e("div",{class:"t-frame","data-label":"Divergence"},e("span",{class:"data-mono",style:"font-size: var(--type-headline); color: var(--text-primary);"},(r.divergence??r.divergence_pct)!=null?Yo(r.divergence??r.divergence_pct):"\u2014"))),e("p",{style:"font-size: var(--type-label); color: var(--text-tertiary); line-height: 1.5; margin-top: 12px;"},"A reference model runs alongside ARIA's main model without any meta-learning adjustments. Comparing the two reveals whether accuracy changes come from your home changing (drift) or from ARIA's learning process.")),s&&e("div",{class:"t-frame","data-label":"Incremental Training"},e("div",{class:"flex items-center gap-3 flex-wrap",style:"margin-bottom: 12px;"},e(Ba,{label:s.mode==="incremental"?"Incremental":"Full Retrain",color:s.mode==="incremental"?"var(--accent)":"var(--text-secondary)"}),s.tree_count!=null&&e("span",{class:"data-mono",style:"font-size: var(--type-label); color: var(--text-tertiary);"},s.tree_count," / ",s.max_trees||"\u2014"," trees")),e("p",{style:"font-size: var(--type-label); color: var(--text-tertiary); line-height: 1.5;"},"Instead of rebuilding models from scratch, incremental training adds new trees to existing models \u2014 faster and preserves learned knowledge.")),n&&e("div",{class:"t-frame","data-label":"Forecaster Backend"},e("div",{class:"flex items-center gap-3 flex-wrap"},e(Ba,{label:n.backend||"auto",color:"var(--accent)"}),n.backend==="neuralprophet"&&n.config&&e("span",{class:"data-mono",style:"font-size: var(--type-label); color: var(--text-tertiary);"},"AR(",n.config.ar_order||"?",") \xB7 ",n.config.epochs||"?"," epochs \xB7 lr ",n.config.learning_rate||"?")))))}function cm({models:t,loading:a}){let r=t?.ml_models,s=!r,n=r?.last_trained,o=r?.scores,l=o&&typeof o=="object"&&Object.keys(o).length>0;return e(Ie,{title:"Training History",subtitle:"Last retrain and model accuracy",summary:s?"no data":n?ss(n):"pending",defaultOpen:!0,loading:a},s?e(Ko,null,"Training history is not yet available. It will populate after ARIA completes its first model training run."):e("div",{class:"space-y-4"},n&&e("div",{class:"t-frame","data-label":"Last Trained"},e("span",{class:"data-mono",style:"font-size: var(--type-headline); color: var(--accent);"},ss(n))),l&&e("div",{class:"t-frame","data-label":"Model Scores"},e("div",{style:"overflow-x: auto;"},e("table",{style:"width: 100%; border-collapse: collapse; font-family: var(--font-mono); font-size: var(--type-body);"},e("thead",null,e("tr",{style:"border-bottom: 2px solid var(--border-subtle);"},e("th",{style:"text-align: left; padding: 8px 12px; color: var(--text-secondary); font-weight: 600;"},"Model"),e("th",{style:"text-align: right; padding: 8px 12px; color: var(--text-secondary); font-weight: 600;"},"R\xB2"),e("th",{style:"text-align: right; padding: 8px 12px; color: var(--text-secondary); font-weight: 600;"},"MAE"))),e("tbody",null,Object.entries(o).map(([i,d])=>e("tr",{key:i,style:"border-bottom: 1px solid var(--border-subtle);"},e("td",{style:"padding: 8px 12px; color: var(--text-primary);"},i),e("td",{style:"text-align: right; padding: 8px 12px; color: var(--accent);"},d?.r2!=null?d.r2.toFixed(3):"\u2014"),e("td",{style:"text-align: right; padding: 8px 12px; color: var(--text-primary);"},d?.mae!=null?d.mae.toFixed(3):"\u2014"))))))),e("p",{style:"font-size: var(--type-label); color: var(--text-tertiary); line-height: 1.5; margin-top: 8px;"},"Training history shows when ARIA last retrained its models and how accurate they are. R\xB2 measures how well the model explains variance (1.0 = perfect), MAE measures average prediction error (lower = better).")))}function Jo(){let[t,a]=I(null),[r,s]=I(null),[n,o]=I(null),[l,i]=I(null),[d,u]=I(!0),[y,f]=I(null);function v(){u(!0),f(null),Promise.all([ie("/api/ml/features"),ie("/api/ml/models"),ie("/api/ml/drift"),ie("/api/ml/pipeline")]).then(([x,h,A,C])=>{a(x),s(h),o(A),i(C)}).catch(x=>f(x)).finally(()=>u(!1))}return oe(()=>{v()},[]),y?e("div",{class:"space-y-6"},e(ce,{page:"MLENGINE"}),e(fe,{error:y,onRetry:v})):d?e("div",{class:"space-y-6"},e(ce,{page:"MLENGINE"}),e(ke,{type:"full"})):e("div",{class:"space-y-6 animate-page-enter"},e(ce,{page:"MLENGINE",subtitle:"How ARIA learns your home \u2014 from raw data to predictions"}),e(om,{pipeline:l,loading:!1}),e(lm,{features:t,loading:!1}),e(im,{models:r,loading:!1}),e(cm,{models:r,loading:!1}))}var Fd=["backtest","shadow","suggest","autonomous"],Bd={next_domain_action:"background: var(--accent-glow); color: var(--accent);",room_activation:"background: var(--accent-purple-glow); color: var(--accent-purple);",routine_trigger:"background: var(--status-warning-glow); color: var(--status-warning);"},jd={next_domain_action:"Domain",room_activation:"Room",routine_trigger:"Routine"},dm={correct:"background: var(--status-healthy-glow); color: var(--status-healthy);",disagreement:"background: var(--status-warning-glow); color: var(--status-warning);",nothing:"background: var(--bg-surface-raised); color: var(--text-tertiary);"},Ud={backtest:{field:"backtest_accuracy",threshold:.4,label:"backtest accuracy"},shadow:{field:"shadow_accuracy_7d",threshold:.5,label:"7-day shadow accuracy"},suggest:{field:"suggest_approval_rate_14d",threshold:.7,label:"14-day approval rate"}};function um({pipeline:t,onAdvance:a,onRetreat:r,advanceError:s}){let n=t?.stages||Fd,o=t?.gates||Ud,l=t?.current_stage||"backtest",i=n.indexOf(l),d=Math.max((i+1)/n.length*100,10),u=t?.stage_entered_at,y=o[l],f=y?t?.[y.field]??0:null,v=y?f>=y.threshold:!1,x=i<n.length-1?n[i+1]:null;return e("section",{class:"space-y-3"},e("div",{class:"t-section-header",style:"padding-bottom: 6px;"},e("h2",{class:"text-lg font-bold",style:"color: var(--text-primary)"},"Pipeline Stage")),e("div",{class:"t-frame","data-label":`stage: ${l}`,style:"padding: 1rem;"},e("div",{class:"space-y-4"},e("div",null,e("div",{class:"flex justify-between text-xs mb-1",style:"color: var(--text-tertiary)"},n.map((h,A)=>e("span",{key:h,class:"capitalize",style:A<=i?"font-weight: 700; color: var(--accent)":""},h))),e("div",{class:"h-3 rounded-full",style:"background: var(--bg-inset)"},e("div",{class:"h-3 rounded-full transition-all",style:`background: var(--accent); width: ${d}%`}))),u&&e("p",{class:"text-xs",style:"color: var(--text-tertiary)"},"In ",l," since ",new Date(u).toLocaleDateString()),e("div",{class:"flex items-center gap-2 mt-3"},e("button",{onClick:r,disabled:i===0,class:"t-btn t-btn-secondary text-xs px-3 py-1.5"},"\u2190 Retreat"),e("button",{onClick:a,disabled:i===n.length-1,class:"t-btn t-btn-primary text-xs px-3 py-1.5"},"Advance \u2192")),y&&e("p",{class:"text-xs",style:v?"color: var(--status-healthy)":"color: var(--status-error)"},"Advance",x?` to ${x}`:""," requires >",Math.round(y.threshold*100),"% ",y.label," ","(current: ",Math.round(f*100),"%)"),s&&e("p",{class:"text-xs font-medium",style:"color: var(--status-error)"},s))))}function pm({accuracy:t,pipeline:a}){let r=t?.overall_accuracy??0,s=t?.predictions_total??0,n=t?.predictions_correct??0,o=t?.predictions_disagreement??0,l=t?.predictions_nothing??0,i=a?.current_stage||"backtest",d=[{label:"Accuracy",value:`${Math.round(r*100)}%`,colorStyle:Ar(r*100)},{label:"Total Predictions",value:s},{label:"Correct",value:n},{label:"Disagreements",value:o}];return e("section",{class:"space-y-3"},e("div",{class:"flex items-center gap-3 t-section-header",style:"padding-bottom: 6px;"},e("h2",{class:"text-lg font-bold",style:"color: var(--text-primary)"},"Accuracy"),e("span",{class:"text-xs font-medium rounded-full px-2.5 py-0.5 capitalize",style:"background: var(--accent-glow); color: var(--accent)"},i)),e("div",{class:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-4"},d.map((u,y)=>e("div",{key:y,class:"t-frame","data-label":u.label.toLowerCase(),style:"padding: 1rem;"},e("div",{class:"text-2xl font-bold",style:u.colorStyle||"color: var(--accent)"},u.value),e("div",{class:"text-sm mt-1",style:"color: var(--text-tertiary)"},u.label)))),l>0&&e("p",{class:"text-xs px-1",style:"color: var(--text-tertiary)"},l," prediction",l!==1?"s":""," had no matching outcome (expired with no activity)."))}function fm({accuracy:t}){let a=t?.thompson_sampling;if(!a||!a.buckets||Object.keys(a.buckets).length===0)return e("section",{class:"space-y-3"},e("div",{class:"t-section-header",style:"padding-bottom: 6px;"},e("h2",{class:"text-lg font-bold",style:"color: var(--text-primary)"},"Thompson Sampling")),e("div",{class:"t-callout",style:"padding: 0.75rem;"},e("span",{class:"text-sm",style:"color: var(--text-secondary)"},"Thompson sampling stats will appear after the shadow engine has made predictions.")));let r=Object.keys(a.buckets);return e("section",{class:"space-y-3"},e("div",{class:"t-section-header",style:"padding-bottom: 6px;"},e("h2",{class:"text-lg font-bold",style:"color: var(--text-primary)"},"Thompson Sampling")),e("p",{class:"text-xs",style:"color: var(--text-tertiary)"},"Thompson Sampling decides which predictions to try. Each time-of-day slot builds its own confidence \u2014 ARIA explores more in uncertain slots and exploits what works in confident ones."),e("div",{class:"flex items-center gap-3 flex-wrap"},e("span",{class:"text-xs font-medium rounded-full px-2.5 py-0.5 capitalize",style:"background: var(--accent-glow); color: var(--accent)"},a.strategy),e("span",{class:"text-xs",style:"color: var(--text-tertiary)"},"discount: ",e("span",{style:"color: var(--text-secondary); font-weight: 600;"},a.discount_factor)),e("span",{class:"text-xs",style:"color: var(--text-tertiary)"},"window: ",e("span",{style:"color: var(--text-secondary); font-weight: 600;"},a.window_size))),e("div",{class:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3"},r.map(s=>{let n=a.buckets[s],o=n.explore_rate>.5?"color: var(--status-warning)":"color: var(--status-healthy)";return e("div",{key:s,class:"t-frame","data-label":s,style:"padding: 0.75rem;"},e("div",{class:"text-lg font-bold",style:"color: var(--accent)"},n.alpha,"/",n.beta),e("div",{class:"text-xs mt-1",style:"color: var(--text-tertiary)"},"alpha/beta"),e("div",{class:"text-sm font-bold mt-2",style:o},Math.round(n.explore_rate*100),"%"),e("div",{class:"text-xs",style:"color: var(--text-tertiary)"},"explore rate"),e("div",{class:"text-xs mt-1",style:"color: var(--text-secondary)"},n.samples," samples"))})))}function vm({propagation:t}){if(!t||t.enabled===!1)return e("section",{class:"space-y-3"},e("div",{class:"t-section-header",style:"padding-bottom: 6px;"},e("h2",{class:"text-lg font-bold",style:"color: var(--text-primary)"},"Correction Propagation")),e("div",{class:"t-callout",style:"padding: 0.75rem;"},e("span",{class:"text-sm",style:"color: var(--text-secondary)"},"Correction propagation is not active. It will activate once the shadow engine has enough prediction data to propagate corrections.")));let a=t.stats||{},r=a.replay_buffer_size??0,s=a.replay_buffer_capacity??1,n=s>0?Math.round(r/s*100):0;return e("section",{class:"space-y-3"},e("div",{class:"flex items-center gap-3 t-section-header",style:"padding-bottom: 6px;"},e("h2",{class:"text-lg font-bold",style:"color: var(--text-primary)"},"Correction Propagation"),e("span",{class:"text-xs font-medium rounded-full px-2.5 py-0.5",style:"background: var(--status-healthy-glow); color: var(--status-healthy)"},"enabled")),e("p",{class:"text-xs",style:"color: var(--text-tertiary)"},"When ARIA gets a prediction wrong, it propagates the correction to similar situations nearby in time and space. The replay buffer stores recent corrections for learning."),e("div",{class:"grid grid-cols-1 sm:grid-cols-3 gap-4"},e("div",{class:"t-frame","data-label":"replay buffer",style:"padding: 1rem;"},e("div",{class:"text-2xl font-bold",style:"color: var(--accent)"},r," / ",s),e("div",{class:"text-sm mt-1",style:"color: var(--text-tertiary)"},"replay buffer"),e("div",{class:"h-1.5 rounded-full mt-2",style:"background: var(--bg-inset)"},e("div",{class:"h-1.5 rounded-full",style:`background: var(--accent); width: ${n}%`}))),e("div",{class:"t-frame","data-label":"cell observations",style:"padding: 1rem;"},e("div",{class:"text-2xl font-bold",style:"color: var(--accent)"},a.cell_observations??0),e("div",{class:"text-sm mt-1",style:"color: var(--text-tertiary)"},"cell observations")),e("div",{class:"t-frame","data-label":"kernel bandwidth",style:"padding: 1rem;"},e("div",{class:"text-2xl font-bold",style:"color: var(--accent)"},a.bandwidth??0),e("div",{class:"text-sm mt-1",style:"color: var(--text-tertiary)"},"kernel bandwidth"))))}function mm({trend:t,pipeline:a}){let r=a?.gates||Ud,s=a?.stages||Fd,n=a?.current_stage||"backtest",o=r[n],l=o?Math.round(o.threshold*100):null,i=s.indexOf(n),d=i<s.length-1?s[i+1]:null,{chartData:u,chartSeries:y}=Fe(()=>{if(!t||t.length===0)return{chartData:null,chartSeries:[]};let f=[],v=[],x=[];for(let A of t){let C=Math.floor(new Date(A.date+"T12:00:00Z").getTime()/1e3);f.push(C),v.push(A.accuracy??null),x.push(A.count??0)}let h=[];for(let A=0;A<v.length;A++){let C=Math.max(0,A-6),M=0,_=0;for(let k=C;k<=A;k++)v[k]!=null&&(M+=v[k],_++);h.push(_>0?M/_:null)}return{chartData:[f,h,x],chartSeries:[{label:"7-day Accuracy",color:"var(--accent)",width:2},{label:"Predictions",color:"var(--text-tertiary)",width:1}]}},[t]);return!t||t.length===0?e("section",{class:"space-y-3"},e("div",{class:"t-section-header",style:"padding-bottom: 6px;"},e("h2",{class:"text-lg font-bold",style:"color: var(--text-primary)"},"Daily Trend")),e("div",{class:"t-callout",style:"padding: 0.75rem;"},e("span",{class:"text-sm",style:"color: var(--text-secondary)"},"Accuracy trends will appear after 24-48 hours of predictions."))):e("section",{class:"space-y-3"},e("h2",{class:"text-lg font-bold",style:"color: var(--text-primary)"},"Daily Trend"),e("p",{class:"text-xs",style:"color: var(--text-tertiary)"},"How accurate are ARIA's predictions over time? The line smooths out daily swings to show the real trend. Higher = better guesses."),e("div",{class:"t-frame","data-label":"accuracy trend",style:"padding: 1rem;"},e(Ha,{data:u,series:y,height:160}),e("div",{class:"flex flex-wrap items-center gap-3 mt-2 pt-2",style:"border-top: 1px solid var(--border-subtle); font-size: var(--type-micro); color: var(--text-tertiary);"},e("div",{class:"flex items-center gap-1"},e("span",{style:"display: inline-block; width: 16px; height: 2px; background: var(--accent);"}),e("span",null,"7-day rolling accuracy")),e("div",{class:"flex items-center gap-1"},e("span",{style:"display: inline-block; width: 16px; height: 2px; background: var(--text-tertiary);"}),e("span",null,"Predictions per day"))),l!=null&&e("p",{class:"text-xs mt-2",style:"color: var(--text-tertiary)"},"Gate threshold: ",e("span",{style:"color: var(--accent); font-weight: 600;"},l,"%")," ",o.label," required",d?` to advance to ${d}`:"")))}function ym({predictions:t}){let a=t?.predictions||[];return a.length===0?e("section",{class:"space-y-3"},e("div",{class:"t-section-header",style:"padding-bottom: 6px;"},e("h2",{class:"text-lg font-bold",style:"color: var(--text-primary)"},"Recent Predictions")),e("div",{class:"t-callout",style:"padding: 0.75rem;"},e("span",{class:"text-sm",style:"color: var(--text-secondary)"},"No predictions yet. The shadow engine generates predictions when state changes occur."))):e("section",{class:"space-y-3"},e("h2",{class:"text-lg font-bold",style:"color: var(--text-primary)"},"Recent Predictions"),e("div",{class:"t-frame","data-label":"recent predictions",style:"padding: 0;"},a.map((r,s)=>{let n=Bd[r.prediction_type]||"background: var(--bg-surface-raised); color: var(--text-secondary);",o=jd[r.prediction_type]||r.prediction_type,l=r.outcome?dm[r.outcome]:null,i=r.confidence??0;return e("div",{key:s,class:"flex items-center gap-3 px-4 py-2.5",style:s>0?"border-top: 1px solid var(--border-subtle)":""},e("span",{class:"text-xs w-14 flex-shrink-0",style:"color: var(--text-tertiary)"},St(r.timestamp)),e("span",{class:"text-xs font-medium flex-shrink-0 px-1.5 py-0.5",style:`border-radius: var(--radius); ${n}`},o),e("span",{class:"text-sm flex-1 truncate",style:"color: var(--text-secondary)"},r.predicted_value||"\u2014"),e("div",{class:"w-16 flex-shrink-0"},e("div",{class:"h-1.5 rounded-full",style:"background: var(--bg-inset)"},e("div",{class:"h-1.5 rounded-full",style:`background: var(--accent-dim); width: ${Math.round(i*100)}%`}))),l&&e("span",{class:"text-xs font-medium flex-shrink-0 capitalize px-1.5 py-0.5",style:`border-radius: var(--radius); ${l}`},r.outcome))})))}function gm({disagreements:t}){let a=t?.disagreements||[];return a.length===0?e("section",{class:"space-y-3"},e("div",{class:"t-section-header",style:"padding-bottom: 6px;"},e("h2",{class:"text-lg font-bold",style:"color: var(--text-primary)"},"Top Disagreements")),e("div",{class:"t-callout",style:"padding: 0.75rem;"},e("span",{class:"text-sm",style:"color: var(--status-healthy)"},"No disagreements recorded yet."))):e("section",{class:"space-y-3"},e("h2",{class:"text-lg font-bold",style:"color: var(--text-primary)"},"Top Disagreements"),e("p",{class:"text-xs",style:"color: var(--text-tertiary)"},"High-confidence wrong predictions \u2014 the most informative for learning."),e("div",{class:"space-y-2"},a.map((r,s)=>{let n=Bd[r.prediction_type]||"background: var(--bg-surface-raised); color: var(--text-secondary);",o=jd[r.prediction_type]||r.prediction_type,l=r.confidence??0;return e("div",{key:s,class:"t-frame p-3 space-y-1","data-label":"disagreement",style:"border-left: 4px solid var(--status-warning);"},e("div",{class:"flex items-center gap-2"},e("span",{class:"text-lg font-bold",style:"color: var(--status-warning)"},Math.round(l*100),"%"),e("span",{class:"text-xs font-medium px-1.5 py-0.5",style:`border-radius: var(--radius); ${n}`},o),e("span",{class:"text-xs ml-auto",style:"color: var(--text-tertiary)"},St(r.timestamp))),e("div",{class:"text-sm",style:"color: var(--text-secondary)"},e("span",{style:"color: var(--text-tertiary)"},"Predicted:")," ",r.predicted_value||"\u2014"),r.actual_value&&e("div",{class:"text-sm",style:"color: var(--text-secondary)"},e("span",{style:"color: var(--text-tertiary)"},"Actual:")," ",r.actual_value))})))}function Zo(){let[t,a]=I(null),[r,s]=I(null),[n,o]=I(null),[l,i]=I(null),[d,u]=I(null),[y,f]=I(!0),[v,x]=I(null),[h,A]=I(null);async function C(){A(null);try{let k=await fetch(`${pa}/api/pipeline/advance`,{method:"POST",headers:{"Content-Type":"application/json"},body:"{}"});if(!k.ok){let S=await k.json().catch(()=>({}));S.error==="Gate not met"?A(`Gate not met: ${S.gate} requires ${Math.round(S.required*100)}%, current ${Math.round(S.current*100)}%`):A(S.detail||S.error||`HTTP ${k.status}`);return}await _()}catch(k){A(k.message||String(k))}}async function M(){A(null);try{let k=await fetch(`${pa}/api/pipeline/retreat`,{method:"POST",headers:{"Content-Type":"application/json"},body:"{}"});if(!k.ok){let S=await k.json().catch(()=>({}));A(S.detail||S.error||`HTTP ${k.status}`);return}await _()}catch(k){A(k.message||String(k))}}async function _(){f(!0),x(null);try{let[k,S,O,P,H]=await Promise.all([ie("/api/pipeline"),ie("/api/shadow/accuracy"),ie(`/api/shadow/predictions?limit=${gd}`),ie(`/api/shadow/disagreements?limit=${xd}`),ie("/api/shadow/propagation")]);a(k),s(S),o(O),i(P),u(H)}catch(k){x(k.message||String(k))}finally{f(!1)}}return oe(()=>{_()},[]),y&&!t?e("div",{class:"space-y-6"},e("div",null,e("h1",{class:"text-2xl font-bold",style:"color: var(--text-primary)"},"Shadow Mode"),e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},"Prediction accuracy, pipeline progress, and learning insights.")),e(ke,{type:"full"})):v?e("div",{class:"space-y-6"},e("div",null,e("h1",{class:"text-2xl font-bold",style:"color: var(--text-primary)"},"Shadow Mode"),e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},"Prediction accuracy, pipeline progress, and learning insights.")),e(fe,{error:v,onRetry:_})):e("div",{class:"space-y-8 animate-page-enter"},e(ce,{page:"SHADOW",subtitle:"Predict-compare-score validation loop."}),e(Oe,{value:Math.round((r?.overall_accuracy??0)*100),label:"shadow accuracy",unit:"%",delta:`${t?.current_stage||"backtest"} stage \u2022 ${r?.predictions_total??0} predictions`,sparkData:Fe(()=>{let k=r?.daily_trend;if(!k||k.length<2)return null;let S=[],O=[];for(let P of k)S.push(Math.floor(new Date(P.date+"T12:00:00Z").getTime()/1e3)),O.push(P.accuracy??null);return[S,O]},[r])}),e(um,{pipeline:t,onAdvance:C,onRetreat:M,advanceError:h}),e(pm,{accuracy:r,pipeline:t}),e(fm,{accuracy:r}),e(mm,{trend:r?.daily_trend,pipeline:t}),e("div",{class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},e(ym,{predictions:n}),e(gm,{disagreements:l})),e(vm,{propagation:d}))}function xm(t){let a={};for(let r of t){let s=r.category||"Other";a[s]||(a[s]=[]),a[s].push(r)}return a}function bm({config:t,onUpdate:a}){let[r,s]=I(t.value),[n,o]=I(!1),l=Pt(null),i=t.value===t.default_value;oe(()=>{s(t.value)},[t.value]);function d(f){s(f),l.current&&clearTimeout(l.current),l.current=setTimeout(async()=>{o(!0);try{await fa(`/api/config/${t.key}`,{value:String(f)}),a()}catch(v){console.error("Config save failed:",v)}finally{o(!1)}},500)}async function u(){o(!0);try{await dr(`/api/config/reset/${t.key}`,{}),s(t.default_value),a()}catch(f){console.error("Config reset failed:",f)}finally{o(!1)}}let y=t.value_type;return e("div",{class:"flex flex-col sm:flex-row sm:items-center gap-2 py-3",style:"border-bottom: 1px solid var(--border-subtle)"},e("div",{class:"flex-1 min-w-0"},e("div",{class:"flex items-center gap-2"},e("span",{class:"text-sm font-medium",style:"color: var(--text-secondary)"},t.label||t.key),n&&e("span",{class:"text-xs",style:"color: var(--accent)"},"Saving...")),t.description&&e("p",{class:"text-xs mt-0.5",style:"color: var(--text-tertiary)"},t.description)),e("div",{class:"flex items-center gap-2 flex-shrink-0"},y==="number"&&e("div",{class:"flex items-center gap-2"},e("input",{type:"range",min:t.min_value??0,max:t.max_value??100,step:t.step??1,value:r,onInput:f=>d(f.target.value),class:"w-28",style:"accent-color: var(--accent)"}),e("span",{class:"text-sm w-16 text-right data-mono",style:"color: var(--text-secondary)"},r)),y==="boolean"&&e("button",{class:"relative w-10 h-5 rounded-full transition-colors",style:r==="true"||r==="1"?"background: var(--accent)":"background: var(--bg-inset)",onClick:()=>d(r==="true"||r==="1"?"false":"true")},e("span",{class:`absolute top-0.5 w-4 h-4 rounded-full shadow transition-transform ${r==="true"||r==="1"?"translate-x-5":"translate-x-0.5"}`,style:"background: var(--bg-surface)"})),y==="string"&&e("input",{type:"text",value:r,onInput:f=>d(f.target.value),class:"t-input px-2 py-1 text-sm w-48"}),y==="select"&&e("select",{value:r,onChange:f=>d(f.target.value),class:"t-input px-2 py-1 text-sm"},(t.options||"").split(",").map(f=>e("option",{key:f.trim(),value:f.trim()},f.trim()))),e("button",{onClick:u,disabled:i,class:"text-xs px-2 py-1",style:`border-radius: var(--radius); ${i?"color: var(--text-tertiary); cursor: default;":"color: var(--accent); cursor: pointer;"}`},"Reset")))}function hm({category:t,configs:a,onUpdate:r}){let[s,n]=I(!0);return e("section",{class:"t-frame","data-label":t.toLowerCase()},e("button",{class:"w-full flex items-center justify-between px-4 py-3 text-left",onClick:()=>n(!s)},e("h3",{class:"text-sm font-bold",style:"color: var(--text-secondary)"},t),e("span",{class:"text-xs",style:"color: var(--text-tertiary)"},s?"\u25B2":"\u25BC"," ",a.length," param",a.length!==1?"s":"")),s&&e("div",{class:"px-4 pb-3"},a.map(o=>e(bm,{key:o.key,config:o,onUpdate:r}))))}function Qo(){let[t,a]=I([]),[r,s]=I(!0),[n,o]=I(null);async function l(){try{let u=await ie("/api/config");a(u.configs||[])}catch(u){o(u.message||String(u))}finally{s(!1)}}if(oe(()=>{l()},[]),r&&t.length===0)return e("div",{class:"space-y-6"},e("div",null,e("h1",{class:"text-2xl font-bold",style:"color: var(--text-primary)"},"Settings"),e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},"Configure shadow engine, activity monitor, and data quality parameters.")),e(ke,{type:"full"}));if(n)return e("div",{class:"space-y-6"},e("div",null,e("h1",{class:"text-2xl font-bold",style:"color: var(--text-primary)"},"Settings"),e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},"Configure shadow engine, activity monitor, and data quality parameters.")),e(fe,{error:n,onRetry:l}));let i=xm(t),d=t.filter(u=>u.value!==u.default_value).length;return e("div",{class:"space-y-6 animate-page-enter"},e(ce,{page:"SETTINGS",subtitle:`${t.length} parameters across ${Object.keys(i).length} categories.${d>0?` ${d} modified from defaults.`:""}`}),e("div",{class:"space-y-4"},Object.entries(i).map(([u,y])=>e(hm,{key:u,category:u,configs:y,onUpdate:l}))))}var _m={auto_excluded:"background: var(--bg-surface-raised); color: var(--text-tertiary);",excluded:"background: var(--status-error-glow); color: var(--status-error);",included:"background: var(--status-healthy-glow); color: var(--status-healthy);",promoted:"background: var(--accent-glow); color: var(--accent);"};function wm({summary:t}){let a=t?.total??0,r=t?.per_status??{},s=[{label:"Total",value:a,style:"color: var(--text-secondary)"},{label:"Auto-Excluded",value:r.auto_excluded??0,style:"color: var(--text-tertiary)"},{label:"Excluded",value:r.excluded??0,style:"color: var(--status-error)"},{label:"Included",value:r.included??0,style:"color: var(--status-healthy)"},{label:"Promoted",value:r.promoted??0,style:"color: var(--accent)"}];return e("div",{class:"grid grid-cols-2 sm:grid-cols-5 gap-3"},s.map(n=>e("div",{key:n.label,class:"t-frame","data-label":n.label,style:"padding: 0.75rem; text-align: center;"},e("div",{class:"text-xl font-bold",style:n.style},n.value),e("div",{class:"text-xs",style:"color: var(--text-tertiary)"},n.label))))}function Xo({tier:t,label:a,entities:r,defaultOpen:s,onOverride:n,onBulk:o}){let[l,i]=I(s),[d,u]=I(""),y=d?r.filter(v=>v.entity_id.toLowerCase().includes(d.toLowerCase())||(v.reason||"").toLowerCase().includes(d.toLowerCase())):r,f={};for(let v of y){let x=t===1?v.reason||"Other":v.group_id||v.entity_id;f[x]||(f[x]=[]),f[x].push(v)}return e("section",{class:"t-frame","data-label":`tier ${t}: ${a.toLowerCase()}`},e("button",{class:"w-full flex items-center justify-between px-4 py-3 text-left",onClick:()=>i(!l)},e("div",{class:"flex items-center gap-2"},e("h3",{class:"text-sm font-bold",style:"color: var(--text-secondary)"},"Tier ",t,": ",a),e("span",{class:"text-xs rounded-full px-2 py-0.5",style:"background: var(--bg-surface-raised); color: var(--text-tertiary)"},r.length)),e("span",{class:"text-xs",style:"color: var(--text-tertiary)"},l?"\u25B2":"\u25BC")),l&&e("div",{class:"px-4 pb-3 space-y-3"},r.length>10&&e("input",{type:"text",placeholder:"Search entity or reason...",value:d,onInput:v=>u(v.target.value),class:"t-input w-full px-3 py-1.5 text-sm"}),t<=2?Object.entries(f).map(([v,x])=>e("div",{key:v,class:"p-3 space-y-2",style:"border: 1px solid var(--border-subtle); border-radius: var(--radius)"},e("div",{class:"flex items-center justify-between"},e("span",{class:"text-xs font-medium truncate",style:"color: var(--text-secondary)"},v),e("div",{class:"flex gap-1 flex-shrink-0"},t===1&&e("button",{class:"t-btn text-xs px-2 py-0.5",style:"background: var(--status-healthy-glow); color: var(--status-healthy); border: none;",onClick:()=>o(x.map(h=>h.entity_id),"included")},"Include All"),t===2&&e(B,null,e("button",{class:"t-btn text-xs px-2 py-0.5",style:"background: var(--status-healthy-glow); color: var(--status-healthy); border: none;",onClick:()=>o(x.map(h=>h.entity_id),"included")},"Approve All"),e("button",{class:"t-btn text-xs px-2 py-0.5",style:"background: var(--status-error-glow); color: var(--status-error); border: none;",onClick:()=>o(x.map(h=>h.entity_id),"excluded")},"Reject All")))),e("div",{class:"space-y-1"},x.slice(0,Ys).map(h=>e(Wd,{key:h.entity_id,entity:h,onOverride:n,compact:!0})),x.length>Ys&&e("p",{class:"text-xs",style:"color: var(--text-tertiary)"},"...and ",x.length-Ys," more")))):e("div",{class:"space-y-1"},y.slice(0,Ks).map(v=>e(Wd,{key:v.entity_id,entity:v,onOverride:n})),y.length>Ks&&e("p",{class:"text-xs",style:"color: var(--text-tertiary)"},"Showing ",Ks," of ",y.length,". Use search to narrow."))))}function Wd({entity:t,onOverride:a,compact:r}){let s=_m[t.status]||"background: var(--bg-surface-raised); color: var(--text-secondary);";return e("div",{class:`flex items-center gap-2 ${r?"py-0.5":"py-1.5"}`,style:r?"":"border-bottom: 1px solid var(--border-subtle)"},e("span",{class:"text-xs truncate flex-1 data-mono",style:"color: var(--text-secondary)"},t.entity_id),e("span",{class:"text-[10px] font-medium flex-shrink-0 px-1.5 py-0.5",style:`border-radius: var(--radius); ${s}`},t.status),t.human_override&&e("span",{class:"text-[10px] flex-shrink-0",style:"color: var(--accent-dim)"},"manual"),!r&&e("div",{class:"flex gap-1 flex-shrink-0"},t.status!=="included"&&e("button",{class:"text-[10px]",style:"color: var(--status-healthy)",onClick:()=>a(t.entity_id,"included")},"Include"),t.status!=="excluded"&&e("button",{class:"text-[10px]",style:"color: var(--status-error)",onClick:()=>a(t.entity_id,"excluded")},"Exclude")))}function el(){let[t,a]=I([]),[r,s]=I(null),[n,o]=I(!0),[l,i]=I(null);async function d(){o(!0),i(null);try{let[h,A]=await Promise.all([ie("/api/curation"),ie("/api/curation/summary")]);a(h.curations||[]),s(A)}catch(h){i(h.message||String(h))}finally{o(!1)}}async function u(h,A){try{await fa(`/api/curation/${h}`,{status:A}),await d()}catch(C){console.error("Override failed:",C)}}async function y(h,A){try{await dr("/api/curation/bulk",{entity_ids:h,status:A}),await d()}catch(C){console.error("Bulk update failed:",C)}}oe(()=>{d()},[]);let f=t.filter(h=>h.tier===1),v=t.filter(h=>h.tier===2),x=t.filter(h=>h.tier===3);return n&&t.length===0?e("div",{class:"space-y-6"},e("div",null,e("h1",{class:"text-2xl font-bold",style:"color: var(--text-primary)"},"Data Curation"),e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},"Classify entities into include/exclude tiers for the shadow engine.")),e(ke,{type:"full"})):l?e("div",{class:"space-y-6"},e("div",null,e("h1",{class:"text-2xl font-bold",style:"color: var(--text-primary)"},"Data Curation"),e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},"Classify entities into include/exclude tiers for the shadow engine.")),e(fe,{error:l,onRetry:d})):t.length===0?e("div",{class:"space-y-6"},e(ce,{page:"CURATION",subtitle:"Entity-level noise control and classification."}),e("div",{class:"t-callout",style:"padding: 1rem;"},e("span",{class:"text-sm",style:"color: var(--text-secondary)"},"No entity classifications yet. The data quality module will classify entities after discovery runs."))):e("div",{class:"space-y-6 animate-page-enter"},e(ce,{page:"CURATION",subtitle:"Entity-level noise control and classification."}),e(Oe,{value:r?.per_status?.included??0,label:"entities included",delta:`${r?.per_status?.excluded??0} excluded`}),e(wm,{summary:r}),e("div",{class:"space-y-4 stagger-children"},e(Xo,{tier:1,label:"Auto-Excluded",entities:f,defaultOpen:!1,onOverride:u,onBulk:y}),e(Xo,{tier:2,label:"Edge Cases",entities:v,defaultOpen:!0,onOverride:u,onBulk:y}),e(Xo,{tier:3,label:"Included",entities:x,defaultOpen:!0,onOverride:u,onBulk:y})))}var Vd=[{day:"Day 1",title:"Collecting",desc:"Connects to Home Assistant and starts watching. Every light switch, door sensor, thermostat change, and motion event gets recorded. Zero configuration."},{day:"Days 2\u20133",title:"Baselines",desc:'After 24 hours, ARIA knows what "normal" looks like. Builds hourly averages for every metric \u2014 lights on at 8pm, power draw at noon, motion patterns.'},{day:"Days 3\u20137",title:"ML Training",desc:"Six ML algorithms start training \u2014 predicting which room activates next, when devices turn on, energy patterns. Models improve with every snapshot."},{day:"Week 2+",title:"Shadow Mode",desc:'Predicts silently and scores itself. "What I predicted" vs "what happened." Accuracy climbs daily. Nothing changes in your home yet.'},{day:"When ready",title:"Suggestions",desc:"Once accuracy gates pass, generates automation YAML. You review and approve each one. Nothing runs without your sign-off."}],km=[{title:"Home",path:"/",desc:"Live pipeline flowchart \u2014 data flow, module health, status chips."},{title:"Discovery",path:"/discovery",desc:"Every entity, device, and area HA knows about. Unavailable devices flagged."},{title:"Capabilities",path:"/capabilities",desc:"Detected capabilities \u2014 lighting, climate, presence. Scopes automations to your setup."},{title:"Data Curation",path:"/data-curation",desc:"Include or exclude entities. Filter noisy sensors that confuse models."},{title:"Intelligence",path:"/intelligence",desc:"Baselines, predictions vs actuals, trends, correlations, daily LLM insights."},{title:"Predictions",path:"/predictions",desc:"ML outputs with confidence scores. Green/yellow/red. Improves daily."},{title:"Patterns",path:"/patterns",desc:"Recurring event sequences \u2014 basis for automation suggestions."},{title:"Shadow Mode",path:"/shadow",desc:"Accuracy tracking, disagreements, pipeline stage progression."},{title:"Automations",path:"/automations",desc:"Ready-to-use YAML from detected patterns. Review, approve, or reject."},{title:"Settings",path:"/settings",desc:"Engine parameters \u2014 thresholds, schedules, weights. Defaults work well."}],Gd=[{q:"Does ARIA send my data anywhere?",a:"No. scikit-learn for ML, optionally Ollama for LLM. Zero data leaves your network."},{q:"Will it change my HA setup?",a:"Never without permission. Read-only from HA. Suggestions require manual approval."},{q:"How long until it's useful?",a:"Baselines within 24h. Patterns in 2\u20133 days. ML predictions after a week. Solid suggestions in 2\u20133 weeks."},{q:'Why does everything show "Blocked"?',a:"Normal for the first few days. Each module waits for upstream data. Home page shows exactly what\u2019s needed."},{q:"What is Shadow Mode?",a:"Silent predictions compared to reality. Like a co-pilot building a track record before acting."},{q:"Do I need to configure anything?",a:"No. Auto-discovers devices, classifies entities, builds models. Data Curation lets you fine-tune if needed."}],Sm=[{term:"Entity",def:"Anything HA tracks \u2014 light, sensor, lock, motion detector."},{term:"Baseline",def:'Hourly averages of "normal." Flags when something is unusual for that time of day.'},{term:"Shadow Prediction",def:"Silent prediction scored against reality. Builds track record before action."},{term:"Pipeline",def:"Data path: collection \u2192 learning \u2192 action. Each stage gates the next."},{term:"Curation",def:"Choosing which entities ARIA watches. Filters noise so models learn clean signals."},{term:"Accuracy Gate",def:"Quality checkpoint. No suggestions until predictions hit minimum accuracy."}];function Cm(){return e("div",{class:"relative overflow-hidden px-6 py-8 mb-6 t-terminal-bg",style:"background: var(--bg-surface); border-radius: var(--radius);"},e("div",{class:"absolute inset-0 pointer-events-none",style:"opacity: 0.04"},e("div",{class:"t1-scan-line",style:"width: 100%; height: 2px; background: var(--accent);"})),e("div",{class:"relative"},e(ce,{page:"GUIDE",subtitle:"How ARIA learns and what each page does."}),e("p",{class:"text-lg font-semibold leading-snug mb-3 animate-fade-in delay-200",style:"color: var(--text-primary);"},"Your home generates 22,000+ events every day."," ",e("span",{style:"color: var(--accent);"},"ARIA learns what they mean.")),e("p",{class:"text-sm leading-relaxed animate-fade-in delay-300",style:"color: var(--text-tertiary);"},"Local ML. No cloud. No subscriptions. Watches Home Assistant, learns patterns, generates automation suggestions.")))}function Am(){return e("div",{class:"px-4 py-3 mb-6",style:"background: var(--bg-surface-raised); border-left: 3px solid var(--accent); border-radius: var(--radius);"},e("p",{class:"text-sm",style:"color: var(--text-secondary);"},e("span",{class:"font-semibold",style:"color: var(--accent);"},"Fully local.")," ","ML via scikit-learn, optional LLM via Ollama. No API calls, no telemetry, no cloud accounts."))}function Tm(){return e("div",{class:"mb-6 overflow-hidden",style:"background: var(--bg-surface-raised); border-radius: var(--radius);"},e("div",{class:"px-5 pt-4 pb-2"},e("h2",{class:"text-sm font-bold uppercase tracking-wider",style:"color: var(--accent); letter-spacing: 0.06em;"},"How ARIA Learns")),e("div",{class:"px-5 pb-4"},e("div",{class:"space-y-0 stagger-children"},Vd.map((t,a)=>e("div",{key:a,class:"flex gap-4 items-start py-3",style:a<Vd.length-1?"border-bottom: 1px solid var(--border-subtle);":""},e("div",{class:"shrink-0 w-6 h-6 flex items-center justify-center text-xs font-bold",style:"background: var(--accent); color: var(--bg-surface); border-radius: var(--radius);"},a+1),e("div",{class:"flex-1 min-w-0"},e("div",{class:"flex items-baseline gap-2 mb-0.5"},e("span",{class:"text-xs",style:"color: var(--accent-dim); font-family: var(--font-mono);"},t.day),e("span",{class:"text-sm font-semibold",style:"color: var(--text-primary);"},t.title)),e("p",{class:"text-sm leading-relaxed",style:"color: var(--text-tertiary);"},t.desc)))))))}function Mm(){return e("div",{class:"mb-6 overflow-hidden",style:"background: var(--bg-surface-raised); border-radius: var(--radius);"},e("div",{class:"px-5 pt-4 pb-2"},e("h2",{class:"text-sm font-bold uppercase tracking-wider",style:"color: var(--accent); letter-spacing: 0.06em;"},"Key Concepts")),e("div",{class:"px-5 pb-4 grid grid-cols-1 sm:grid-cols-2 gap-3 stagger-children"},Sm.map((t,a)=>e("div",{key:a,class:"px-3 py-2.5",style:"background: var(--bg-surface); border: 1px solid var(--border-subtle); border-radius: var(--radius);"},e("h3",{class:"text-sm font-bold mb-0.5",style:"color: var(--accent);"},t.term),e("p",{class:"text-xs leading-relaxed",style:"color: var(--text-tertiary);"},t.def)))))}function Em(){return e("div",{class:"mb-6 overflow-hidden",style:"background: var(--bg-surface-raised); border-radius: var(--radius);"},e("div",{class:"px-5 pt-4 pb-2"},e("h2",{class:"text-sm font-bold uppercase tracking-wider",style:"color: var(--accent); letter-spacing: 0.06em;"},"Pages")),e("div",{class:"stagger-children"},km.map((t,a)=>e("a",{key:a,href:`#${t.path}`,class:"flex items-baseline gap-3 px-5 py-2.5 transition-colors",style:"border-bottom: 1px solid var(--border-subtle);",onMouseEnter:r=>{r.currentTarget.style.background="var(--bg-surface)"},onMouseLeave:r=>{r.currentTarget.style.background="transparent"}},e("span",{class:"text-sm font-semibold shrink-0",style:"color: var(--accent); min-width: 7rem;"},t.title),e("span",{class:"text-sm",style:"color: var(--text-tertiary);"},t.desc)))))}function $m(){return e("div",{class:"mb-6 overflow-hidden",style:"background: var(--bg-surface-raised); border-radius: var(--radius);"},e("div",{class:"px-5 pt-4 pb-2"},e("h2",{class:"text-sm font-bold uppercase tracking-wider",style:"color: var(--accent); letter-spacing: 0.06em;"},"FAQ")),e("div",{class:"px-5 pb-4 space-y-0 stagger-children"},Gd.map((t,a)=>e("div",{key:a,class:"py-3",style:a<Gd.length-1?"border-bottom: 1px solid var(--border-subtle);":""},e("h3",{class:"text-sm font-semibold mb-1",style:"color: var(--text-primary);"},t.q),e("p",{class:"text-sm leading-relaxed",style:"color: var(--text-tertiary);"},t.a)))))}function tl(){return e("div",{class:"max-w-3xl mx-auto animate-page-enter"},e(Cm,null),e(Am,null),e(Tm,null),e(Mm,null),e(Em,null),e($m,null),e("div",{class:"text-center pb-6"},e("a",{href:"#/",class:"inline-flex items-center gap-2 px-5 py-2.5 text-sm font-semibold transition-colors",style:"background: var(--accent); color: var(--bg-surface); border-radius: var(--radius);"},"Go to Dashboard")))}var qd={camera_person:"Camera",camera_face:"Face ID",motion:"Motion",light_interaction:"Light",dimmer_press:"Dimmer",door:"Door",device_tracker:"Tracker"},al={camera_person:"var(--accent)",camera_face:"var(--status-healthy)",motion:"var(--accent-purple)",light_interaction:"var(--accent-warm)",dimmer_press:"var(--accent-warm)",door:"var(--text-secondary)",device_tracker:"var(--status-healthy)"};function Pm({value:t}){let a=Math.round(t*100),r=a>=70?"var(--status-healthy)":a>=30?"var(--status-warning)":"var(--accent)";return e("div",{class:"flex items-center gap-2"},e("div",{class:"flex-1 h-2 rounded-full",style:"background: var(--bg-inset)"},e("div",{class:"h-2 rounded-full transition-all",style:`width: ${a}%; background: ${r}; min-width: ${a>0?"4px":"0"}`})),e("span",{class:"text-xs font-bold",style:`color: ${r}; min-width: 32px; text-align: right;`},a,"%"))}function Lm({name:t,room:a}){let r=(a.signals||[]).length,s=(a.persons||[]).length,n=a.probability>=.5,o=a.signals&&a.signals.length>0?a.signals[a.signals.length-1]:null,l={};return(a.signals||[]).forEach(i=>{let d=i.type||"unknown";l[d]||(l[d]=0),l[d]++}),e("div",{class:"t-frame p-4",style:n?"border-left: 4px solid var(--status-healthy)":""},e("div",{class:"flex items-start justify-between mb-2"},e("div",null,e("div",{class:"text-sm font-bold",style:"color: var(--text-primary); text-transform: capitalize;"},t.replace(/_/g," ")),e("div",{class:"text-xs mt-0.5",style:"color: var(--text-tertiary)"},r," signal",r!==1?"s":"",s>0&&` \xB7 ${s} identified`)),e("span",{class:"text-xs font-medium rounded px-1.5 py-0.5",style:qs(a.probability)},a.confidence||(a.probability>=.7?"high":a.probability>=.3?"medium":"low"))),e(Pm,{value:a.probability}),Object.keys(l).length>0&&e("div",{class:"flex flex-wrap gap-1.5 mt-2"},Object.entries(l).map(([i,d])=>e("span",{key:i,class:"text-xs rounded px-1.5 py-0.5",style:`background: var(--bg-surface-raised); color: ${al[i]||"var(--text-tertiary)"}`},qd[i]||i," (",d,")"))),o&&e("div",{class:"text-xs mt-2 truncate",style:"color: var(--text-tertiary)",title:o.detail},o.detail))}function Dm({name:t,info:a}){return e("div",{class:"flex items-center gap-3 py-2",style:"border-bottom: 1px solid var(--border-subtle)"},e("div",{class:"flex items-center justify-center rounded-full",style:"width: 32px; height: 32px; background: var(--accent-glow); color: var(--accent); font-weight: 700; font-size: 14px; flex-shrink: 0;"},(t||"?")[0].toUpperCase()),e("div",{class:"flex-1 min-w-0"},e("div",{class:"text-sm font-medium truncate",style:"color: var(--text-primary); text-transform: capitalize;"},t),e("div",{class:"text-xs",style:"color: var(--text-tertiary)"},a.room?a.room.replace(/_/g," "):"Unknown room",a.confidence!=null&&` \xB7 ${Math.round(a.confidence*100)}%`)),a.last_seen&&e("div",{class:"text-xs flex-shrink-0",style:"color: var(--text-tertiary)"},St(a.last_seen)))}function Rm({cameraRooms:t}){return!t||Object.keys(t).length===0?null:e("div",{class:"flex flex-wrap gap-2"},Object.entries(t).map(([a,r])=>e("div",{key:a,class:"text-xs rounded px-2 py-1",style:"background: var(--bg-surface-raised); color: var(--text-secondary);"},e("span",{style:"color: var(--status-healthy);"},"\u25CF"," "),e("span",{style:"text-transform: capitalize;"},a.replace(/_/g," ")),e("span",{style:"color: var(--text-tertiary);"}," \\u2192 ",r.replace(/_/g," ")))))}function Im({rooms:t}){let a=[];Object.entries(t||{}).forEach(([s,n])=>{(n.signals||[]).forEach((o,l)=>{a.push({...o,room:s,_idx:l})})});let r=a.slice(-15).reverse();return r.length===0?e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},"No signals received yet. Walk past a camera or trigger a motion sensor."):e("div",{class:"space-y-1"},r.map((s,n)=>{let o=al[s.type]||"var(--text-tertiary)";return e("div",{key:n,class:"flex items-center gap-2 py-1 px-1 rounded text-sm"},e("span",{class:"w-2 h-2 rounded-full flex-shrink-0",style:`background: ${o}`}),e("span",{class:"flex-1 truncate",style:"color: var(--text-secondary)",title:s.detail},s.detail||s.type),e("span",{class:"text-xs flex-shrink-0 rounded px-1",style:"background: var(--bg-surface-raised); color: var(--text-tertiary); text-transform: capitalize;"},s.room.replace(/_/g," ")))}))}function Nm({detection:t}){let r=t.event_id&&t.has_snapshot?`/api/frigate/thumbnail/${t.event_id}`:null;return e("div",{class:"t-frame p-2 flex gap-3",style:"min-width: 0;"},e("div",{class:"flex-shrink-0 rounded overflow-hidden",style:"width: 64px; height: 64px; background: var(--bg-inset);"},r?e("img",{src:r,alt:`Detection on ${t.camera}`,style:"width: 100%; height: 100%; object-fit: cover;",loading:"lazy"}):e("div",{class:"flex items-center justify-center w-full h-full",style:"color: var(--text-tertiary); font-size: 20px;"},"\u{1F464}")),e("div",{class:"flex-1 min-w-0"},e("div",{class:"flex items-center gap-2"},t.sub_label?e("span",{class:"text-sm font-bold",style:"color: var(--status-healthy); text-transform: capitalize;"},t.sub_label):e("span",{class:"text-sm font-medium",style:"color: var(--text-secondary)"},"Unknown person"),e("span",{class:"text-xs rounded px-1",style:"background: var(--bg-surface-raised); color: var(--text-tertiary);"},Math.round((t.score||0)*100),"%")),e("div",{class:"text-xs mt-0.5",style:"color: var(--text-tertiary); text-transform: capitalize;"},t.camera.replace(/_/g," ")," \\u2192 ",t.room.replace(/_/g," ")),t.timestamp&&e("div",{class:"text-xs mt-0.5",style:"color: var(--text-tertiary)"},St(t.timestamp))))}function Om({faceConfig:t,labeledFaces:a}){let r=t&&t.enabled,s=t&&t.config||{},n=t&&t.labeled_count||0,o=a||{};return e("div",{class:"space-y-3"},e("div",{class:"flex flex-wrap gap-3"},e("div",{class:"t-frame p-3 flex-1",style:"min-width: 120px;"},e("div",{class:"text-xs",style:"color: var(--text-tertiary)"},"Status"),e("div",{class:"flex items-center gap-1.5 mt-1"},e("span",{class:"inline-block w-2 h-2 rounded-full",style:`background: ${r?"var(--status-healthy)":"var(--status-error)"}`}),e("span",{class:"text-sm font-medium",style:`color: ${r?"var(--status-healthy)":"var(--status-error)"}`},r?"Active":"Disabled"))),e("div",{class:"t-frame p-3 flex-1",style:"min-width: 120px;"},e("div",{class:"text-xs",style:"color: var(--text-tertiary)"},"Labeled Faces"),e("div",{class:"text-xl font-bold mt-1",style:`color: ${n>0?"var(--accent)":"var(--text-tertiary)"}`},n)),e("div",{class:"t-frame p-3 flex-1",style:"min-width: 120px;"},e("div",{class:"text-xs",style:"color: var(--text-tertiary)"},"Threshold"),e("div",{class:"text-sm font-bold mt-1",style:"color: var(--text-primary)"},s.recognition_threshold?`${Math.round(s.recognition_threshold*100)}%`:"--")),e("div",{class:"t-frame p-3 flex-1",style:"min-width: 120px;"},e("div",{class:"text-xs",style:"color: var(--text-tertiary)"},"Model"),e("div",{class:"text-sm font-medium mt-1",style:"color: var(--text-primary)"},s.model_size||"--"))),Object.keys(o).length>0&&e("div",null,e("div",{class:"text-xs font-medium mb-1.5",style:"color: var(--text-secondary)"},"Known Faces"),e("div",{class:"flex flex-wrap gap-2"},Object.entries(o).map(([l,i])=>e("span",{key:l,class:"text-xs rounded px-2 py-1",style:"background: var(--accent-glow); color: var(--accent); text-transform: capitalize;"},l," (",i," sample",i!==1?"s":"",")")))),n===0&&r&&e(ye,null,"No faces labeled yet. Frigate automatically collects face samples from person detections. To enable face recognition: open Frigate UI, go to a person event, and assign a name to the detected face. After labeling ",s.min_faces||2,"+ samples per person, ARIA will identify them automatically across all cameras."))}function rl(){let{data:t,loading:a,error:r,refetch:s}=Re("presence");if(a&&!t)return e(ke,{type:"cards"});if(r)return e(fe,{error:r,onRetry:s});let n=t&&t.data||{},o=n.rooms||{},l=n.occupied_rooms||[],i=n.identified_persons||{},d=n.camera_rooms||{},u=n.mqtt_connected,y=n.face_recognition||{},f=n.recent_detections||[],v=Object.keys(o),x=Object.keys(i),h=v.reduce((k,S)=>k+(o[S].signals||[]).length,0),A=Object.keys(d).length,C=l.length,M=C===1?"1 room occupied":`${C} rooms occupied`,_=new Set(f.map(k=>k.camera));return e("div",{class:"space-y-6 animate-page-enter"},e(ce,{page:"PRESENCE",subtitle:"Room-level occupancy from cameras, motion sensors, and device signals fused through Bayesian probability."}),e("div",{class:"flex items-center gap-3 flex-wrap"},e("div",{class:"flex items-center gap-2 text-xs"},e("span",{class:"inline-block w-2.5 h-2.5 rounded-full",style:`background: ${u?"var(--status-healthy)":"var(--status-error)"}`}),e("span",{style:`color: ${u?"var(--status-healthy)":"var(--status-error)"}`},"MQTT ",u?"Connected":"Disconnected")),e("div",{class:"text-xs",style:"color: var(--text-tertiary)"},v.length," room",v.length!==1?"s":""," \\u00B7 ",h," signal",h!==1?"s":""," \\u00B7 ",A," camera",A!==1?"s":"",_.size>0&&` \xB7 ${_.size} detecting`)),!u&&e(ye,null,"MQTT is disconnected. Camera-based presence signals are unavailable. Check that Frigate and Mosquitto are running."),e("div",{class:"grid grid-cols-1 lg:grid-cols-3 gap-4"},e("div",{class:"t-frame p-4",style:`border-left: 4px solid ${C>0?"var(--status-healthy)":"var(--border-subtle)"}`},e("div",{class:"text-4xl font-bold",style:`color: ${C>0?"var(--status-healthy)":"var(--text-tertiary)"}`},C),e("div",{class:"text-sm mt-1",style:"color: var(--text-tertiary)"},M),l.length>0&&e("div",{class:"text-xs mt-1",style:"color: var(--text-secondary); text-transform: capitalize;"},l.map(k=>k.replace(/_/g," ")).join(", "))),e("div",{class:"lg:col-span-2 t-frame p-4","data-label":"who's home"},x.length===0?e("div",null,e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},"No identified persons yet."),e("p",{class:"text-xs mt-1",style:"color: var(--text-tertiary)"},"Face recognition builds over time. Frigate collects unknown faces automatically",y.labeled_count>0?` \u2014 ${y.labeled_count} face${y.labeled_count!==1?"s":""} labeled so far.`:" \u2014 label them in the Frigate UI to enable identification.")):e("div",null,x.map(k=>e(Dm,{key:k,name:k,info:i[k]}))))),e(ee,{title:"Recent Detections",subtitle:"Person detections across all cameras, newest first. Thumbnails from Frigate event snapshots.",summary:`${f.length} events`,defaultOpen:f.length>0},f.length===0?e(ye,null,"No person detections yet. Walk past a camera to trigger a detection event."):e("div",{class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3"},f.slice(0,12).map((k,S)=>e(Nm,{key:k.event_id||S,detection:k})))),e(ee,{title:"Room Occupancy",subtitle:"Per-room probability from fused sensor signals. Rooms above 50% are considered occupied.",summary:`${v.length} rooms`},v.length===0?e(ye,null,"No rooms detected yet. Rooms appear when cameras detect people or HA sensors report activity in mapped areas."):e("div",{class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},v.sort((k,S)=>(o[S].probability||0)-(o[k].probability||0)).map(k=>e(Lm,{key:k,name:k,room:o[k]})))),e(ee,{title:"Face Recognition",subtitle:"Frigate collects face samples from person detections. Label faces in the Frigate UI to enable cross-camera identification.",summary:y.enabled?`${y.labeled_count||0} labeled`:"disabled",defaultOpen:!1},e(Om,{faceConfig:y,labeledFaces:y.labeled_faces||{}})),e(ee,{title:"Signal Feed",subtitle:"Recent detection events across all rooms. Each signal decays over time based on its type.",summary:`${h} active`,defaultOpen:h>0},e("div",{class:"t-frame p-4","data-label":"signals"},e(Im,{rooms:o})),e("div",{class:"flex flex-wrap items-center gap-3 mt-3",style:"font-size: 10px; color: var(--text-tertiary);"},Object.entries(qd).map(([k,S])=>e("div",{key:k,class:"flex items-center gap-1"},e("span",{class:"inline-block w-2 h-2 rounded-full",style:`background: ${al[k]}`}),e("span",null,S))))),e(ee,{title:"Cameras",subtitle:"Active camera-to-room mappings. Cameras publish person detections to MQTT via Frigate.",summary:`${A} mapped`,defaultOpen:!1},e("div",{class:"t-frame p-4","data-label":"camera map"},e(Rm,{cameraRooms:d}))))}var Hm={0:"Power",1:"Lights",2:"Occupancy",3:"Unavail",4:"Events"};function zm({status:t}){return e("span",{style:`display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: ${t==="passed"?"var(--status-healthy)":t==="failed"?"var(--status-error)":"var(--text-tertiary)"}; margin-right: 6px;`})}function Fm({scenarios:t}){return!t||!Object.keys(t).length?null:e("div",{class:"t-frame","data-label":"scenarios",style:"padding: 0.75rem; overflow-x: auto;"},e("table",{style:"width: 100%; border-collapse: collapse; font-size: var(--type-body);"},e("thead",null,e("tr",{style:"border-bottom: 1px solid var(--border-subtle);"},e("th",{style:"text-align: left; padding: 4px 8px; color: var(--text-secondary);"},"Scenario"),e("th",{style:"text-align: right; padding: 4px 8px; color: var(--text-secondary);"},"Overall"),Object.values(Hm).map(a=>e("th",{key:a,style:"text-align: right; padding: 4px 8px; color: var(--text-secondary);"},a)))),e("tbody",null,Object.entries(t).map(([a,r])=>e("tr",{key:a,style:"border-bottom: 1px solid var(--border-subtle);"},e("td",{class:"data-mono",style:"padding: 4px 8px;"},a),e("td",{class:"data-mono",style:`padding: 4px 8px; text-align: right; ${Ar(r.overall)}`},r.overall,"%"),(r.metrics||[]).map((s,n)=>e("td",{key:n,class:"data-mono",style:`padding: 4px 8px; text-align: right; ${Ar(s)}`},s,"%")))))))}function Yd({tests:t,filterStatus:a}){let r=a?t.filter(s=>s.status===a):t;return r.length?e("div",{class:"space-y-1"},r.map(s=>e("div",{key:s.name,class:"flex items-center text-sm",style:"color: var(--text-secondary);"},e(zm,{status:s.status}),e("span",{class:"data-mono"},s.name)))):e("p",{class:"text-sm",style:"color: var(--text-tertiary)"},"None")}function sl(){let[t,a]=I(null),[r,s]=I(!0),[n,o]=I(!1),[l,i]=I(null);function d(){s(!0),ie("/api/validation/latest").then(a).catch(i).finally(()=>s(!1))}function u(){o(!0),i(null),dr("/api/validation/run",{}).then(x=>{a(x),o(!1)}).catch(x=>{i(x),o(!1)})}if(oe(()=>{d()},[]),r)return e(ke,{label:"Loading validation results..."});if(l)return e(fe,{error:l,onRetry:d});let y=t?.report||{},f=t?.status!=="no_runs",v=y.overall;return e("div",{class:"space-y-6"},e(ce,{title:"VALIDATION"}),e("div",{class:"flex items-center gap-4"},e("button",{onClick:u,disabled:n,class:"t-btn-primary",style:"padding: 8px 20px; font-size: var(--type-body); cursor: pointer; border: none; border-radius: var(--radius);"},n?"Running...":"Run Validation Suite"),n&&e("span",{class:"text-sm",style:"color: var(--text-tertiary)"},"This takes ~60 seconds..."),f&&t.timestamp&&e("span",{class:"text-sm",style:"color: var(--text-tertiary)"},"Last run: ",new Date(t.timestamp).toLocaleString(),t.duration_seconds&&` (${t.duration_seconds.toFixed(0)}s)`)),f?e(B,null,e(Oe,{label:"Prediction Accuracy",value:v!=null?`${v.toFixed(0)}%`:"\u2014",sub:`${t.passed} passed \xB7 ${t.failed} failed \xB7 ${t.skipped} skipped`,accentColor:v>=70?"var(--status-healthy)":v>=40?"var(--status-warning)":"var(--status-error)"}),e(Ie,{title:"Scenario Scores",defaultOpen:!0},e(Fm,{scenarios:y.scenarios})),y.backtest&&y.backtest.overall!=null&&e(Ie,{title:"Real-Data Backtest",defaultOpen:!0},e("div",{class:"t-frame","data-label":"backtest",style:"padding: 0.75rem;"},e("div",{class:"flex items-center gap-4"},e("span",{class:"text-sm",style:"color: var(--text-secondary);"},"Real data accuracy:"),e("span",{class:"data-mono text-lg font-bold",style:Ar(y.backtest.overall)},y.backtest.overall,"%"),v!=null&&e("span",{class:"text-sm",style:"color: var(--text-tertiary);"},"vs synthetic ",v,"%")))),e(Ie,{title:`All Tests (${t.total})`},e(Yd,{tests:t.tests||[]})),t.failed>0&&e(Ie,{title:`Failed Tests (${t.failed})`,defaultOpen:!0},e(Yd,{tests:t.tests||[],filterStatus:"failed"}))):e("div",{class:"t-frame","data-label":"no data",style:"padding: 2rem; text-align: center;"},e("p",{style:"color: var(--text-secondary);"},'No validation runs yet. Click "Run Validation Suite" to start.')))}function Bm(){let t=[];function a(){let n=(window.location.hash||"#/").replace(/^#/,"")||"/",o=n.indexOf("?");return{pathname:o>=0?n.slice(0,o):n,search:o>=0?n.slice(o):""}}function r(){let s=a();t.forEach(n=>n({location:s}))}return window.addEventListener("hashchange",r),window.location.hash||(window.location.hash="#/"),{get location(){return a()},listen(s){return t.push(s),()=>{let n=t.indexOf(s);n>=0&&t.splice(n,1)}},push(s){window.location.hash="#"+s},replace(s){let n=window.location.pathname+window.location.search+"#"+s;window.history.replaceState(null,"",n),window.dispatchEvent(new HashChangeEvent("hashchange"))}}}var jm=Bm(),nl=class extends Jt{state={error:null};componentDidCatch(a){this.setState({error:a})}render(){return this.state.error?e(fe,{error:this.state.error,onRetry:()=>this.setState({error:null})}):this.props.children}};function ol(){return oe(()=>(Bn(),()=>Ti()),[]),e("div",{class:"min-h-screen",style:"background: var(--bg-base); color: var(--text-primary); transition: background 0.3s ease, color 0.3s ease;"},e(qn,null),e("main",{class:"lg:ml-60 sm:ml-14 pb-16 sm:pb-0 min-h-screen"},e("div",{class:"max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8"},e(nl,null,e(In,{history:jm},e($o,{path:"/"}),e(No,{path:"/discovery"}),e(zo,{path:"/capabilities"}),e(Bo,{path:"/predictions"}),e(jo,{path:"/patterns"}),e(Wo,{path:"/automations"}),e(qo,{path:"/intelligence"}),e(Jo,{path:"/ml-engine"}),e(Zo,{path:"/shadow"}),e(Qo,{path:"/settings"}),e(el,{path:"/data-curation"}),e(rl,{path:"/presence"}),e(sl,{path:"/validation"}),e(tl,{path:"/guide"}))))))}Ql(e(ol,null),document.getElementById("app"));
